# 微信公众号浮动工具栏 (FlowEdit)

一个Chrome扩展程序，为微信公众号编辑器提供浮动工具栏功能，帮助用户快速应用标题和格式化样式，提升内容创作效率。

## 功能特点

- **智能浮动工具栏**：在选中文本时自动显示，快速应用标题样式（H1-H4）和行内代码样式
- **可拖动控制按钮**：自由移动并自动吸附到屏幕边缘，不影响编辑体验
- **代码块增强**：自动美化代码块并支持语法高亮，可显示行号
- **全面的设置面板**：可调整标题、代码和其他元素的样式
- **自定义CSS支持**：完全控制编辑器中的样式
- **模块化架构**：采用现代化组件设计，易于扩展和维护
- **本地存储**：保存用户偏好设置，下次访问自动应用
- **响应式设计**：适配不同屏幕尺寸和设备
- **无依赖实现**：不依赖任何外部库，确保最佳性能和兼容性

## 项目结构

```
flowedit/
│├─ assets/                    # 静态资源
│   └─ icons/                 # 图标文件
│├─ build/                     # 构建输出目录
│├─ src/                       # 源代码
│   ├─ background/            # 背景脚本
│   │   └─ background.js      # 背景脚本入口文件
│   ├─ content/               # 内容脚本
│   │   ├─ core/              # 核心功能模块
│   │   │   ├─ config.js       # 配置常量和默认设置
│   │   │   └─ plugin.js       # 主插件类
│   │   ├─ ui/                # UI组件
│   │   │   ├─ components/      # 基础UI组件
│   │   │   │   ├─ Icon.js         # 图标组件
│   │   │   │   ├─ Modal.js        # 弹出框组件
│   │   │   │   ├─ Notification.js # 通知组件
│   │   │   │   ├─ SettingsPanel.js # 设置面板组件
│   │   │   │   └─ Tooltip.js      # 工具提示组件
│   │   │   └─ widgets/        # 功能型组件
│   │   │       ├─ FloatingToolbar.js # 浮动工具栏
│   │   │       ├─ DraggableButton.js # 可拖动按钮
│   │   │       └─ SwitchButton.js   # 开关按钮
│   │   ├─ features/           # 功能模块
│   │   │   └─ code/           # 代码相关功能
│   │   │       ├─ CodeBlockEnhancer.js # 代码块增强器
│   │   │       └─ CodeBlockSettings.js # 代码块设置
│   │   ├─ styles/            # 样式文件
│   │   │   ├─ base/           # 基础样式
│   │   │   │   ├─ variables.css  # CSS变量
│   │   │   │   └─ reset.css      # 重置样式
│   │   │   ├─ components/     # 组件样式
│   │   │   │   ├─ toolbar.css    # 工具栏样式
│   │   │   │   ├─ switch.css     # 开关按钮样式
│   │   │   │   ├─ draggable.css  # 可拖动按钮样式
│   │   │   │   ├─ settings.css   # 设置面板样式
│   │   │   │   ├─ codeblock.css  # 代码块样式
│   │   │   │   ├─ modal.css      # 弹出框样式
│   │   │   │   ├─ tooltip.css    # 工具提示样式
│   │   │   │   └─ notification.css # 通知样式
│   │   │   └─ main.css        # 主样式文件
│   │   ├─ utils/             # 工具函数
│   │   │   ├─ dom.js         # DOM操作工具
│   │   │   ├─ storage.js     # 存储工具
│   │   │   ├─ events.js      # 事件处理工具
│   │   │   └─ helpers.js     # 通用辅助函数
│   │   └─ content.js         # 内容脚本入口文件
│   └─ libs/                  # 第三方库
│├─ build.sh                   # 构建脚本
│├─ package.json               # 项目依赖和脚本
│├─ rollup.config.js           # Rollup构建配置
└─ manifest.json              # 扩展清单文件
```

## 技术栈

- 原生JavaScript（ES6+）
- CSS3 与 CSS 变量
- Chrome Extension API
- ES 模块系统
- 基于组件的架构
- 事件驱动编程
- 响应式设计
- Rollup（构建工具）

## 安装方法

### 开发模式安装

1. 克隆或下载本仓库到本地
2. 安装依赖并构建项目：
   ```bash
   npm install
   ./build.sh
   ```
3. 打开Chrome浏览器，进入扩展程序页面（chrome://extensions/）
4. 开启“开发者模式”
5. 点击“加载已解压的扩展程序”
6. 选择项目的 `build` 目录

### 从Chrome商店安装（如果已发布）

1. 访问Chrome网上应用店
2. 搜索"微信公众号浮动工具栏"
3. 点击"添加到Chrome"

## 使用方法

### 基本操作

1. 安装扩展后，访问微信公众号编辑页面（https://mp.weixin.qq.com/cgi-bin/appmsg）
2. 页面右侧会出现一个可拖动的设置按钮
3. 在编辑器中选中文本，会出现浮动工具栏
4. 点击工具栏上的按钮应用相应样式

### 工具栏功能

- **标题样式**：快速应用 H1-H4 标题样式
- **代码样式**：应用行内代码格式
- **代码块**：插入并格式化代码块，支持语法高亮

### 快捷键

- **Ctrl+B**：加粗
- **Ctrl+I**：斜体
- **Ctrl+U**：下划线
- **Ctrl+K**：插入链接
- **Ctrl+Shift+C**：插入行内代码

## 自定义设置

### 外观设置

1. 点击悬浮设置按钮打开设置面板
2. 在“基本设置”标签页中可以调整：
   - 标题样式（字体大小、字重、行高、颜色）
   - 代码样式（字体、背景色、圆角大小）
   - 工具栏外观（位置、大小、颜色）

### 代码块设置

1. 点击“代码块设置”按钮进入代码块设置面板
2. 可以调整以下选项：
   - 主题（暗色/亮色）
   - 字体大小和字体家族
   - 行高和圆角大小
   - 是否显示行号

### 自定义 CSS

1. 在“自定义 CSS”标签页中可以输入自定义 CSS 代码
2. 支持所有标准 CSS 语法
3. 可以使用选择器精确定位微信编辑器中的元素
4. 点击“预览”按钮实时查看效果
5. 点击“保存”按钮应用并保存设置

## 开发指南

### 架构概述

项目采用模块化的架构，分为以下几个主要部分：

1. **核心模块（core）**：包含插件的核心配置和主类
2. **UI组件（ui）**：分为基础组件和功能型组件
3. **功能模块（features）**：包含各种功能的实现
4. **工具函数（utils）**：提供各种帮助函数
5. **样式（styles）**：分为基础样式和组件样式

### 添加新功能

1. **确定功能类型**：
   - UI组件：添加到 `ui/components` 或 `ui/widgets`
   - 功能模块：添加到 `features` 下的相应目录
   - 工具函数：添加到 `utils` 目录

2. **创建新组件**：
   - 遵循单一职责原则，每个组件只负责一个功能
   - 使用 ES6 类和模块化设计
   - 提供清晰的 API 和文档

3. **添加样式**：
   - 为新组件创建对应的样式文件在 `styles/components` 目录下
   - 在 `main.css` 中导入新样式文件
   - 使用 CSS 变量确保样式一致性

4. **集成到主插件**：
   - 在 `core/plugin.js` 中引入并初始化新组件
   - 添加必要的配置到 `core/config.js`

5. **测试与调试**：
   - 运行构建脚本生成最终代码
   - 在浏览器中测试新功能

### 构建与打包

项目使用Rollup构建系统，可以将模块化的代码打包成单一文件，以便在Chrome扩展中使用。

#### 开发流程

1. 修改源代码（src目录下）
2. 运行构建脚本生成打包文件：
   ```bash
   ./build.sh
   ```
3. 加载`build`目录到Chrome扩展中进行测试

#### 发布打包

1. 确保所有代码已经测试并正常工作
2. 运行构建脚本生成最终打包文件：
   ```bash
   ./build.sh
   ```
3. 压缩`build`目录为ZIP文件
4. 在Chrome开发者控制台上传ZIP文件

## 贡献指南

欢迎提交 Pull Request 或 Issue 来改进这个项目。

### 代码规范

1. **命名规范**：
   - 类名使用 PascalCase（如 `FloatingToolbar`）
   - 函数和变量使用 camelCase（如 `createButton`）
   - 常量使用大写下划线（如 `STORAGE_KEYS`）
   - CSS 类名使用小写加连字符（如 `wx-toolbar-button`）

2. **文件组织**：
   - 每个组件或功能模块单独一个文件
   - 样式文件应与组件文件对应
   - 使用清晰的目录结构分类文件

3. **注释和文档**：
   - 为所有类、方法和复杂逻辑添加注释
   - 使用 JSDoc 格式的注释
   - 更新 README 文档以反映新功能

### 提交流程

1. Fork 仓库并创建特性分支
2. 实现功能并添加测试
3. 确保代码符合规范并正常工作
4. 提交 Pull Request，详细描述变更

### 问题报告

如果发现问题，请提交 Issue，并包含以下信息：

1. 问题描述和复现步骤
2. 浏览器版本和操作系统
3. 错误消息或截图（如有）
4. 期望的行为

## 许可证

[MIT License](LICENSE)

## 联系方式

如有问题或建议，请提交 Issue 或联系项目维护者。

---

感谢使用 FlowEdit！如果你喜欢这个扩展，请在 Chrome 商店中给我们评分和评价。

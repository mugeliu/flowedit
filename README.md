# FlowEdit

**FlowEditï¼šå¢å¼ºå¾®ä¿¡å…¬ä¼—å¹³å°ç¼–è¾‘å™¨ä½“éªŒ**

FlowEdit æ˜¯ä¸€ä¸ª Chrome æµè§ˆå™¨æ‰©å±•ï¼Œä¸“ä¸ºå¾®ä¿¡å…¬ä¼—å¹³å°ç¼–è¾‘å™¨è®¾è®¡ï¼Œé€šè¿‡é›†æˆ Editor.js å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å’Œæ™ºèƒ½åŠŸèƒ½æ¨¡å—ï¼Œæ˜¾è‘—æå‡å†…å®¹åˆ›ä½œä½“éªŒã€‚åŸºäºæ’ä»¶åŒ–æ¶æ„ï¼Œæä¾›æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„ç¼–è¾‘å¢å¼ºè§£å†³æ–¹æ¡ˆã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ™ºèƒ½ç¼–è¾‘å™¨
- åŸºäº Editor.js çš„ç°ä»£åŒ–å¯Œæ–‡æœ¬ç¼–è¾‘ä½“éªŒ
- æ”¯æŒæ ‡é¢˜ã€æ®µè½ã€å¼•ç”¨ã€åˆ—è¡¨ã€å›¾ç‰‡ã€ä»£ç ç­‰ä¸°å¯Œå†…å®¹ç±»å‹
- å®Œæ•´çš„å†…è”æ ·å¼æ”¯æŒï¼ˆç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€æ ‡è®°ç­‰ï¼‰
- æ‹–æ‹½æ’åºå’Œé”®ç›˜å¿«æ·é”®æ”¯æŒ

### ğŸ–¼ï¸ å¾®ä¿¡å›¾ç‰‡å·¥å…·
- ä¸“ä¸ºå¾®ä¿¡å…¬ä¼—å¹³å°ä¼˜åŒ–çš„å›¾ç‰‡ä¸Šä¼ å’Œç®¡ç†
- æ”¯æŒæœ¬åœ°å›¾ç‰‡ä¸Šä¼ å’Œç´ æåº“å›¾ç‰‡é€‰æ‹©
- å›¾ç‰‡æ ¼å¼éªŒè¯å’ŒçŠ¶æ€ç®¡ç†

### ğŸ“‹ ä¾§è¾¹æ ç®¡ç†
- ä¾¿æ·çš„å†…å®¹ç®¡ç†å’Œå¯¼èˆªç•Œé¢
- å®æ—¶é¢„è§ˆåŠŸèƒ½
- å·¥å…·é¢æ¿å’Œè®¾ç½®ç®¡ç†

### ğŸ“š å†å²æ–‡ç« ç®¡ç†
- æ–‡ç« å†å²è®°å½•å­˜å‚¨
- æ”¯æŒæ–‡ç« çŠ¶æ€è·Ÿè¸ªï¼ˆè‰ç¨¿ã€å·²å‘å¸ƒç­‰ï¼‰
- æœç´¢å’Œæ’åºåŠŸèƒ½
- å…ƒæ•°æ®ç®¡ç†

### ğŸ”§ HTML è§£æè½¬æ¢
- é«˜æ•ˆçš„ EditorJS æ•°æ®ä¸ HTML åŒå‘è½¬æ¢
- æ¨¡æ¿åŒ–æ¸²æŸ“ç³»ç»Ÿ
- å†…è”æ ·å¼å¤„ç†
- å®‰å…¨çš„ HTML è¾“å‡º

### ğŸ¯ æ— ç¼é›†æˆ
- ä¸å¾®ä¿¡å…¬ä¼—å¹³å°ç¼–è¾‘å™¨å®Œç¾èåˆ
- åŸºäº postMessage çš„å®‰å…¨é€šä¿¡
- ä¸å¹²æ‰°åŸç”Ÿç¼–è¾‘å™¨åŠŸèƒ½

## å®‰è£…ä½¿ç”¨

### å¼€å‘ç¯å¢ƒå®‰è£…

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd flowedit
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **æ„å»ºé¡¹ç›®**
```bash
npm run build
```

4. **åŠ è½½æ‰©å±•**
- æ‰“å¼€ Chrome æµè§ˆå™¨
- è¿›å…¥ `chrome://extensions/`
- å¼€å¯ã€Œå¼€å‘è€…æ¨¡å¼ã€
- ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€
- é€‰æ‹©é¡¹ç›®çš„ `dist` ç›®å½•

### ä½¿ç”¨æ–¹æ³•

1. å®‰è£…æ‰©å±•åï¼Œè®¿é—®å¾®ä¿¡å…¬ä¼—å¹³å°ç¼–è¾‘å™¨ï¼ˆ`https://mp.weixin.qq.com/cgi-bin/appmsg*`ï¼‰
2. FlowEdit ä¼šè‡ªåŠ¨æ£€æµ‹ç¼–è¾‘å™¨å°±ç»ªçŠ¶æ€å¹¶æ¿€æ´»
3. ä½¿ç”¨ä¾§è¾¹æ ç®¡ç†å†…å®¹å’Œå·¥å…·
4. äº«å—ç°ä»£åŒ–çš„å†…å®¹åˆ›ä½œä½“éªŒ

## é¡¹ç›®æ¶æ„

### æ’ä»¶åŒ–æ¶æ„è®¾è®¡

FlowEdit é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ‰€æœ‰åŠŸèƒ½æ¨¡å—éƒ½éµå¾ªç»Ÿä¸€çš„æ’ä»¶æ¥å£ï¼š

```javascript
// æ ‡å‡†æ’ä»¶æ¥å£
export default {
  async initialize() {
    // åŠŸèƒ½åˆå§‹åŒ–é€»è¾‘
  },
  cleanup() {
    // èµ„æºæ¸…ç†
  },
  isEnabled() {
    // å¯é€‰ï¼šåŠŸèƒ½å¼€å…³æ£€æŸ¥
    return true;
  }
};
```

### æ ¸å¿ƒç›®å½•ç»“æ„

```
src/content/
â”œâ”€â”€ main.js                    # ä¸»å…¥å£æ–‡ä»¶å’Œæ’ä»¶ç¼–æ’
â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ index.js              # Editor.js é…ç½®å’Œå·¥å…·è®¾ç½®
â”‚   â””â”€â”€ debug-config.js       # è°ƒè¯•æ¨¡å¼é…ç½®
â”œâ”€â”€ features/                  # åŠŸèƒ½æ¨¡å—ï¼ˆæ’ä»¶ï¼‰
â”‚   â”œâ”€â”€ smart-editor/          # æ™ºèƒ½ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ index.js          # æ’ä»¶å…¥å£
â”‚   â”‚   â”œâ”€â”€ manager.js        # ç¼–è¾‘å™¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ editor-ui.js      # UI ç»„ä»¶
â”‚   â”‚   â””â”€â”€ smart-button.js   # æ™ºèƒ½æŒ‰é’®
â”‚   â”œâ”€â”€ sidebar/               # ä¾§è¾¹æ ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.js          # æ’ä»¶å…¥å£
â”‚   â”‚   â”œâ”€â”€ manager.js        # ä¾§è¾¹æ ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ preview.js        # é¢„è§ˆåŠŸèƒ½
â”‚   â”‚   â””â”€â”€ sidebar-toggle.js # åˆ‡æ¢ç»„ä»¶
â”‚   â””â”€â”€ history-sidebar/       # å†å²æ–‡ç« ç®¡ç†
â”‚       â”œâ”€â”€ index.js          # æ’ä»¶å…¥å£
â”‚       â”œâ”€â”€ manager.js        # å†å²ç®¡ç†
â”‚       â”œâ”€â”€ history-sidebar.js # ä¾§è¾¹æ ç»„ä»¶
â”‚       â””â”€â”€ history-sidebar-toggle.js # åˆ‡æ¢ç»„ä»¶
â”œâ”€â”€ services/                  # æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ plugin-registry.js     # æ’ä»¶æ³¨å†Œç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ system-initializer.js  # åº”ç”¨æœåŠ¡åˆå§‹åŒ–
â”‚   â”œâ”€â”€ dom-monitor.js         # DOM å˜åŒ–ç›‘æ§
â”‚   â”œâ”€â”€ editor-bridge.js       # å¾®ä¿¡ç¼–è¾‘å™¨ API æ¡¥æ¥
â”‚   â””â”€â”€ simple-logger.js       # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ tools/                     # è‡ªå®šä¹‰ Editor.js å·¥å…·
â”‚   â””â”€â”€ custom-wechat-image-tool.js # å¾®ä¿¡å›¾ç‰‡å·¥å…·
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°å’Œè¾…åŠ©æ¨¡å—
â”‚   â”œâ”€â”€ parsers/               # HTML è½¬æ¢ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ index.js          # ä¸»è½¬æ¢å™¨
â”‚   â”‚   â”œâ”€â”€ TemplateLoader.js # æ¨¡æ¿åŠ è½½å™¨
â”‚   â”‚   â”œâ”€â”€ InlineStyleProcessor.js # å†…è”æ ·å¼å¤„ç†
â”‚   â”‚   â”œâ”€â”€ Renderer.js       # æ¸²æŸ“å¼•æ“
â”‚   â”‚   â”œâ”€â”€ BlockRendererRegistry.js # å—æ¸²æŸ“å™¨æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ renderers/        # å…·ä½“çš„å—æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ storage/               # å­˜å‚¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ index.js          # å­˜å‚¨æœåŠ¡å…¥å£
â”‚   â”‚   â”œâ”€â”€ browser-storage.js # æµè§ˆå™¨å­˜å‚¨æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ article-storage.js # æ–‡ç« å­˜å‚¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ article-serializer.js # æ–‡ç« åºåˆ—åŒ–
â”‚   â”œâ”€â”€ dom.js                # DOM æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ editor.js             # ç¼–è¾‘å™¨å·¥å…·
â”‚   â””â”€â”€ toast.js              # é€šçŸ¥ç»„ä»¶
â””â”€â”€ editorjs-bundle.js         # Editor.js ä¾èµ–åŒ…
```

### æŠ€æœ¯æ ˆ

- **æ ¸å¿ƒæ¡†æ¶**: Editor.js - ç°ä»£åŒ–å—çº§ç¼–è¾‘å™¨
- **æ„å»ºå·¥å…·**: Vite - å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·
- **æ‰©å±•å¹³å°**: Chrome Extension Manifest V3
- **æ¨¡å—ç³»ç»Ÿ**: ES6 Modules
- **æ ·å¼ç³»ç»Ÿ**: CSS + åŠ¨æ€æ ·å¼æ³¨å…¥
- **å­˜å‚¨ç³»ç»Ÿ**: Chrome Extension Storage API

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. ç³»ç»Ÿåˆå§‹åŒ– (`src/content/main.js`)
- æ’ä»¶æ³¨å†Œå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- ç¼–è¾‘å™¨æ¡¥æ¥æœåŠ¡åˆå§‹åŒ–
- WeChat ç¼–è¾‘å™¨å°±ç»ªçŠ¶æ€æ£€æŸ¥
- DOM ç›‘æ§æœåŠ¡å¯åŠ¨
- è°ƒè¯•æ¨¡å¼é”™è¯¯å¤„ç†

### 2. æ’ä»¶æ³¨å†Œç³»ç»Ÿ (`src/content/services/plugin-registry.js`)
- æ ‡å‡†åŒ–æ’ä»¶æ¥å£ç®¡ç†
- æ’ä»¶ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼ˆæ³¨å†Œã€åˆå§‹åŒ–ã€æ¸…ç†ï¼‰
- æ‰¹é‡æ“ä½œæ”¯æŒ
- åˆå§‹åŒ–çŠ¶æ€è·Ÿè¸ª
- è¯¦ç»†çš„çŠ¶æ€æŠ¥å‘Š

### 3. ç¼–è¾‘å™¨æ¡¥æ¥ (`src/content/services/editor-bridge.js`)
- é¡µé¢è„šæœ¬æ³¨å…¥å’Œé€šä¿¡æ¡¥æ¥
- å¾®ä¿¡ç¼–è¾‘å™¨ API è°ƒç”¨å°è£…
- postMessage å®‰å…¨é€šä¿¡
- å¼‚æ­¥å›è°ƒå¤„ç†
- å¾®ä¿¡æ•°æ®è®¿é—®æ¥å£

### 4. å­˜å‚¨æ¶æ„ (`src/content/utils/storage/`)
- å¤šå±‚å­˜å‚¨æŠ½è±¡
- æ–‡ç« æ•°æ®åºåˆ—åŒ–å’Œå…ƒæ•°æ®ç®¡ç†
- æœç´¢å’Œæ’åºåŠŸèƒ½
- çŠ¶æ€è·Ÿè¸ªæ”¯æŒ

### 5. HTML è½¬æ¢ç³»ç»Ÿ (`src/content/utils/parsers/`)
- EditorJS æ•°æ®ä¸ HTML åŒå‘è½¬æ¢
- æ¨¡æ¿åŒ–æ¸²æŸ“å¼•æ“
- å—ç±»å‹æ¸²æŸ“å™¨æ³¨å†Œè¡¨
- å†…è”æ ·å¼å¤„ç†
- å®‰å…¨çš„ HTML è¾“å‡º

### 6. æ—¥å¿—ç³»ç»Ÿ (`src/content/services/simple-logger.js`)
- æ¨¡å—åŒ–æ—¥å¿—è®°å½•
- è°ƒè¯•æ¨¡å¼æ”¯æŒ
- é›†ä¸­åŒ–é…ç½®ç®¡ç†

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

1. **åˆ›å»ºæ’ä»¶ç›®å½•**
```bash
mkdir src/content/features/new-feature
```

2. **å®ç°æ’ä»¶æ¥å£**
```javascript
// src/content/features/new-feature/index.js
export default {
  async initialize() {
    console.log('æ–°åŠŸèƒ½åˆå§‹åŒ–');
    // åŠŸèƒ½åˆå§‹åŒ–é€»è¾‘
  },
  cleanup() {
    console.log('æ–°åŠŸèƒ½æ¸…ç†');
    // èµ„æºæ¸…ç†é€»è¾‘
  },
  isEnabled() {
    return true; // å¯é€‰ï¼šåŠŸèƒ½å¼€å…³
  }
};
```

3. **æ³¨å†Œæ’ä»¶**
```javascript
// src/content/main.js
import newFeaturePlugin from "./features/new-feature/index.js";
pluginRegistry.register("new-feature", newFeaturePlugin);
```

### æ·»åŠ  Editor.js å·¥å…·

1. **å¯¼å…¥å·¥å…·åˆ° bundle**
```javascript
// src/editorjs-bundle.js
import NewTool from 'new-editorjs-tool';
EditorJS.NewTool = NewTool;
```

2. **é…ç½®å·¥å…·**
```javascript
// src/content/config/index.js
export const editorConfig = {
  tools: {
    newTool: {
      class: "NewTool",
      config: {
        // å·¥å…·é…ç½®
      }
    }
  }
};
```

### ä½¿ç”¨å­˜å‚¨ç³»ç»Ÿ

```javascript
import { storage } from '../utils/storage/index.js';

// ä¿å­˜æ–‡ç« 
await storage.saveArticle(editorData, {
  title: 'æ–‡ç« æ ‡é¢˜',
  status: 'draft',
  tags: ['æ ‡ç­¾1', 'æ ‡ç­¾2']
});

// è·å–æ–‡ç« åˆ—è¡¨
const articles = await storage.getArticles({
  sortBy: 'updatedAt',
  sortOrder: 'desc'
});

// æœç´¢æ–‡ç« 
const results = await storage.searchArticles('å…³é”®è¯');
```

### HTML è½¬æ¢

```javascript
import { convertToHtml } from '../utils/parsers/index.js';

// è½¬æ¢ EditorJS æ•°æ®ä¸º HTML
const html = convertToHtml(editorData, styleTemplate);
```

### æ—¥å¿—è®°å½•

```javascript
import { createLogger } from '../services/simple-logger.js';

const logger = createLogger('ModuleName');
logger.info('ä¿¡æ¯æ—¥å¿—');
logger.warn('è­¦å‘Šæ—¥å¿—');
logger.error('é”™è¯¯æ—¥å¿—', error);
```

## æ„å»ºå’Œéƒ¨ç½²

### æ„å»ºé…ç½® (Vite)

é¡¹ç›®ä½¿ç”¨ Vite è¿›è¡Œæ„å»ºï¼Œé…ç½®ç‰¹ç‚¹ï¼š
- ä¸¤ä¸ªä¸»è¦å…¥å£ç‚¹ï¼š`main.js` å’Œ `editorjs-bundle.js`
- ç¦ç”¨ä»£ç åˆ†å‰²ï¼Œç¡®ä¿å•æ–‡ä»¶è¾“å‡º
- è‡ªåŠ¨å¤åˆ¶ manifestã€assets å’Œ scripts
- æ”¯æŒ ES6 æ¨¡å—å’Œç°ä»£ JavaScript ç‰¹æ€§

### æ„å»ºå‘½ä»¤

```bash
# å¼€å‘æ„å»º
npm run build

# å®‰è£…ä¾èµ–
npm install

# è¿è¡Œæµ‹è¯•ï¼ˆå½“å‰ä¸ºæœ€å°æµ‹è¯•è®¾ç½®ï¼‰
npm test
```

## è°ƒè¯•å’Œå¼€å‘

### è°ƒè¯•æ¨¡å¼

å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š

1. **é…ç½®æ–‡ä»¶æ–¹å¼**
```javascript
// src/content/config/debug-config.js
export const DEBUG_MODE = true;
```

2. **è¿è¡Œæ—¶æ–¹å¼**
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è®¾ç½®
localStorage.setItem('flowedit_debug', 'true');
```

è°ƒè¯•æ¨¡å¼åŠŸèƒ½ï¼š
- å…¨å±€é”™è¯¯ç›‘å¬å’Œå¤„ç†
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- æ’ä»¶çŠ¶æ€è·Ÿè¸ª

### å¼€å‘å·¥å…·

- Chrome DevTools ç”¨äºè°ƒè¯•å†…å®¹è„šæœ¬
- æ‰©å±•ç®¡ç†é¡µé¢æŸ¥çœ‹åŠ è½½çŠ¶æ€
- æ§åˆ¶å°æ—¥å¿—æŸ¥çœ‹è¿è¡Œä¿¡æ¯

## æŠ€æœ¯ç»†èŠ‚

### WeChat ç¼–è¾‘å™¨é›†æˆ

- é€šè¿‡ `editor-bridge.js` ä¸å¾®ä¿¡ç¼–è¾‘å™¨ API é€šä¿¡
- ç›‘æ§ `mp_editor_get_isready` API ç¡®ä¿ç¼–è¾‘å™¨å°±ç»ª
- æ³¨å…¥ `scripts/page-injector.js` å®ç°è·¨ä¸Šä¸‹æ–‡é€šä¿¡
- ä½¿ç”¨ postMessage ç¡®ä¿å®‰å…¨çš„æ•°æ®ä¼ è¾“

### Chrome æ‰©å±•ç»“æ„

- Manifest V3 è§„èŒƒ
- å†…å®¹è„šæœ¬æ³¨å…¥åˆ°å¾®ä¿¡ç¼–è¾‘å™¨é¡µé¢
- ä½¿ç”¨ Chrome å­˜å‚¨æƒé™
- Web å¯è®¿é—®èµ„æºï¼š`scripts/page-injector.js`ã€`assets/style-template.json`

### æ¨¡å—ç³»ç»Ÿ

- å…¨é¢ä½¿ç”¨ ES6 æ¨¡å—ï¼ˆ`"type": "module"`ï¼‰
- æ’ä»¶åŒ–æ¶æ„å®ç°æ¨¡å—åŒ–
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- é¢å‘æœåŠ¡çš„æ¶æ„è®¾è®¡

## è´¡çŒ®æŒ‡å—

### æäº¤ Issue
- è¯¦ç»†æè¿°é—®é¢˜æˆ–å»ºè®®
- æä¾›å¤ç°æ­¥éª¤ï¼ˆå¦‚æœæ˜¯ Bugï¼‰
- åŒ…å«ç¯å¢ƒä¿¡æ¯ï¼ˆæµè§ˆå™¨ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ï¼‰

### æäº¤ Pull Request
- Fork é¡¹ç›®å¹¶åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
- ç¡®ä¿ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- å®ç°å¿…è¦çš„æ’ä»¶æ¥å£
- æ·»åŠ é€‚å½“çš„æ—¥å¿—è®°å½•
- æäº¤æ¸…æ™°çš„ commit ä¿¡æ¯

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ ES6+ è¯­æ³•
- éµå¾ªæ’ä»¶åŒ–è®¾è®¡åŸåˆ™
- å®ç°æ ‡å‡†æ’ä»¶æ¥å£
- æ·»åŠ æ¨¡å—åŒ–æ—¥å¿—è®°å½•
- ä¿æŒä»£ç é£æ ¼ä¸€è‡´æ€§

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

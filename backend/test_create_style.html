<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试 Create Style API</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f5f7fa; 
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .content { padding: 30px; }
        .test-section { 
            border: 1px solid #e1e8ed; 
            border-radius: 8px; 
            margin-bottom: 25px; 
            overflow: hidden;
        }
        .section-header { 
            background: #f8fafc; 
            padding: 15px 20px; 
            border-bottom: 1px solid #e1e8ed; 
            font-weight: 600; 
            color: #2c3e50;
        }
        .section-content { padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 500; 
            color: #374151; 
        }
        input, textarea { 
            width: 100%; 
            padding: 12px 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 14px; 
            transition: all 0.3s;
        }
        input:focus, textarea:focus { 
            outline: none; 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea { 
            min-height: 120px; 
            resize: vertical; 
            font-family: 'Monaco', 'Courier New', monospace;
        }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .btn:disabled { 
            background: #9ca3af; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .result { 
            background: #f8fafc; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
            white-space: pre-wrap; 
            font-family: 'Monaco', 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 400px; 
            overflow-y: auto;
        }
        .success { border-color: #10b981; background-color: #ecfdf5; }
        .error { border-color: #ef4444; background-color: #fef2f2; }
        .warning { border-color: #f59e0b; background-color: #fffbeb; }
        .status { 
            padding: 8px 12px; 
            border-radius: 6px; 
            font-size: 12px; 
            font-weight: 600; 
            margin-bottom: 15px;
        }
        .status.loading { background: #dbeafe; color: #1d4ed8; }
        .status.success { background: #dcfce7; color: #166534; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .preview-section { 
            background: #ffffff; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
        }
        .preview-header { 
            color: #374151; 
            font-weight: 600; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid #e5e7eb;
        }
        .quick-tests { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        .quick-test { 
            background: #f1f5f9; 
            padding: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center;
            font-size: 13px;
        }
        .quick-test:hover { background: #e2e8f0; }
        .api-info { 
            background: #eff6ff; 
            border-left: 4px solid #3b82f6; 
            padding: 15px; 
            margin-bottom: 25px; 
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 Create Style API 测试器</h1>
            <p>创建新的风格主题并生成样式化HTML内容</p>
        </div>

        <div class="content">
            <div class="api-info">
                <strong>API端点:</strong> POST /api/v1/styles/create<br>
                <strong>功能:</strong> 根据用户提供的风格描述，生成新的风格DNA（仅返回数据结构，不处理具体内容）
            </div>

            <div class="test-section">
                <div class="section-header">📝 API配置</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="apiBase">API基础地址</label>
                        <input type="text" id="apiBase" value="http://localhost:8000/api" placeholder="http://localhost:8000/api">
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">🚀 快速风格测试</div>
                <div class="section-content">
                    <div class="quick-tests">
                        <div class="quick-test" onclick="loadStyleCase('minimal')">极简商务</div>
                        <div class="quick-test" onclick="loadStyleCase('tech')">科技未来</div>
                        <div class="quick-test" onclick="loadStyleCase('elegant')">优雅文艺</div>
                        <div class="quick-test" onclick="loadStyleCase('vibrant')">活力动感</div>
                        <div class="quick-test" onclick="loadStyleCase('professional')">专业权威</div>
                        <div class="quick-test" onclick="loadStyleCase('creative')">创意设计</div>
                        <div class="quick-test" onclick="loadStyleCase('simple')">简单测试</div>
                    </div>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 14px; color: #0c4a6e;">
                        💡 <strong>提示：</strong>只需要选择风格特征描述，不需要输入具体内容，API将只生成样式DNA配置！
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">📋 请求参数</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="themeName">主题名称 (theme_name)</label>
                        <input type="text" id="themeName" placeholder="例如：现代简约、商务专业、文艺清新" value="测试风格">
                    </div>

                    <div class="form-group">
                        <label for="themeDescription">主题描述 (theme_description)</label>
                        <textarea id="themeDescription" placeholder="详细描述风格特点，如颜色偏好、字体风格、布局特点等">简洁现代的设计风格，使用蓝色系配色，清爽的字体，适合商务和技术内容展示</textarea>
                    </div>

                </div>
            </div>

            <div class="test-section">
                <div class="section-header">🔧 执行测试</div>
                <div class="section-content">
                    <button class="btn" onclick="testCreateStyle()" id="testBtn">
                        🧬 创建样式DNA (仅返回数据结构)
                    </button>
                    
                    <div id="status"></div>
                    <div id="result" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="test-section" id="styleDnaSection" style="display: none;">
                <div class="section-header">🧬 生成的样式DNA</div>
                <div class="section-content">
                    <div class="preview-section">
                        <div class="preview-header">最终组装的样式DNA配置</div>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; font-size: 13px; color: #64748b; margin-bottom: 15px;">
                            💡 <strong>说明:</strong> 显示通过分步生成和代码组装后的完整样式DNA配置，包含30+个样式规则。大模型的分步输出过程可以在后端日志中查看。
                            <br><br>
                            🔍 <strong>生成流程:</strong> 
                            <br>1. 大模型生成配色方案 (6个颜色参数)
                            <br>2. 大模型生成字体参数 (7个排版参数) 
                            <br>3. Python代码基于参数组装完整样式DNA (30+个样式配置)
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="font-size: 14px; color: #374151;">
                                <strong>样式配置总数:</strong> <span id="styleCount">-</span> 个
                            </div>
                            <button onclick="copyStyleDNA()" class="btn" style="padding: 8px 16px; font-size: 12px; margin: 0;">📋 复制配置</button>
                        </div>
                        <pre id="styleDnaDisplay" style="background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; font-size: 12px; overflow-x: auto; white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentApiBase = 'http://localhost:8000/api';

        // 更新API基础地址
        document.getElementById('apiBase').addEventListener('change', function() {
            currentApiBase = this.value;
        });

        // 风格测试用例数据
        const stylesCases = {
            minimal: {
                themeName: '极简商务',
                themeDescription: '极简主义设计理念，使用黑白灰经典配色，简洁的线条和大量留白，专注内容表达，适合商务和专业场景'
            },
            tech: {
                themeName: '科技未来',
                themeDescription: '现代科技感设计，深蓝色渐变背景，霓虹蓝色强调色，几何线条装饰，体现创新和技术前沿感'
            },
            elegant: {
                themeName: '优雅文艺',
                themeDescription: '文艺优雅风格，温暖的米色和深棕色搭配，优雅的衬线字体，适度的装饰元素，营造知性和文艺氛围'
            },
            vibrant: {
                themeName: '活力动感',
                themeDescription: '充满活力的设计，橙红色和黄色的撞色搭配，动感的渐变效果，现代化的无衬线字体，适合活动和推广'
            },
            professional: {
                themeName: '专业权威',
                themeDescription: '权威专业风格，深蓝色主色调配合金色点缀，稳重的字体选择，严谨的排版，体现专业性和可信度'
            },
            creative: {
                themeName: '创意设计',
                themeDescription: '创意十足的设计风格，多彩渐变色彩，不规则几何图形装饰，现代艺术感排版，展现创新和想象力'
            },
            simple: {
                themeName: '简单测试',
                themeDescription: '简单的测试风格，用于调试API',
                content: '# 简单测试内容\n\n## 这是一个简单的标题\n\n这是一个测试段落，用于验证API是否正常工作。\n\n### 子标题\n\n- 列表项目1\n- 列表项目2\n- 列表项目3\n\n这是另一个段落，**包含加粗文字**和*斜体文字*。'
            }
        };

        // 加载风格测试用例
        function loadStyleCase(type) {
            const styleCase = stylesCases[type];
            if (styleCase) {
                document.getElementById('themeName').value = styleCase.themeName;
                document.getElementById('themeDescription').value = styleCase.themeDescription;
                showStatus('已加载风格用例: ' + styleCase.themeName, 'success');
            }
        }

        // 显示状态
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // 显示结果
        function showResult(data, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const styleDnaSection = document.getElementById('styleDnaSection');
            const styleDnaDisplay = document.getElementById('styleDnaDisplay');
            const styleCount = document.getElementById('styleCount');
            
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            
            if (isSuccess && data.style_dna) {
                // 计算样式配置数量
                const styleConfigCount = Object.keys(data.style_dna).filter(key => key.endsWith('_styles')).length;
                
                // 显示样式DNA在专用区域
                styleDnaDisplay.textContent = JSON.stringify(data.style_dna, null, 2);
                styleCount.textContent = styleConfigCount;
                styleDnaSection.style.display = 'block';
                
                // 在结果区域显示成功摘要
                resultDiv.innerHTML = `<div style="color: #059669; font-weight: 600; margin-bottom: 10px;">✅ 样式DNA创建成功！</div>
<div style="font-size: 14px; color: #374151;">
<strong>主题名称:</strong> ${data.theme_name || '未知'}<br>
<strong>是否有效:</strong> ${data.is_valid ? '✅ 是' : '❌ 否'}<br>
<strong>配置数量:</strong> ${styleConfigCount} 个样式规则<br>
<strong>数据状态:</strong> 已保存到数据库<br>
<strong>详细配置:</strong> 请查看下方样式DNA结构
</div>`;
            } else if (isSuccess && !data.style_dna) {
                // 如果成功但没有style_dna，显示完整响应
                resultDiv.textContent = JSON.stringify(data, null, 2);
                styleDnaSection.style.display = 'none';
            } else {
                // 错误时显示完整响应
                resultDiv.textContent = JSON.stringify(data, null, 2);
                styleDnaSection.style.display = 'none';
            }
        }

        // 复制样式DNA到剪贴板
        function copyStyleDNA() {
            const styleDnaDisplay = document.getElementById('styleDnaDisplay');
            const textToCopy = styleDnaDisplay.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showStatus('✅ 样式DNA已复制到剪贴板', 'success');
                }).catch(err => {
                    console.error('复制失败:', err);
                    showStatus('❌ 复制失败', 'error');
                });
            } else {
                // 兼容旧浏览器
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showStatus('✅ 样式DNA已复制到剪贴板', 'success');
                } catch (err) {
                    console.error('复制失败:', err);
                    showStatus('❌ 复制失败', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // 执行API测试
        async function testCreateStyle() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = '⏳ 正在测试...';
            
            showStatus('正在发送请求到 Create Style API...', 'loading');
            
            try {
                const requestData = {
                    theme_name: document.getElementById('themeName').value,
                    theme_description: document.getElementById('themeDescription').value
                };

                console.log('发送请求:', requestData);
                
                const response = await fetch(`${currentApiBase}/v1/styles/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                console.log('收到响应:', result);

                if (response.ok) {
                    showStatus('✅ API测试成功完成！', 'success');
                    showResult(result, true);
                } else {
                    showStatus(`❌ API测试失败: ${response.status}`, 'error');
                    showResult(result, false);
                }

            } catch (error) {
                console.error('请求错误:', error);
                showStatus('❌ 网络请求失败: ' + error.message, 'error');
                showResult({ error: error.message, stack: error.stack }, false);
            } finally {
                btn.disabled = false;
                btn.textContent = '🧬 创建样式DNA (仅返回数据结构)';
            }
        }

        // 页面加载时显示提示
        window.onload = function() {
            showStatus('准备就绪！输入风格描述开始生成样式DNA', 'success');
            // 默认加载极简商务风格
            loadStyleCase('minimal');
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯• Create Style API</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f5f7fa; 
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .content { padding: 30px; }
        .test-section { 
            border: 1px solid #e1e8ed; 
            border-radius: 8px; 
            margin-bottom: 25px; 
            overflow: hidden;
        }
        .section-header { 
            background: #f8fafc; 
            padding: 15px 20px; 
            border-bottom: 1px solid #e1e8ed; 
            font-weight: 600; 
            color: #2c3e50;
        }
        .section-content { padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 500; 
            color: #374151; 
        }
        input, textarea { 
            width: 100%; 
            padding: 12px 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 14px; 
            transition: all 0.3s;
        }
        input:focus, textarea:focus { 
            outline: none; 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea { 
            min-height: 120px; 
            resize: vertical; 
            font-family: 'Monaco', 'Courier New', monospace;
        }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); }
        .btn:disabled { 
            background: #9ca3af; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .result { 
            background: #f8fafc; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
            white-space: pre-wrap; 
            font-family: 'Monaco', 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 400px; 
            overflow-y: auto;
        }
        .success { border-color: #10b981; background-color: #ecfdf5; }
        .error { border-color: #ef4444; background-color: #fef2f2; }
        .warning { border-color: #f59e0b; background-color: #fffbeb; }
        .status { 
            padding: 8px 12px; 
            border-radius: 6px; 
            font-size: 12px; 
            font-weight: 600; 
            margin-bottom: 15px;
        }
        .status.loading { background: #dbeafe; color: #1d4ed8; }
        .status.success { background: #dcfce7; color: #166534; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .preview-section { 
            background: #ffffff; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
        }
        .preview-header { 
            color: #374151; 
            font-weight: 600; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid #e5e7eb;
        }
        .quick-tests { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        .quick-test { 
            background: #f1f5f9; 
            padding: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center;
            font-size: 13px;
        }
        .quick-test:hover { background: #e2e8f0; }
        .api-info { 
            background: #eff6ff; 
            border-left: 4px solid #3b82f6; 
            padding: 15px; 
            margin-bottom: 25px; 
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ Create Style API æµ‹è¯•å™¨</h1>
            <p>åˆ›å»ºæ–°çš„é£æ ¼ä¸»é¢˜å¹¶ç”Ÿæˆæ ·å¼åŒ–HTMLå†…å®¹</p>
        </div>

        <div class="content">
            <div class="api-info">
                <strong>APIç«¯ç‚¹:</strong> POST /api/v1/styles/create<br>
                <strong>åŠŸèƒ½:</strong> æ ¹æ®ç”¨æˆ·æä¾›çš„é£æ ¼æè¿°ï¼Œç”Ÿæˆæ–°çš„é£æ ¼DNAï¼ˆä»…è¿”å›æ•°æ®ç»“æ„ï¼Œä¸å¤„ç†å…·ä½“å†…å®¹ï¼‰
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ“ APIé…ç½®</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="apiBase">APIåŸºç¡€åœ°å€</label>
                        <input type="text" id="apiBase" value="http://localhost:8000/api" placeholder="http://localhost:8000/api">
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸš€ å¿«é€Ÿé£æ ¼æµ‹è¯•</div>
                <div class="section-content">
                    <div class="quick-tests">
                        <div class="quick-test" onclick="loadStyleCase('minimal')">æç®€å•†åŠ¡</div>
                        <div class="quick-test" onclick="loadStyleCase('tech')">ç§‘æŠ€æœªæ¥</div>
                        <div class="quick-test" onclick="loadStyleCase('elegant')">ä¼˜é›…æ–‡è‰º</div>
                        <div class="quick-test" onclick="loadStyleCase('vibrant')">æ´»åŠ›åŠ¨æ„Ÿ</div>
                        <div class="quick-test" onclick="loadStyleCase('professional')">ä¸“ä¸šæƒå¨</div>
                        <div class="quick-test" onclick="loadStyleCase('creative')">åˆ›æ„è®¾è®¡</div>
                        <div class="quick-test" onclick="loadStyleCase('simple')">ç®€å•æµ‹è¯•</div>
                    </div>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 14px; color: #0c4a6e;">
                        ğŸ’¡ <strong>æç¤ºï¼š</strong>åªéœ€è¦é€‰æ‹©é£æ ¼ç‰¹å¾æè¿°ï¼Œä¸éœ€è¦è¾“å…¥å…·ä½“å†…å®¹ï¼ŒAPIå°†åªç”Ÿæˆæ ·å¼DNAé…ç½®ï¼
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ“‹ è¯·æ±‚å‚æ•°</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="themeName">ä¸»é¢˜åç§° (theme_name)</label>
                        <input type="text" id="themeName" placeholder="ä¾‹å¦‚ï¼šç°ä»£ç®€çº¦ã€å•†åŠ¡ä¸“ä¸šã€æ–‡è‰ºæ¸…æ–°" value="æµ‹è¯•é£æ ¼">
                    </div>

                    <div class="form-group">
                        <label for="themeDescription">ä¸»é¢˜æè¿° (theme_description)</label>
                        <textarea id="themeDescription" placeholder="è¯¦ç»†æè¿°é£æ ¼ç‰¹ç‚¹ï¼Œå¦‚é¢œè‰²åå¥½ã€å­—ä½“é£æ ¼ã€å¸ƒå±€ç‰¹ç‚¹ç­‰">ç®€æ´ç°ä»£çš„è®¾è®¡é£æ ¼ï¼Œä½¿ç”¨è“è‰²ç³»é…è‰²ï¼Œæ¸…çˆ½çš„å­—ä½“ï¼Œé€‚åˆå•†åŠ¡å’ŒæŠ€æœ¯å†…å®¹å±•ç¤º</textarea>
                    </div>

                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ”§ æ‰§è¡Œæµ‹è¯•</div>
                <div class="section-content">
                    <button class="btn" onclick="testCreateStyle()" id="testBtn">
                        ğŸ§¬ åˆ›å»ºæ ·å¼DNA (ä»…è¿”å›æ•°æ®ç»“æ„)
                    </button>
                    
                    <div id="status"></div>
                    <div id="result" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="test-section" id="styleDnaSection" style="display: none;">
                <div class="section-header">ğŸ§¬ ç”Ÿæˆçš„æ ·å¼DNA</div>
                <div class="section-content">
                    <div class="preview-section">
                        <div class="preview-header">æœ€ç»ˆç»„è£…çš„æ ·å¼DNAé…ç½®</div>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; font-size: 13px; color: #64748b; margin-bottom: 15px;">
                            ğŸ’¡ <strong>è¯´æ˜:</strong> æ˜¾ç¤ºé€šè¿‡åˆ†æ­¥ç”Ÿæˆå’Œä»£ç ç»„è£…åçš„å®Œæ•´æ ·å¼DNAé…ç½®ï¼ŒåŒ…å«30+ä¸ªæ ·å¼è§„åˆ™ã€‚å¤§æ¨¡å‹çš„åˆ†æ­¥è¾“å‡ºè¿‡ç¨‹å¯ä»¥åœ¨åç«¯æ—¥å¿—ä¸­æŸ¥çœ‹ã€‚
                            <br><br>
                            ğŸ” <strong>ç”Ÿæˆæµç¨‹:</strong> 
                            <br>1. å¤§æ¨¡å‹ç”Ÿæˆé…è‰²æ–¹æ¡ˆ (6ä¸ªé¢œè‰²å‚æ•°)
                            <br>2. å¤§æ¨¡å‹ç”Ÿæˆå­—ä½“å‚æ•° (7ä¸ªæ’ç‰ˆå‚æ•°) 
                            <br>3. Pythonä»£ç åŸºäºå‚æ•°ç»„è£…å®Œæ•´æ ·å¼DNA (30+ä¸ªæ ·å¼é…ç½®)
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="font-size: 14px; color: #374151;">
                                <strong>æ ·å¼é…ç½®æ€»æ•°:</strong> <span id="styleCount">-</span> ä¸ª
                            </div>
                            <button onclick="copyStyleDNA()" class="btn" style="padding: 8px 16px; font-size: 12px; margin: 0;">ğŸ“‹ å¤åˆ¶é…ç½®</button>
                        </div>
                        <pre id="styleDnaDisplay" style="background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; font-size: 12px; overflow-x: auto; white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentApiBase = 'http://localhost:8000/api';

        // æ›´æ–°APIåŸºç¡€åœ°å€
        document.getElementById('apiBase').addEventListener('change', function() {
            currentApiBase = this.value;
        });

        // é£æ ¼æµ‹è¯•ç”¨ä¾‹æ•°æ®
        const stylesCases = {
            minimal: {
                themeName: 'æç®€å•†åŠ¡',
                themeDescription: 'æç®€ä¸»ä¹‰è®¾è®¡ç†å¿µï¼Œä½¿ç”¨é»‘ç™½ç°ç»å…¸é…è‰²ï¼Œç®€æ´çš„çº¿æ¡å’Œå¤§é‡ç•™ç™½ï¼Œä¸“æ³¨å†…å®¹è¡¨è¾¾ï¼Œé€‚åˆå•†åŠ¡å’Œä¸“ä¸šåœºæ™¯'
            },
            tech: {
                themeName: 'ç§‘æŠ€æœªæ¥',
                themeDescription: 'ç°ä»£ç§‘æŠ€æ„Ÿè®¾è®¡ï¼Œæ·±è“è‰²æ¸å˜èƒŒæ™¯ï¼Œéœ“è™¹è“è‰²å¼ºè°ƒè‰²ï¼Œå‡ ä½•çº¿æ¡è£…é¥°ï¼Œä½“ç°åˆ›æ–°å’ŒæŠ€æœ¯å‰æ²¿æ„Ÿ'
            },
            elegant: {
                themeName: 'ä¼˜é›…æ–‡è‰º',
                themeDescription: 'æ–‡è‰ºä¼˜é›…é£æ ¼ï¼Œæ¸©æš–çš„ç±³è‰²å’Œæ·±æ£•è‰²æ­é…ï¼Œä¼˜é›…çš„è¡¬çº¿å­—ä½“ï¼Œé€‚åº¦çš„è£…é¥°å…ƒç´ ï¼Œè¥é€ çŸ¥æ€§å’Œæ–‡è‰ºæ°›å›´'
            },
            vibrant: {
                themeName: 'æ´»åŠ›åŠ¨æ„Ÿ',
                themeDescription: 'å……æ»¡æ´»åŠ›çš„è®¾è®¡ï¼Œæ©™çº¢è‰²å’Œé»„è‰²çš„æ’è‰²æ­é…ï¼ŒåŠ¨æ„Ÿçš„æ¸å˜æ•ˆæœï¼Œç°ä»£åŒ–çš„æ— è¡¬çº¿å­—ä½“ï¼Œé€‚åˆæ´»åŠ¨å’Œæ¨å¹¿'
            },
            professional: {
                themeName: 'ä¸“ä¸šæƒå¨',
                themeDescription: 'æƒå¨ä¸“ä¸šé£æ ¼ï¼Œæ·±è“è‰²ä¸»è‰²è°ƒé…åˆé‡‘è‰²ç‚¹ç¼€ï¼Œç¨³é‡çš„å­—ä½“é€‰æ‹©ï¼Œä¸¥è°¨çš„æ’ç‰ˆï¼Œä½“ç°ä¸“ä¸šæ€§å’Œå¯ä¿¡åº¦'
            },
            creative: {
                themeName: 'åˆ›æ„è®¾è®¡',
                themeDescription: 'åˆ›æ„åè¶³çš„è®¾è®¡é£æ ¼ï¼Œå¤šå½©æ¸å˜è‰²å½©ï¼Œä¸è§„åˆ™å‡ ä½•å›¾å½¢è£…é¥°ï¼Œç°ä»£è‰ºæœ¯æ„Ÿæ’ç‰ˆï¼Œå±•ç°åˆ›æ–°å’Œæƒ³è±¡åŠ›'
            },
            simple: {
                themeName: 'ç®€å•æµ‹è¯•',
                themeDescription: 'ç®€å•çš„æµ‹è¯•é£æ ¼ï¼Œç”¨äºè°ƒè¯•API',
                content: '# ç®€å•æµ‹è¯•å†…å®¹\n\n## è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ ‡é¢˜\n\nè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ®µè½ï¼Œç”¨äºéªŒè¯APIæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚\n\n### å­æ ‡é¢˜\n\n- åˆ—è¡¨é¡¹ç›®1\n- åˆ—è¡¨é¡¹ç›®2\n- åˆ—è¡¨é¡¹ç›®3\n\nè¿™æ˜¯å¦ä¸€ä¸ªæ®µè½ï¼Œ**åŒ…å«åŠ ç²—æ–‡å­—**å’Œ*æ–œä½“æ–‡å­—*ã€‚'
            }
        };

        // åŠ è½½é£æ ¼æµ‹è¯•ç”¨ä¾‹
        function loadStyleCase(type) {
            const styleCase = stylesCases[type];
            if (styleCase) {
                document.getElementById('themeName').value = styleCase.themeName;
                document.getElementById('themeDescription').value = styleCase.themeDescription;
                showStatus('å·²åŠ è½½é£æ ¼ç”¨ä¾‹: ' + styleCase.themeName, 'success');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(data, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const styleDnaSection = document.getElementById('styleDnaSection');
            const styleDnaDisplay = document.getElementById('styleDnaDisplay');
            const styleCount = document.getElementById('styleCount');
            
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            
            if (isSuccess && data.style_dna) {
                // è®¡ç®—æ ·å¼é…ç½®æ•°é‡
                const styleConfigCount = Object.keys(data.style_dna).filter(key => key.endsWith('_styles')).length;
                
                // æ˜¾ç¤ºæ ·å¼DNAåœ¨ä¸“ç”¨åŒºåŸŸ
                styleDnaDisplay.textContent = JSON.stringify(data.style_dna, null, 2);
                styleCount.textContent = styleConfigCount;
                styleDnaSection.style.display = 'block';
                
                // åœ¨ç»“æœåŒºåŸŸæ˜¾ç¤ºæˆåŠŸæ‘˜è¦
                resultDiv.innerHTML = `<div style="color: #059669; font-weight: 600; margin-bottom: 10px;">âœ… æ ·å¼DNAåˆ›å»ºæˆåŠŸï¼</div>
<div style="font-size: 14px; color: #374151;">
<strong>ä¸»é¢˜åç§°:</strong> ${data.theme_name || 'æœªçŸ¥'}<br>
<strong>æ˜¯å¦æœ‰æ•ˆ:</strong> ${data.is_valid ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
<strong>é…ç½®æ•°é‡:</strong> ${styleConfigCount} ä¸ªæ ·å¼è§„åˆ™<br>
<strong>æ•°æ®çŠ¶æ€:</strong> å·²ä¿å­˜åˆ°æ•°æ®åº“<br>
<strong>è¯¦ç»†é…ç½®:</strong> è¯·æŸ¥çœ‹ä¸‹æ–¹æ ·å¼DNAç»“æ„
</div>`;
            } else if (isSuccess && !data.style_dna) {
                // å¦‚æœæˆåŠŸä½†æ²¡æœ‰style_dnaï¼Œæ˜¾ç¤ºå®Œæ•´å“åº”
                resultDiv.textContent = JSON.stringify(data, null, 2);
                styleDnaSection.style.display = 'none';
            } else {
                // é”™è¯¯æ—¶æ˜¾ç¤ºå®Œæ•´å“åº”
                resultDiv.textContent = JSON.stringify(data, null, 2);
                styleDnaSection.style.display = 'none';
            }
        }

        // å¤åˆ¶æ ·å¼DNAåˆ°å‰ªè´´æ¿
        function copyStyleDNA() {
            const styleDnaDisplay = document.getElementById('styleDnaDisplay');
            const textToCopy = styleDnaDisplay.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showStatus('âœ… æ ·å¼DNAå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showStatus('âŒ å¤åˆ¶å¤±è´¥', 'error');
                });
            } else {
                // å…¼å®¹æ—§æµè§ˆå™¨
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showStatus('âœ… æ ·å¼DNAå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showStatus('âŒ å¤åˆ¶å¤±è´¥', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // æ‰§è¡ŒAPIæµ‹è¯•
        async function testCreateStyle() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = 'â³ æ­£åœ¨æµ‹è¯•...';
            
            showStatus('æ­£åœ¨å‘é€è¯·æ±‚åˆ° Create Style API...', 'loading');
            
            try {
                const requestData = {
                    theme_name: document.getElementById('themeName').value,
                    theme_description: document.getElementById('themeDescription').value
                };

                console.log('å‘é€è¯·æ±‚:', requestData);
                
                const response = await fetch(`${currentApiBase}/v1/styles/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                console.log('æ”¶åˆ°å“åº”:', result);

                if (response.ok) {
                    showStatus('âœ… APIæµ‹è¯•æˆåŠŸå®Œæˆï¼', 'success');
                    showResult(result, true);
                } else {
                    showStatus(`âŒ APIæµ‹è¯•å¤±è´¥: ${response.status}`, 'error');
                    showResult(result, false);
                }

            } catch (error) {
                console.error('è¯·æ±‚é”™è¯¯:', error);
                showStatus('âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message, 'error');
                showResult({ error: error.message, stack: error.stack }, false);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ§¬ åˆ›å»ºæ ·å¼DNA (ä»…è¿”å›æ•°æ®ç»“æ„)';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæç¤º
        window.onload = function() {
            showStatus('å‡†å¤‡å°±ç»ªï¼è¾“å…¥é£æ ¼æè¿°å¼€å§‹ç”Ÿæˆæ ·å¼DNA', 'success');
            // é»˜è®¤åŠ è½½æç®€å•†åŠ¡é£æ ¼
            loadStyleCase('minimal');
        };
    </script>
</body>
</html>
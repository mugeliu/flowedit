<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯• Apply Style API</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f0fdf4; 
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .content { padding: 30px; }
        .test-section { 
            border: 1px solid #e1e8ed; 
            border-radius: 8px; 
            margin-bottom: 25px; 
            overflow: hidden;
        }
        .section-header { 
            background: #f0fdf4; 
            padding: 15px 20px; 
            border-bottom: 1px solid #e1e8ed; 
            font-weight: 600; 
            color: #14532d;
        }
        .section-content { padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 500; 
            color: #374151; 
        }
        input, textarea, select { 
            width: 100%; 
            padding: 12px 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 14px; 
            transition: all 0.3s;
        }
        input:focus, textarea:focus, select:focus { 
            outline: none; 
            border-color: #10b981; 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        textarea { 
            min-height: 120px; 
            resize: vertical; 
            font-family: 'Monaco', 'Courier New', monospace;
        }
        .btn { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 16px;
            transition: all 0.3s;
            margin-right: 10px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3); }
        .btn:disabled { 
            background: #9ca3af; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .btn.secondary { 
            background: #6b7280; 
        }
        .btn.secondary:hover { 
            background: #4b5563; 
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);
        }
        .result { 
            background: #f8fafc; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
            white-space: pre-wrap; 
            font-family: 'Monaco', 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 400px; 
            overflow-y: auto;
        }
        .success { border-color: #10b981; background-color: #ecfdf5; }
        .error { border-color: #ef4444; background-color: #fef2f2; }
        .status { 
            padding: 8px 12px; 
            border-radius: 6px; 
            font-size: 12px; 
            font-weight: 600; 
            margin-bottom: 15px;
        }
        .status.loading { background: #dbeafe; color: #1d4ed8; }
        .status.success { background: #dcfce7; color: #166534; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .theme-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        .theme-card { 
            background: #f3f4f6; 
            padding: 15px 10px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center;
            border: 2px solid transparent;
        }
        .theme-card:hover { 
            background: #e5e7eb; 
            border-color: #10b981;
        }
        .theme-card.selected { 
            background: #ecfdf5; 
            border-color: #10b981; 
            color: #14532d;
        }
        .theme-card .name { font-weight: 600; font-size: 13px; }
        .theme-card .desc { font-size: 11px; margin-top: 5px; opacity: 0.7; }
        .api-info { 
            background: #f0fdf4; 
            border-left: 4px solid #10b981; 
            padding: 15px; 
            margin-bottom: 25px; 
            border-radius: 0 8px 8px 0;
        }
        .preview-section { 
            background: #ffffff; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-top: 20px; 
        }
        .preview-header { 
            color: #374151; 
            font-weight: 600; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Apply Style API æµ‹è¯•å™¨</h1>
            <p>ä½¿ç”¨å·²æœ‰é£æ ¼ä¸»é¢˜å¯¹å†…å®¹è¿›è¡Œæ ·å¼åŒ–å¤„ç†</p>
        </div>

        <div class="content">
            <div class="api-info">
                <strong>APIç«¯ç‚¹:</strong> POST /api/v1/styles/apply<br>
                <strong>åŠŸèƒ½:</strong> ä½¿ç”¨æ•°æ®åº“ä¸­å·²å­˜åœ¨çš„é£æ ¼ä¸»é¢˜ï¼Œå¯¹FlowEditå†…å®¹è¿›è¡Œæ ·å¼åŒ–å¤„ç†<br>
                <strong>å†…å®¹:</strong> ä½¿ç”¨ä¸Create Style APIç›¸åŒçš„FlowEditäº§å“ä»‹ç»å†…å®¹
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ“ APIé…ç½®</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="apiBase">APIåŸºç¡€åœ°å€</label>
                        <input type="text" id="apiBase" value="http://localhost:8000/api" placeholder="http://localhost:8000/api">
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ“š å¯ç”¨ä¸»é¢˜</div>
                <div class="section-content">
                    <button class="btn secondary" onclick="loadThemes()">ğŸ”„ åˆ·æ–°ä¸»é¢˜åˆ—è¡¨</button>
                    <div id="themesStatus" class="status" style="display:none;"></div>
                    <div class="theme-grid" id="themeGrid">
                        <div class="theme-card" onclick="selectTheme('æµ‹è¯•é£æ ¼')">
                            <div class="name">æµ‹è¯•é£æ ¼</div>
                            <div class="desc">é»˜è®¤æµ‹è¯•ä¸»é¢˜</div>
                        </div>
                    </div>
                    <input type="hidden" id="selectedTheme" value="æµ‹è¯•é£æ ¼">
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ“‹ è¯·æ±‚å‚æ•°</div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="themeName">ä¸»é¢˜åç§° (theme_name)</label>
                        <input type="text" id="themeName" placeholder="é€‰æ‹©ä¸€ä¸ªå·²åˆ›å»ºçš„ä¸»é¢˜" value="æµ‹è¯•é£æ ¼">
                        <small style="color: #6b7280;">ä»ä¸Šé¢çš„ä¸»é¢˜åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œæˆ–è€…æ‰‹åŠ¨è¾“å…¥å·²åˆ›å»ºçš„ä¸»é¢˜åç§°</small>
                    </div>

                    <div class="form-group">
                        <label for="rawContent">åŸå§‹å†…å®¹ (ä¸Create Style APIç›¸åŒçš„FlowEdité¢„è®¾å†…å®¹)</label>
                        <textarea id="rawContent" readonly style="background: #f8fafc; color: #6b7280;"># FlowEdit - é‡æ–°å®šä¹‰å¾®ä¿¡å…¬ä¼—å·å†…å®¹åˆ›ä½œä½“éªŒ

## äº§å“æ¦‚è¿°

FlowEdit æ˜¯ä¸€æ¬¾é©å‘½æ€§çš„ Chrome æµè§ˆå™¨æ‰©å±•ï¼Œä¸“ä¸ºå¾®ä¿¡å…¬ä¼—å·åˆ›ä½œè€…è®¾è®¡ã€‚é€šè¿‡æ·±åº¦é›†æˆç°ä»£åŒ–çš„ Editor.js ç¼–è¾‘å™¨å’Œ AI æ™ºèƒ½åŠŸèƒ½ï¼ŒFlowEdit å°†ä¼ ç»Ÿçš„å…¬ä¼—å·ç¼–è¾‘ä½“éªŒæå‡åˆ°å…¨æ–°é«˜åº¦ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© FlowEditï¼Ÿ

åœ¨å†…å®¹åˆ›ä½œçš„æ—¶ä»£ï¼Œ**æ•ˆç‡**å’Œ**è´¨é‡**æ˜¯æ¯ä¸ªåˆ›ä½œè€…è¿½æ±‚çš„ç›®æ ‡ã€‚FlowEdit æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€ç—›ç‚¹è€Œç”Ÿï¼š

- å‘Šåˆ«ç¹ççš„æ ¼å¼è°ƒæ•´ï¼Œä¸“æ³¨å†…å®¹æœ¬èº«
- æ™ºèƒ½åŒ–çš„æ’ç‰ˆå»ºè®®ï¼Œè®©æ–‡ç« æ›´å…·ä¸“ä¸šæ„Ÿ
- ä¸°å¯Œçš„æ¨¡æ¿åº“ï¼Œå¿«é€Ÿå¼€å¯åˆ›ä½œçµæ„Ÿ
- ä¸€é”®é£æ ¼åŒ–ï¼Œæ‰“é€ ç‹¬ç‰¹çš„å“ç‰Œå½¢è±¡

## æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### ğŸ¨ ç°ä»£åŒ–ç¼–è¾‘ä½“éªŒ

åŸºäº **Editor.js** çš„å—çº§ç¼–è¾‘å™¨ï¼Œæä¾›ï¼š

- æ‹–æ‹½å¼å†…å®¹ç»„ç»‡
- å®æ—¶é¢„è§ˆæ•ˆæœ
- å¤šåª’ä½“å†…å®¹æ”¯æŒ
- å¿«æ·é”®æ“ä½œä½“éªŒ

### ğŸ¤– AI æ™ºèƒ½è¾…åŠ©

é›†æˆå…ˆè¿›çš„äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼š

- **æ™ºèƒ½æ’ç‰ˆä¼˜åŒ–**: è‡ªåŠ¨è°ƒæ•´æ®µè½é—´è·ã€å­—ä½“æ­é…
- **é£æ ¼ä¸€è‡´æ€§**: ç¡®ä¿å…¨æ–‡é£æ ¼ç»Ÿä¸€åè°ƒ
- **å†…å®¹ç»“æ„å»ºè®®**: AI åˆ†æå†…å®¹é€»è¾‘ï¼Œæä¾›ç»“æ„ä¼˜åŒ–å»ºè®®
- **å¤šé£æ ¼é€‚é…**: å•†åŠ¡ã€æ–‡è‰ºã€ç§‘æŠ€ç­‰å¤šç§é¢„è®¾é£æ ¼

### ğŸ“± å¾®ä¿¡å¹³å°æ·±åº¦é€‚é…

å®Œç¾å…¼å®¹å¾®ä¿¡å…¬ä¼—å·å¹³å°ç‰¹æ€§ï¼š

- ä¸¥æ ¼éµå¾ªå¾®ä¿¡ HTML è§„èŒƒ
- ç§»åŠ¨ç«¯é˜…è¯»ä¼˜åŒ–
- ä¿ç•™å¹³å°åŸç”ŸåŠŸèƒ½
- æ— ç¼é›†æˆå·¥ä½œæµç¨‹

### ğŸ¯ æ™ºèƒ½ä¾§è¾¹æ ç®¡ç†

é«˜æ•ˆçš„å†…å®¹ç®¡ç†ç•Œé¢ï¼š

- **å†å²æ–‡ç« ç®¡ç†**: å¿«é€ŸæŸ¥çœ‹å’Œç¼–è¾‘å†å²å†…å®¹
- **æ¨¡æ¿åº“**: ä¸°å¯Œçš„æ–‡ç« æ¨¡æ¿ï¼Œä¸€é”®åº”ç”¨
- **é£æ ¼é¢„è®¾**: ä¿å­˜å’Œå¤ç”¨ä¸ªäººé£æ ¼é…ç½®
- **å®æ—¶é¢„è§ˆ**: æ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ä½“éªŒ

## æŠ€æœ¯æ¶æ„äº®ç‚¹

### å…ˆè¿›çš„å¤šæ„å»ºç³»ç»Ÿ

FlowEdit é‡‡ç”¨ç°ä»£åŒ–çš„å·¥ç¨‹æ¶æ„ï¼š

```
å¤šæ„å»ºé…ç½®
â”œâ”€â”€ vite.content.config.js    # å†…å®¹è„šæœ¬æ„å»º
â”œâ”€â”€ vite.editorjs.config.js   # Editor.js å·¥å…·é›†
â””â”€â”€ vite.react.config.js      # React åº”ç”¨ç•Œé¢
```

### æ’ä»¶åŒ–æ¶æ„è®¾è®¡

- **æ¨¡å—åŒ–å¼€å‘**: åŠŸèƒ½ç»„ä»¶ç‹¬ç«‹å¯æ‰©å±•
- **æ’ä»¶æ³¨å†Œæœºåˆ¶**: çµæ´»çš„åŠŸèƒ½æ‰©å±•ä½“ç³»
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: å®Œå–„çš„æ’ä»¶ç”Ÿå‘½å‘¨æœŸæ§åˆ¶

### ç°ä»£æŠ€æœ¯æ ˆ

#### å‰ç«¯æŠ€æœ¯

- **React 19** + TypeScript: ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢
- **Vite**: å¿«é€Ÿçš„æ„å»ºå’Œå¼€å‘ä½“éªŒ  
- **Tailwind CSS** + shadcn/ui: ä¸€è‡´çš„è®¾è®¡ç³»ç»Ÿ
- **Editor.js**: å¼ºå¤§çš„å—çº§ç¼–è¾‘å™¨æ ¸å¿ƒ

#### æ‰©å±•æŠ€æœ¯

- **Manifest V3**: æœ€æ–°çš„æµè§ˆå™¨æ‰©å±•æ ‡å‡†
- **Chrome APIs**: æ·±åº¦é›†æˆæµè§ˆå™¨èƒ½åŠ›
- **Service Worker**: é«˜æ•ˆçš„åå°å¤„ç†

## ä½¿ç”¨åœºæ™¯

### ğŸ’¼ ä¼ä¸šå“ç‰Œä¼ æ’­

- **å“ç‰Œä¸€è‡´æ€§**: ç»Ÿä¸€çš„è§†è§‰é£æ ¼å’Œæ’ç‰ˆæ ‡å‡†
- **ä¸“ä¸šå½¢è±¡**: ç²¾ç¾çš„ç‰ˆå¼è®¾è®¡æå‡å“ç‰Œå½¢è±¡
- **æ‰¹é‡åˆ¶ä½œ**: æ¨¡æ¿åŒ–å†…å®¹å¿«é€Ÿç”Ÿäº§

### âœï¸ ä¸ªäººå†…å®¹åˆ›ä½œ

- **åˆ›ä½œæ•ˆç‡**: æ™ºèƒ½åŒ–å·¥å…·å‡å°‘é‡å¤åŠ³åŠ¨
- **çµæ„Ÿæ¿€å‘**: ä¸°å¯Œçš„æ¨¡æ¿å’Œæ ·å¼é€‰æ‹©
- **ä¸ªæ€§è¡¨è¾¾**: è‡ªå®šä¹‰é£æ ¼å±•ç°ç‹¬ç‰¹ä¸ªæ€§

### ğŸ“š çŸ¥è¯†åˆ†äº«ä¸æ•™è‚²

- **ç»“æ„åŒ–å†…å®¹**: æ¸…æ™°çš„å±‚æ¬¡ç»“æ„ä¾¿äºé˜…è¯»ç†è§£
- **å¤šåª’ä½“æ”¯æŒ**: å›¾æ–‡å¹¶èŒ‚çš„å†…å®¹è¡¨ç°å½¢å¼
- **ç§»åŠ¨ä¼˜åŒ–**: é€‚é…æ‰‹æœºé˜…è¯»ä¹ æƒ¯

### ğŸ¯ è¥é”€æ¨å¹¿æ´»åŠ¨

- **è§†è§‰å†²å‡»**: ç²¾ç¾çš„ç‰ˆå¼è®¾è®¡æŠ“ä½è¯»è€…æ³¨æ„åŠ›
- **è½¬åŒ–ä¼˜åŒ–**: ä¸“ä¸šçš„æ’ç‰ˆæå‡å†…å®¹å¯ä¿¡åº¦
- **å¿«é€Ÿè¿­ä»£**: æ¨¡æ¿åŒ–åˆ¶ä½œæ”¯æŒè¥é”€æ´»åŠ¨å¿«é€Ÿå“åº”

## äº§å“ä¼˜åŠ¿

### ğŸš€ æ˜¾è‘—æå‡åˆ›ä½œæ•ˆç‡

- ä¼ ç»Ÿç¼–è¾‘å™¨æ“ä½œæ—¶é—´å‡å°‘ **70%**
- æ ¼å¼è°ƒæ•´å·¥ä½œé‡é™ä½ **80%**  
- å†…å®¹å‘å¸ƒå‡†å¤‡æ—¶é—´ç¼©çŸ­ **60%**

### ğŸ¨ ä¸“ä¸šçº§è§†è§‰æ•ˆæœ

- åª²ç¾ä¸“ä¸šè®¾è®¡å¸ˆçš„æ’ç‰ˆè´¨é‡
- å¤šç§é¢„è®¾é£æ ¼é€‚åº”ä¸åŒåœºæ™¯
- AI æ™ºèƒ½é…è‰²å’Œå­—ä½“æ­é…å»ºè®®

### ğŸ”§ å®Œå–„çš„å·¥å…·ç”Ÿæ€

- ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹æ’ä»¶æ”¯æŒ
- å¼€æ”¾çš„ API æ¥å£
- æ´»è·ƒçš„ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒ

### ğŸ“ˆ æ•°æ®é©±åŠ¨ä¼˜åŒ–

- è¯¦ç»†çš„ç¼–è¾‘è¡Œä¸ºåˆ†æ
- å†…å®¹æ•ˆæœè¿½è¸ª
- æŒç»­çš„äº§å“ä¼˜åŒ–è¿­ä»£

## å¼€å§‹ä½¿ç”¨ FlowEdit

### å®‰è£…æ­¥éª¤

1. **ä¸‹è½½æ‰©å±•**: ä» Chrome ç½‘ä¸Šåº”ç”¨åº—æœç´¢ "FlowEdit"
2. **å®‰è£…æ¿€æ´»**: ä¸€é”®å®‰è£…ï¼Œç«‹å³ç”Ÿæ•ˆ
3. **æ‰“å¼€å¾®ä¿¡**: è®¿é—®å¾®ä¿¡å…¬ä¼—å·åå°ç¼–è¾‘ç•Œé¢
4. **å¼€å§‹åˆ›ä½œ**: äº«å—å…¨æ–°çš„å†…å®¹åˆ›ä½œä½“éªŒ

### å¿«é€Ÿä¸Šæ‰‹

- **5åˆ†é’Ÿæ•™ç¨‹**: äº¤äº’å¼å¼•å¯¼å¿«é€ŸæŒæ¡æ ¸å¿ƒåŠŸèƒ½
- **è§†é¢‘æ•™ç¨‹**: è¯¦ç»†çš„åŠŸèƒ½æ¼”ç¤ºå’Œæœ€ä½³å®è·µ
- **ç¤¾åŒºæ”¯æŒ**: æ´»è·ƒçš„ç”¨æˆ·ç¤¾åŒºå’ŒæŠ€æœ¯æ”¯æŒ

## æœªæ¥å±•æœ›

FlowEdit è‡´åŠ›äºæˆä¸ºå†…å®¹åˆ›ä½œé¢†åŸŸçš„**æ™ºèƒ½åŠ©æ‰‹**ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘æ›´å¤šæ¿€åŠ¨äººå¿ƒçš„åŠŸèƒ½ï¼š

### å³å°†æ¨å‡º

- **AI å†…å®¹ç”Ÿæˆ**: åŸºäºä¸»é¢˜çš„æ™ºèƒ½å†…å®¹åˆ›ä½œ
- **å¤šå¹³å°æ”¯æŒ**: æ‰©å±•åˆ°æ›´å¤šå†…å®¹åˆ›ä½œå¹³å°
- **å›¢é˜Ÿåä½œ**: æ”¯æŒå¤šäººååŒç¼–è¾‘å’Œå®¡æ ¸æµç¨‹
- **æ•°æ®åˆ†æ**: æ·±åº¦çš„å†…å®¹æ•ˆæœåˆ†æå’Œä¼˜åŒ–å»ºè®®

### é•¿è¿œè§„åˆ’

- **ä¸ªæ€§åŒ– AI**: å­¦ä¹ ç”¨æˆ·åå¥½çš„æ™ºèƒ½åˆ›ä½œåŠ©æ‰‹
- **å†…å®¹ç”Ÿæ€**: æ‰“é€ å®Œæ•´çš„å†…å®¹åˆ›ä½œå’Œåˆ†å‘ç”Ÿæ€
- **å›½é™…åŒ–**: æ”¯æŒæ›´å¤šè¯­è¨€å’Œåœ°åŒº
- **ä¼ä¸šç‰ˆ**: é¢å‘å¤§å‹ç»„ç»‡çš„å®šåˆ¶åŒ–è§£å†³æ–¹æ¡ˆ

---

**FlowEdit** - *è®©å†…å®¹åˆ›ä½œæ›´ç®€å•ï¼Œè®©è¡¨è¾¾æ›´ç²¾å½©*

> åŠ å…¥æˆ‘ä»¬ï¼Œä¸€èµ·é‡æ–°å®šä¹‰å†…å®¹åˆ›ä½œçš„æœªæ¥ï¼</textarea>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <div class="section-header">ğŸ”§ æ‰§è¡Œæµ‹è¯•</div>
                <div class="section-content">
                    <button class="btn" onclick="testApplyStyle()" id="testBtn">
                        ğŸ¯ æ‰§è¡Œ Apply Style API æµ‹è¯•
                    </button>
                    
                    <div id="status"></div>
                    <div id="result" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="test-section" id="previewSection" style="display: none;">
                <div class="section-header">ğŸ¨ ç”Ÿæˆçš„HTMLé¢„è§ˆ</div>
                <div class="section-content">
                    <div class="preview-section">
                        <div class="preview-header">HTMLæ¸²æŸ“æ•ˆæœ:</div>
                        <div id="htmlPreview"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentApiBase = 'http://localhost:8000/api';
        let availableThemes = [];

        // æ›´æ–°APIåŸºç¡€åœ°å€
        document.getElementById('apiBase').addEventListener('change', function() {
            currentApiBase = this.value;
        });

        // åŠ è½½ä¸»é¢˜åˆ—è¡¨
        async function loadThemes() {
            const statusDiv = document.getElementById('themesStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<div class="status loading">æ­£åœ¨åŠ è½½ä¸»é¢˜åˆ—è¡¨...</div>';

            try {
                const response = await fetch(`${currentApiBase}/v1/styles/themes`);
                const result = await response.json();

                if (response.ok && result.themes) {
                    availableThemes = result.themes;
                    renderThemes(result.themes);
                    statusDiv.innerHTML = '<div class="status success">âœ… å·²åŠ è½½ ' + result.themes.length + ' ä¸ªä¸»é¢˜</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status error">âŒ åŠ è½½ä¸»é¢˜å¤±è´¥</div>';
                    renderThemes([]);
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">âŒ ç½‘ç»œé”™è¯¯: ' + error.message + '</div>';
                renderThemes([]);
            }

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // æ¸²æŸ“ä¸»é¢˜ç½‘æ ¼
        function renderThemes(themes) {
            const themeGrid = document.getElementById('themeGrid');
            
            if (themes.length === 0) {
                themeGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #6b7280;">
                        ğŸ˜” æš‚æ— å¯ç”¨ä¸»é¢˜ï¼Œè¯·å…ˆä½¿ç”¨ Create Style API åˆ›å»ºä¸»é¢˜
                    </div>
                `;
                return;
            }

            themeGrid.innerHTML = themes.map(theme => `
                <div class="theme-card" onclick="selectTheme('${theme}')">
                    <div class="name">${theme}</div>
                    <div class="desc">ç‚¹å‡»é€‰æ‹©æ­¤ä¸»é¢˜</div>
                </div>
            `).join('');
        }

        // é€‰æ‹©ä¸»é¢˜
        function selectTheme(themeName) {
            // æ›´æ–°UIçŠ¶æ€
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.target.closest('.theme-card').classList.add('selected');
            
            // æ›´æ–°è¡¨å•
            document.getElementById('selectedTheme').value = themeName;
            document.getElementById('themeName').value = themeName;
            
            showStatus('å·²é€‰æ‹©ä¸»é¢˜: ' + themeName, 'success');
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(data, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const previewSection = document.getElementById('previewSection');
            
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            
            if (isSuccess && data.html_content) {
                // åªæ˜¾ç¤ºå¤§æ¨¡å‹è¿”å›çš„HTMLå†…å®¹
                resultDiv.textContent = data.html_content;
                previewSection.style.display = 'block';
                document.getElementById('htmlPreview').innerHTML = data.html_content;
            } else {
                // é”™è¯¯æ—¶æ˜¾ç¤ºå®Œæ•´å“åº”
                resultDiv.textContent = JSON.stringify(data, null, 2);
                previewSection.style.display = 'none';
            }
        }

        // æ‰§è¡ŒAPIæµ‹è¯•
        async function testApplyStyle() {
            const btn = document.getElementById('testBtn');
            const themeName = document.getElementById('themeName').value;
            
            if (!themeName) {
                showStatus('âŒ è¯·é€‰æ‹©ä¸€ä¸ªä¸»é¢˜', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'â³ æ­£åœ¨æµ‹è¯•...';
            
            showStatus('æ­£åœ¨å‘é€è¯·æ±‚åˆ° Apply Style API...', 'loading');
            
            try {
                const requestData = {
                    raw_content: document.getElementById('rawContent').value,
                    theme_name: themeName
                };

                console.log('å‘é€è¯·æ±‚:', requestData);
                
                const response = await fetch(`${currentApiBase}/v1/styles/apply`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                console.log('æ”¶åˆ°å“åº”:', result);

                if (response.ok) {
                    showStatus('âœ… APIæµ‹è¯•æˆåŠŸå®Œæˆï¼', 'success');
                    showResult(result, true);
                } else {
                    showStatus(`âŒ APIæµ‹è¯•å¤±è´¥: ${response.status} - ${result.detail || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    showResult(result, false);
                }

            } catch (error) {
                console.error('è¯·æ±‚é”™è¯¯:', error);
                showStatus('âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message, 'error');
                showResult({ error: error.message, stack: error.stack }, false);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ¯ æ‰§è¡Œ Apply Style API æµ‹è¯•';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            showStatus('å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯• Apply Style API', 'success');
            loadThemes(); // è‡ªåŠ¨åŠ è½½ä¸»é¢˜åˆ—è¡¨
        };
    </script>
</body>
</html>
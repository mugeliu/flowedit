!function(){"use strict";const e=new class{constructor(){this.plugins=new Map,this.initialized=new Set}register(e,t){if(!t.initialize||"function"!=typeof t.initialize)throw new Error(`插件 ${e} 必须提供 initialize 方法`);if(!t.cleanup||"function"!=typeof t.cleanup)throw new Error(`插件 ${e} 必须提供 cleanup 方法`);this.plugins.set(e,t)}async initializePlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`插件 ${e} 未注册`),!1;if(this.initialized.has(e))return!0;try{return!(t.isEnabled&&!t.isEnabled())&&(await t.initialize(),this.initialized.add(e),!0)}catch(n){return console.error(`插件 ${e} 初始化失败:`,n),!1}}async initializeAll(){const e={success:[],failed:[],skipped:[]};for(const[t]of this.plugins){await this.initializePlugin(t)?e.success.push(t):e.failed.push(t)}return e}cleanupPlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`插件 ${e} 未注册`),!1;if(!this.initialized.has(e))return!0;try{return t.cleanup(),this.initialized.delete(e),!0}catch(n){return console.error(`插件 ${e} 清理失败:`,n),!1}}async cleanupAll(){const e={success:[],failed:[]},t=Array.from(this.initialized);for(const n of t){this.cleanupPlugin(n)?e.success.push(n):e.failed.push(n)}return await new Promise((e=>setTimeout(e,0))),e}getRegisteredPlugins(){return Array.from(this.plugins.keys())}getInitializedPlugins(){return Array.from(this.initialized)}isRegistered(e){return this.plugins.has(e)}isInitialized(e){return this.initialized.has(e)}},t={placeholder:"开始输入内容...",autofocus:!0,hideToolbar:!1,tools:{paragraph:{class:"Paragraph",inlineToolbar:!0},header:{class:"Header",config:{levels:[1,2,3],defaultLevel:1,placeholder:"请输入标题"},toolbox:[{title:"Heading 1",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M19 17V10.2135C19 10.1287 18.9011 10.0824 18.836 10.1367L16 12.5"/></svg>',data:{level:1}},{title:"Heading 2",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10 19 9.5 19 12C19 13.9771 16.0684 13.9997 16.0012 16.8981C15.9999 16.9533 16.0448 17 16.1 17L19.3 17"/></svg>',data:{level:2}},{title:"Heading 3",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10.5 16.8323 10 17.6 10C18.3677 10 19.5 10.311 19.5 11.5C19.5 12.5315 18.7474 12.9022 18.548 12.9823C18.5378 12.9864 18.5395 13.0047 18.5503 13.0063C18.8115 13.0456 20 13.3065 20 14.8C20 16 19.5 17 17.8 17C17.8 17 16 17 16 16.3"/></svg>',data:{level:3}}]},quote:{class:"Quote",inlineToolbar:!0,config:{quotePlaceholder:"输入引用内容",captionPlaceholder:"引用来源"}},image:{class:"CustomImageTool",inlineToolbar:!0,config:{endpoints:{},types:"image/*"}},delimiter:{class:"Delimiter"},raw:{class:"RawTool"},list:{class:"List"},code:{class:"Code"},marker:{class:"Marker"},inlineCode:{class:"InlineCode"},underline:{class:"Underline"}},minHeight:400,logLevel:"WARN"},n={toolbar:"js_toolbar_0",editorContent:'div[contenteditable="true"].ProseMirror',editorWrapper:"edui1_iframeholder",sidebar:"js_side_article_list",authorArea:"js_author_area",footerToolbar:"js_button_area"},i={head:"<section></section>",ending:"<section></section>",inlineStyles:{a:'<span textstyle style="color: rgb(16, 185, 129); text-decoration: underline; text-decoration-color: rgba(16, 185, 129, 0.5); text-underline-offset: 2px;">{{content}}</span>',b:'<span textstyle style="font-weight: 700; color: rgb(16, 185, 129);">{{content}}</span>',i:'<span textstyle style="font-style: italic; color: rgb(16, 185, 129); letter-spacing: 0.5px; font-weight: 500;">{{content}}</span>',u:'<span textstyle style="text-decoration: underline; text-decoration-color: rgb(16, 185, 129); text-underline-offset: 3px; text-decoration-thickness: 2px;">{{content}}</span>',mark:'<span textstyle style="background: rgba(16, 185, 129, 0.2); padding: 0.1em 0.4em; border-radius: 3px;">{{content}}</span>',code:"<span textstyle style=\"font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.85em; background: rgba(16, 185, 129, 0.1); color: rgb(6, 95, 70); padding: 0.25em 0.6em; border-radius: 5px; border: 1px solid rgba(16, 185, 129, 0.25); font-weight: 500; letter-spacing: 0.3px;\">{{content}}</span>",sup:'<sup textstyle style="color: rgba(16, 185, 129, 0.7); font-size: 0.7em; margin-left: 0.2em;">{{sup}}</sup>'},header:{h1:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.5px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 20px;font-weight: 600;margin: 1.8em 0px 1.2em;text-align: center;line-height: 1.4;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: flex;justify-content: center;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-block;padding: 1em 2.2em;color: rgb(255, 255, 255);background: linear-gradient(135deg, rgb(16, 185, 129) 0%, rgb(5, 150, 105) 100%);border-radius: 12px;box-shadow: rgba(16, 185, 129, 0.25) 0px 6px 20px -4px, rgba(0, 0, 0, 0.1) 0px 2px 8px -2px;"><span leaf="">{{content}}</span></section></section>',h2:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.3px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 18px;font-weight: 600;margin: 1.5em 0px 1em;text-align: left;line-height: 1.4;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-flex; align-items: center; padding: 0.8em 1.8em 0.8em 1.2em; background: rgba(16, 185, 129, 0.06); border-left: 4px solid rgb(16, 185, 129); border-radius: 0px 8px 8px 0px; min-width: fit-content;"><span style="display: inline-block; width: 8px; height: 8px; background: rgb(16, 185, 129); border-radius: 50%; margin-right: 0.8em; vertical-align: middle;"></span><span leaf="">{{content}}</span></section></section>',h3:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.2px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 17px;font-weight: 500;margin: 1.2em 0px 0.8em;text-align: left;line-height: 1.5;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-flex; align-items: center; padding: 0.6em 1.5em 0.6em 1em; background: linear-gradient(90deg, rgba(16, 185, 129, 0.04) 0%, rgba(16, 185, 129, 0.01) 80%, transparent 100%); border-left: 3px solid rgba(16, 185, 129, 0.6); border-radius: 0px 6px 6px 0px; min-width: fit-content;"><span style="display: inline-block; width: 6px; height: 6px; background: rgba(16, 185, 129, 0.8); border-radius: 50%; margin-right: 0.6em; vertical-align: middle;"></span><span leaf="">{{content}}</span></section></section>'},paragraph:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 0.8em 0px;text-align: left;line-height: 1.7;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;"><section style="font-size: 16px; color: rgb(55, 65, 81); letter-spacing: 0.3px; padding: 0.5em 0.5em;"><span leaf="">{{content}}</span></section></section>'},quote:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 1.5em 0px;text-align: left;line-height: 1.6;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;"><section style="background: rgba(16, 185, 129, 0.06); border-left: 4px solid rgb(16, 185, 129); padding: 1.2em 1.8em; border-radius: 0px 8px 8px 0px; box-shadow: rgba(16, 185, 129, 0.1) 0px 2px 8px -2px;"><section style="font-size: 16px; color: rgb(55, 65, 81); font-style: italic; margin: 0px 0px 1em 0px; letter-spacing: 0.2px;"><span leaf="">{{content}}</span></section><section style="display: flex; justify-content: flex-end; color: rgba(16, 185, 129, 0.8); font-size: 14px; font-weight: 500; font-style: normal;"><span leaf="">{{caption}}</span></section></section></section>'},delimiter:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 2em 0px;text-align: center;line-height: 1;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: flex;justify-content: center;padding: 0px;"><section style="width: 80%; height: 2px; background: linear-gradient(90deg, transparent 0%, rgba(16, 185, 129, 0.2) 20%, rgba(16, 185, 129, 0.6) 50%, rgba(16, 185, 129, 0.2) 80%, transparent 100%); border-radius: 1px;"></section></section>'},raw:{default:""},list:{ordered:'<section data-block="list" data-style="ordered" style="text-indent:0px;margin-bottom:8px;"><ol style="margin:1.5em 8px;padding-left:2em;">{{items}}</ol></section>',unordered:'<section data-block="list" data-style="unordered" style="text-indent:0px;margin-bottom:8px;"><ul style="margin:1.5em 8px;padding-left:2em;">{{items}}</ul></section>'},code:{default:'<section><pre style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.5;font-family:Menlo,Monaco,\'Courier New\',monospace;font-size:90%;overflow-x:auto;border-radius:8px;padding:1em;margin:10px 8px;background-color:#2d2d2d;border:1px solid #1a6840;" class="hljs code__pre"><span style="display:block;padding-bottom:10px;" class="mac-sign"><svg viewBox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.75;font-family:\'Fira Code\',Menlo,Operator Mono,Consolas,Monaco,monospace;font-size:90%;margin:0;white-space:pre;word-wrap:break-word;overflow-wrap:break-word;color:#e0e0e0;" class="language-python">{{content}}</code></pre></section>'},listItem:'<li style="margin:0.3em 0;">{{content}}</li>',fallback:{container:"margin:1.5em 8px;padding:0.5em;border:1px dashed rgba(26,104,64,0.3);background-color:rgba(26,104,64,0.05);",warning:"color:rgba(26,104,64,0.7);font-size:0.8em;",content:"margin-top:0.5em;"}};class o{constructor(e){this.templates=e}process(e,t){const n=this.preprocessData(e,t),i=this.getTemplate(n,t),o=this.renderContent(n,t);return this.postprocess(i,o,n,t)}preprocessData(e,t){return e}getTemplate(e,t){const n=t.type,i=this.templates[n];if(!i)return null;switch(n){case"header":return i[`h${Math.min(Math.max(e.level||1,1),6)}`]||i.default;case"list":return i["ordered"===e.style?"ordered":"unordered"]||i.default;default:return i.default||Object.values(i)[0]}}renderContent(e,t){return this.sanitizeHtml(this.processInlineStyles(e.text||e.content||""))}postprocess(e,t,n,i){return e?e.replace(/{{content}}/g,t):(console.warn(`未找到块类型 ${i.type} 的模板`),this.createFallbackHtml(i))}processInlineStyles(e){if(!e)return"";const t=`<div>${e}</div>`,n=(new DOMParser).parseFromString(t,"text/html"),i=this.templates.inlineStyles;return n.querySelectorAll("a").forEach((e=>{const t=e.innerHTML,n=i.a.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("b, strong").forEach((e=>{const t=e.innerHTML,n=i.b.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("i, em").forEach((e=>{const t=e.innerHTML,n=i.i.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("u").forEach((e=>{const t=e.innerHTML,n=i.u.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("mark").forEach((e=>{const t=e.innerHTML,n=i.mark.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("code").forEach((e=>{const t=e.innerHTML,n=i.code.replace(/{{content}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.querySelectorAll("sup").forEach((e=>{const t=e.innerHTML,n=i.sup.replace(/{{sup}}/g,t),o=document.createElement("div");o.innerHTML=n,e.replaceWith(...o.childNodes)})),n.body.querySelector("div").innerHTML}sanitizeHtml(e){let t=e;return["script","iframe","object","embed","form"].forEach((e=>{const n=new RegExp(`<${e}[^>]*>.*?</${e}>`,"gi");t=t.replace(n,"")})),t}escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}createFallbackHtml(e){var t,n,i;const o=(null==(t=e.data)?void 0:t.text)||(null==(n=e.data)?void 0:n.content)||(null==(i=e.data)?void 0:i.code)||"",r="code"===e.type?this.escapeHtml(o):this.sanitizeHtml(this.processInlineStyles(o)),s=this.templates.fallback;return`<section data-block="${e.type}" style="text-indent: 0px; margin-bottom: 8px;">\n      <div style="${s.container}">\n        <small style="${s.warning}">未知块类型: ${e.type}</small>\n        <div style="${s.content}">${r}</div>\n      </div>\n    </section>`}}class r extends o{renderContent(e,t){return this.escapeHtml(e.text||"")}}class s extends o{renderContent(e,t){const n=e.code||"";return this.escapeHtml(n)}validateCodeSyntax(e,t){}}class a extends o{process(e,t){const n=e.html||"";return this.isValidHtml(n)||console.warn("Invalid HTML detected in raw block"),this.sanitizeHtml(n)}isValidHtml(e){try{const t=new DOMParser;return!t.parseFromString(e,"text/html").querySelector("parsererror")}catch(t){return!1}}}class l extends o{constructor(e,t={}){super(e),this.processCaptions=!1!==t.processCaptions}postprocess(e,t,n,i){if(!e)return console.warn(`未找到块类型 ${i.type} 的模板`),this.createFallbackHtml(i);let o=e.replace(/{{content}}/g,t);if(e.includes("{{caption}}"))if(this.processCaptions&&n.caption){const e=this.sanitizeHtml(this.processInlineStyles(n.caption));o=o.replace(/{{caption}}/g,e)}else o=o.replace(/{{caption}}/g,"");return o}}class c extends o{postprocess(e,t,n,i){if(!e)return console.warn(`未找到块类型 ${i.type} 的模板`),this.createFallbackHtml(i);const o=(n.items||[]).map((e=>{const t=this.sanitizeHtml(this.processInlineStyles(e));return this.renderListItem(t)})).join("");return e.replace(/{{items}}/g,o)}renderListItem(e){return this.templates.listItem.replace(/{{content}}/g,e)}}class d extends o{preprocessData(e,t){return{}}renderContent(e,t){return""}}class p{constructor(e){this.templates=e,this.processors=new Map,this.initializeDefaultProcessors()}initializeDefaultProcessors(){this.registerProcessor("header",new r(this.templates)),this.registerProcessor("code",new s(this.templates)),this.registerProcessor("raw",new a(this.templates)),this.registerProcessor("quote",new l(this.templates)),this.registerProcessor("list",new c(this.templates)),this.registerProcessor("delimiter",new d(this.templates)),this.registerProcessor("paragraph",new o(this.templates))}registerProcessor(e,t){this.processors.set(e,t)}getProcessor(e){return this.processors.get(e)||this.getDefaultProcessor()}getDefaultProcessor(){return new o(this.templates)}}class u{constructor(e={}){this.templates=Object.keys(e).length>0?e:i,this.processorFactory=new p(this.templates)}setTemplates(e){this.templates=e,this.processorFactory=new p(this.templates)}getTemplates(){return this.templates}registerCustomProcessor(e,t){this.processorFactory.registerProcessor(e,t)}parseBlock(e){if(!e||!e.type)return console.warn("无效的块数据:",e),"";return this.processorFactory.getProcessor(e.type).process(e.data||{},e)}parse(e,t={}){const{skipEmpty:n=!0}=t;if(!e||!Array.isArray(e.blocks))return console.warn("无效的EditorJS数据"),"";const i=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return[this.templates.head||"",i,this.templates.ending||"",'<section><span leaf=""><br class="ProseMirror-trailingBreak"></span></section>'].filter((e=>e.trim())).join("\n")}registerTemplate(e,t,n="default"){this.templates[e]||(this.templates[e]={}),"string"==typeof t?this.templates[e][n]=t:"object"==typeof t&&(this.templates[e]={...this.templates[e],...t})}setTemplate(e,t,n){this.templates[e]||(this.templates[e]={}),this.templates[e][t]=n}renderDocument(e,t={}){const{skipEmpty:n=!0,wrapInContainer:i=!1}=t;if(!e||!Array.isArray(e.blocks))return console.warn("无效的EditorJS数据"),"";const o=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return i?`<div class="editorjs-content" style="max-width: 800px; margin: 0 auto; padding: 20px;">\n${o}\n</div>`:o}getAvailableTemplates(){return{...this.templates}}setTemplates(e){this.templates={...e}}}function h(e,t={}){const n=document.createElement(e);return t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.cssText&&(n.style.cssText=t.cssText),n}function g(e,t){let n;return"string"==typeof e?n=document.getElementById(e):e&&e.nodeType===Node.ELEMENT_NODE&&(n=e),!!n&&(n.style.display=t,!0)}function m(e){return g(e,"none")}function f(e){return g(e,"")}function x(e,t=document){try{return t.querySelector(e)}catch(n){return console.error(`查询选择器失败: ${e}`,n),null}}async function w(e,t={}){try{const{targetSelector:i=n.editorContent,append:o=!0,insertPosition:r="cursor",styleOptions:s={}}=t,a=(new u).parse({blocks:e});console.log("生成的HTML内容:",a);const l=await async function(e,t={}){const{targetSelector:i=n.editorContent,append:o=!0,insertPosition:r="cursor"}=t;try{const t=x(i);if(!t)return console.error("找不到目标编辑器:",i),!1;const n=h("div",{innerHTML:e});if(o)for(;n.firstChild;)t.appendChild(n.firstChild);else switch(r){case"start":for(;n.lastChild;)t.insertBefore(n.lastChild,t.firstChild);break;case"end":for(;n.firstChild;)t.appendChild(n.firstChild);break;default:t.innerHTML=e}return console.log("内容插入成功"),!0}catch(s){return console.error("插入内容失败:",s),!1}}(a,{targetSelector:i,append:o,insertPosition:r});return l}catch(i){return console.error("保存到原编辑器失败:",i),!1}}function b(){return!(!window.EditorJSBundle||!window.EditorJSBundle.EditorJS)}function y(e){if(!document.getElementById(e))throw new Error(`${e}元素不存在，请检查DOM结构`);try{const n={holder:e,tools:function(e){const t={};for(const[n,i]of Object.entries(e)){const{class:e,...o}=i;if(!window.EditorJSBundle||!window.EditorJSBundle[e]){console.warn(`工具类 ${e} 未找到或未加载，跳过工具 ${n}`);continue}const r=window.EditorJSBundle[e];r?t[n]={class:r,...o}:console.warn(`工具类 ${e} 未加载，跳过工具 ${n}`)}return t}(t.tools),data:{blocks:[]},placeholder:t.placeholder,autofocus:t.autofocus,hideToolbar:t.hideToolbar,minHeight:t.minHeight,logLevel:t.logLevel,onReady:()=>{new window.EditorJSBundle.DragDrop(i)}},i=new window.EditorJSBundle.EditorJS(n);return i}catch(n){throw console.error("编辑器初始化失败:",n),n}}async function k(e){if(!b())try{await new Promise(((e,t)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",(n=>{n&&"injected"===n.status?setTimeout((()=>{b()?e():t(new Error("编辑器脚本加载失败"))}),100):t(new Error("编辑器注入失败"))}))}))}catch(t){throw new Error("编辑器加载失败: "+t.message)}return y(e)}async function v(){try{await async function(){if(E)return void console.debug("智能编辑器已经激活");if(!x(n.editorContent))return void alert("找不到编辑器容器");try{!function(){m(document.getElementById(n.editorWrapper))||console.warn("[SmartEditor] 未找到原编辑器iframe容器");const e=h("div",{id:"smart-editor-container",className:"flowedit-editor-container"});e.setAttribute("data-flowedit-plugin","smart-editor"),e.setAttribute("data-flowedit","true");const t=document.getElementById(n.authorArea);if(!t){const e=`作者区域未找到: ${n.authorArea}`;throw console.error("[SmartEditor]",e),new Error(e)}const i=t.parentElement;if(!i){const e="作者区域的父元素未找到";throw console.error("[SmartEditor]",e),new Error(e)}i.insertBefore(e,t.nextSibling);const o=h("div",{id:"editor-holder",className:"flowedit-editor-holder"});e.appendChild(o),console.log("[SmartEditor] 界面创建完成")}(),S=function(e={}){const{onSave:t,onCancel:i}=e,o=h("div",{className:"flowedit-editor-action-bar"}),r=h("button",{textContent:"💾 保存",className:"flowedit-editor-save-btn"}),s=h("button",{textContent:"↩️ 取消",className:"flowedit-editor-cancel-btn"});o.appendChild(r),o.appendChild(s);const a=document.getElementById(n.footerToolbar);return a?(m(a),a.parentNode.insertBefore(o,a.nextSibling)):(console.warn("找不到底部工具栏元素，将控制栏添加到body"),document.body.appendChild(o)),t&&"function"==typeof t&&r.addEventListener("click",t),i&&"function"==typeof i&&s.addEventListener("click",i),console.log("智能编辑器控制栏创建完成，已插入到DOM中"),o}({onSave:T,onCancel:z}),await new Promise((e=>setTimeout(e,50))),E=await k("editor-holder");const e=x("#header");e&&(await new Promise((e=>setTimeout(e,100))),e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),console.log("已滚动到智能编辑器位置")),console.log("智能编辑器激活成功")}catch(e){console.error("智能插入功能启动失败:",e),alert("智能插入功能启动失败"),z()}}()}catch(e){console.error("智能插入按钮点击处理失败:",e)}}new u;let E=null,S=null,C=null;function M(){if(C)console.warn("智能插入按钮功能已经初始化");else try{C=function(){const e=h("button",{className:"flowedit-smart-btn",textContent:"智能插入"});e.setAttribute("data-flowedit-plugin","smart-button"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",v);const t=document.getElementById(n.toolbar);if(!t){const e=`工具栏容器未找到: ${n.toolbar}`;throw console.error("[SmartButton]",e),new Error(e)}return t.appendChild(e),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("智能插入按钮成功")}catch(e){console.error("智能编辑器功能初始化失败:",e)}}function z(){!function(){const e=document.getElementById("smart-editor-container");e&&e.remove(),f(document.getElementById(n.editorWrapper)),console.log("[SmartEditor] 界面已移除")}(),S&&(!function(e){e&&(e.remove(),console.log("智能编辑器控制栏已移除"));const t=document.getElementById(n.footerToolbar);t&&f(t)}(S),S=null),E&&(!function(e){if(e)try{e.destroy()}catch(t){console.warn("编辑器销毁错误:",t)}}(E),E=null),console.log("智能编辑器已停用")}async function T(e={}){if(E)try{const t=await E.save();console.log("保存的数据:",t);await w(t.blocks,{...e})?console.log("内容已成功保存到原编辑器"):console.error("保存到原编辑器失败")}catch(t){console.error("保存失败:",t)}finally{z()}else console.error("编辑器未初始化")}const H={name:"smart-editor",initialize:async()=>{M()},cleanup:()=>{z(),C&&C.cleanup&&(C.cleanup(),C=null,console.log("智能编辑器功能已清理"))},isEnabled:()=>!0,isActive:()=>null!==E};function L(e){const t=document.getElementById(n.sidebar);if(t&&e&&e.currentTarget){const n=e.currentTarget;n.classList.contains("on")?(n.classList.remove("on"),f(t)):(n.classList.add("on"),m(t))}}let I=null;function A(){if(I)console.warn("侧边栏功能已经初始化");else try{I=function(){const e=h("div",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});e.setAttribute("data-flowedit-plugin","sidebar-toggle"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",L);const t=document.getElementById(n.toolbar);if(!t){const e=`工具栏容器未找到: ${n.toolbar}`;throw console.error("[SidebarToggle]",e),new Error(e)}return t.insertBefore(e,t.firstChild),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("侧边栏功能初始化成功")}catch(e){console.error("侧边栏功能初始化失败:",e)}}const q={name:"sidebar",initialize:async()=>{A()},cleanup:()=>{I&&I.cleanup&&(I.cleanup(),I=null,console.log("侧边栏功能已清理"))},isEnabled:()=>!0,isActive:()=>null!==I};const B=new class{constructor(){this.config={},this.initialized=!1}async initialize(){try{this.initialized=!0}catch(e){throw console.error("用户配置管理器初始化失败:",e),e}}getUserConfig(e){return this.initialized?e?this.config[e]:this.config:(console.warn("用户配置管理器未初始化"),null)}async setUserConfig(e,t){try{return this.initialized?("object"==typeof e?this.config={...this.config,...e}:this.config[e]=t,!0):(console.warn("用户配置管理器未初始化"),!1)}catch(n){return console.error("设置用户配置失败:",n),!1}}},P=new class{constructor(){this.initialized=!1,this.styleCache={},this.syncInterval=null}async initialize(){try{this.initialized=!0}catch(e){throw console.error("远程样式同步服务初始化失败:",e),e}}async manualSync(){try{return!!this.initialized||(console.warn("远程样式同步服务未初始化"),!1)}catch(e){return console.error("远程样式同步失败:",e),!1}}startAutoSync(e=3e4){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval((async()=>{await this.manualSync()}),e)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}};async function N(e={}){try{return await B.initialize(),await async function(e={}){try{if(await P.initialize(),!1!==e.enableAutoSync){const t=e.syncInterval||3e4;P.startAutoSync(t)}!1!==e.initialSync&&await P.manualSync()}catch(t){console.error("远程样式系统初始化失败:",t)}}(e),!0}catch(t){return console.error("FlowEdit应用服务初始化失败:",t),!1}}const $=new class{constructor(){this.isWatching=!1,this.reinitTimeout=null,this.clickHandler=null}startWatching(){this.isWatching||(this.clickHandler=e=>{this.handleSubmitClick(e)},document.addEventListener("click",this.clickHandler,!0),this.isWatching=!0)}stopWatching(){this.clickHandler&&(document.removeEventListener("click",this.clickHandler,!0),this.clickHandler=null),this.reinitTimeout&&(clearTimeout(this.reinitTimeout),this.reinitTimeout=null),this.isWatching=!1}handleSubmitClick(e){const t=e.target;this.isSubmitButton(t)&&(this.reinitTimeout&&clearTimeout(this.reinitTimeout),this.reinitTimeout=setTimeout((()=>{this.reinitializePlugins()}),800))}isSubmitButton(e){if(!e)return!1;if(this.checkElementIsSubmit(e))return!0;let t=e.parentElement,n=0;for(;t&&n<3;){if(this.checkElementIsSubmit(t))return!0;t=t.parentElement,n++}return!1}checkElementIsSubmit(e){var t;return null==(t=e.classList)?void 0:t.contains("send_wording")}async reinitializePlugins(){try{await e.cleanupAll(),await new Promise((e=>setTimeout(e,1e3)));const t=await e.initializeAll();t.failed.length>0&&console.warn(`[DOMWatcher] 重新初始化失败: ${t.failed.join(", ")}`)}catch(t){console.error("[DOMWatcher] 重新初始化插件失败:",t)}}};async function F(){if(!document.querySelector("#js_toolbar_0"))return;!function(){const e="flow-editor-plugin-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.setAttribute("data-flowedit-plugin-ui","true"),t.textContent="\n      /* FlowEdit 插件UI样式 */\n      \n  /* 扩展按钮基础样式 */\n  .flowedit-smart-btn {\n    /* 基础布局样式 */\n    position: relative;\n    display: inline-block;\n    height: 22px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n    \n    /* 特定样式 */\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n    transition: all 0.3s ease;\n  }\n  \n  /* 智能插入按钮悬浮效果 */\n  .flowedit-smart-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n      \n  /* Switch开关样式 */\n  .flowedit-switch {\n    position: relative;\n    display: inline-block;\n    width: 40px;\n    height: 20px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: all 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* 智能插入编辑器容器样式 */\n  .flowedit-editor-container {\n    position: relative; /* 改为相对定位，适合直接插入 */\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;More actions\n    background: #fff;\n  }\n  \n  /* 智能插入编辑器占位元素样式 */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0;\n    padding-left: 91px;\n  }\n  \n  /* 智能插入控制栏样式 */\n  .flowedit-editor-action-bar {\n    position: relative; /* 改为相对定位，适配直接插入DOM */\n    background-color: #ffffff;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    gap: 15px;\n    padding: 20px 20px 15px 20px; /* 添加上下内边距 */\n    box-sizing: border-box;\n    width: 768px;\n  }\n  \n  /* 智能插入保存按钮样式 */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n  \n\n  \n  /* 智能插入取消按钮样式 */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n\n    ",document.head.appendChild(t)}}();const t=await e.initializeAll();t.failed.length>0&&console.warn(`初始化失败的功能模块: ${t.failed.join(", ")}`),$.startWatching()}e.register("smart-editor",H),e.register("sidebar",q),window.addEventListener("beforeunload",(()=>{$.stopWatching()})),async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e)}));try{await N()}catch(e){console.error("[FlowEdit] initializeAppServices初始化失败:",e)}await F()}().catch((e=>{console.error("FlowEdit 启动失败:",e)}))}();

!function(){"use strict";function e(e,n={}){const t=document.createElement(e);return n.className&&(t.className=n.className),n.id&&(t.id=n.id),n.innerHTML&&(t.innerHTML=n.innerHTML),n.textContent&&(t.textContent=n.textContent),n.cssText&&(t.style.cssText=n.cssText),t}function n(e,n=document){try{return n.querySelector(e)}catch(t){return console.error(`查询选择器失败: ${e}`,t),null}}const t=e=>`\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20">\n    <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"\n        font-family="monospace" font-size="12">${e}</text>\n</svg>`,o={placeholder:"开始输入内容...",autofocus:!0,hideToolbar:!1,tools:{paragraph:{class:"Paragraph",inlineToolbar:!0},header:{class:"Header",inlineToolbar:!0,config:{levels:[1,2,3],defaultLevel:1,placeholder:"请输入标题"},toolbox:[{title:"Heading 1",icon:t("H1"),data:{level:1}},{title:"Heading 2",icon:t("H2"),data:{level:2}},{title:"Heading 3",icon:t("H3"),data:{level:3}}]},quote:{class:"Quote",inlineToolbar:!0,config:{quotePlaceholder:"输入引用内容",captionPlaceholder:"引用来源"}},image:{class:"ImageTool",inlineToolbar:!0,config:{endpoints:{}}},raw:{class:"RawTool"}},minHeight:300,logLevel:"WARN"},r={insertMethod:"insertBefore",targetElement:"firstElementChild"},i={insertMethod:"appendChild",targetElement:null},l={toolbar:"#js_toolbar_0",editorContent:'div[contenteditable="true"].ProseMirror',editorWrapper:"#edui1_iframeholder",editorToHide:["#ueditor_0","#article_setting_area","#js_button_area"],buttonArea:"#bottom_main",sidebar:"#js_side_article_list"};function a(e,n,t={},o={}){let r="";if("string"==typeof t)r=t?` style="${t}"`:"";else if("object"==typeof t&&null!==t){const e=Object.entries(t).map((([e,n])=>{return`${t=e,t.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${n}`;var t})).filter((e=>e.includes(": ")));r=e.length>0?` style="${e.join("; ")}"`:""}let i="";if("string"==typeof o)i=` ${o}=""`;else if("object"==typeof o&&null!==o){const e=Object.entries(o).map((([e,n])=>`${e}="${function(e){if("string"!=typeof e)return e;const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>n[e]))}(n)}"`)).join(" ");i=e?` ${e}`:""}return`<${e}${i}${r}>${n}</${e}>`}const c={mark:"mark",code:"code"},s={b:"strong",i:"em",u:"u",s:"s"};function d(e){const{blockType:n,contentTag:t,textField:o="text",styleVariant:r=null,getStyleVariant:i=null,getContentAttributes:l=null,getSectionAttributes:d=null,preprocessText:u=null,customProcessor:p=null,processInlineStyles:f=!0}=e;if(!n||!t)throw new Error("blockType and contentTag are required");return function(e,g={}){if(!e||!e.data||!e.data[o])return"";const{styleProvider:h}=g,{data:m}=e;let b=m[o];u&&"function"==typeof u&&(b=u(b,m,g)),f&&(b=function(e,n){if(!e||"string"!=typeof e)return"";if(!n)return e;let t=e;return Object.entries(c).forEach((([e,o])=>{const r=new RegExp(`<${e}(?:\\s+class="[^"]*")?>(.*?)<\\/${e}>`,"g");t=t.replace(r,((e,t)=>a("span",t,n("emphasis",o),"textstyle")))})),Object.entries(s).forEach((([e,o])=>{const r=new RegExp(`<${e}>(.*?)<\\/${e}>`,"g");t=t.replace(r,((t,r)=>{const i=n("emphasis",o);return a(e,r,i)}))})),t=t.replace(/<a\s+href="([^"]*?)"[^>]*>(.*?)<\/a>/g,((e,t,o)=>a("a",o,n("emphasis","link"),{href:t}))),t}(b,h));let x=r;i&&"function"==typeof i&&(x=i(m,g));let w={};l&&"function"==typeof l&&(w=l(m,g));let y={};return d&&"function"==typeof d&&(y=d(m,g)),function(e,n,t,o,r=null,i={},l={},c=null){const s=a(e,n,t?t(o,r):{},i),d=t?t("section"):{};return c&&"function"==typeof c?c(s,d,l):a("section",s,d,l)}(t,b,h,n,x,w,y,p)}}const u={paragraph:d({blockType:"paragraph",contentTag:"p"}),header:function(e,n={}){if(!e||!e.data||!e.data.text)return"";const{data:t}=e,o=Math.min(Math.max(t.level||1,1),6);return d({blockType:"header",contentTag:`h${o}`,getStyleVariant:()=>`h${o}`,getContentAttributes:e=>({...e.id&&{id:e.id}}),getSectionAttributes:()=>({"data-heading":"true"})})(e,n)},quote:d({blockType:"blockquote",contentTag:"blockquote",preprocessText:(e,n)=>{let t=e;return n.caption&&(t+=`<cite>${n.caption}</cite>`),t},getSectionAttributes:e=>({"data-alignment":e.alignment||"left"})}),delimiter:d({blockType:"delimiter",contentTag:"div",textField:"text",preprocessText:()=>"***",getContentAttributes:()=>({class:"delimiter"}),getSectionAttributes:()=>({"data-delimiter":"true"})})},p={base:{textAlign:"left",lineHeight:1.75,fontFamily:"Menlo, Monaco, 'Courier New', monospace",fontSize:"14px",color:"#3f3f3f"},header:{h1:{textAlign:"center",fontSize:"19.6px",display:"table",padding:"0.5em 1em",borderBottom:"2px solid rgba(26, 104, 64, 1)",margin:"2em auto 1em",marginTop:"0",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",textShadow:"1px 1px 3px rgba(0,0,0,0.05)"},h2:{fontSize:"17px",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",margin:"1.5em 8px 1em",borderBottom:"1px solid rgba(26, 104, 64, 0.3)",paddingBottom:"0.3em"},h3:{fontSize:"15.5px",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",margin:"1.2em 8px 0.8em"},h4:{fontSize:"14.5px",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",margin:"1em 8px 0.6em"},h5:{fontSize:"14px",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",margin:"0.8em 8px 0.5em"},h6:{fontSize:"13px",color:"rgba(26, 104, 64, 1)",fontWeight:"bold",margin:"0.6em 8px 0.4em"}},paragraph:{margin:"1.5em 8px",letterSpacing:"0.1em"},section:{textIndent:"0px",marginBottom:"8px"},emphasis:{strong:{fontWeight:"bold"},em:{fontStyle:"italic"},code:{fontSize:"90%",fontFamily:"monospace",backgroundColor:"#f6f8fa",padding:"2px 4px",borderRadius:"3px",border:"1px solid #e1e4e8"},mark:{backgroundColor:"#ff6827",color:"#ffffff",padding:"1px 2px",borderRadius:"2px"},u:{textDecoration:"underline"},s:{textDecoration:"line-through"},link:{color:"rgba(26, 104, 64, 1)",textDecoration:"none",borderBottom:"1px solid rgba(26, 104, 64, 0.3)",cursor:"pointer"}},blockquote:{fontStyle:"italic",padding:"1em 1em 1em 2em",borderLeft:"4px solid rgba(26, 104, 64, 1)",borderRadius:"6px",color:"rgba(0,0,0,0.6)",background:"#f7f7f7",marginBottom:"1em",borderBottom:"0.2px solid rgba(0, 0, 0, 0.04)",borderTop:"0.2px solid rgba(0, 0, 0, 0.04)",borderRight:"0.2px solid rgba(0, 0, 0, 0.04)"},list:{ul:{listStyle:"none",paddingLeft:"1.5em",marginLeft:"0"},ol:{paddingLeft:"1.5em",marginLeft:"0"},li:{textIndent:"-1em",display:"block",margin:"0.5em 8px"}},image:{figure:{margin:"1.5em 8px"},img:{display:"block",maxWidth:"100%",margin:"0.1em auto 0.5em",borderRadius:"8px",border:"1px solid rgba(0, 0, 0, 0.04)"},figcaption:{textAlign:"center",fontSize:"0.8em",color:"#888"}},codeBlock:{background:"#f6f8fa",border:"1px solid #e1e4e8",borderRadius:"6px",padding:"16px",margin:"1em 8px",overflow:"auto",fontSize:"85%",lineHeight:1.45},delimiter:{textAlign:"center",margin:"2em 0",fontSize:"1.2em",color:"#999",letterSpacing:"0.5em"}};function f(e,n,t){if(e.type in n){const o={styleProvider:t.styleProvider};return n[e.type](e,o)}const o=`[editorjs-html]: Parser function for ${e.type} does not exist`;if(t.strict)throw new Error(o);return console.error(o),""}function g({styleConfig:e=null,plugins:n={},options:t={strict:!1}}={}){const o={...u,...n},r=e?function(e=p){return function(n,t="default"){const o=e.base||{},r=e[n]||{};if("emphasis"===n){const e={color:o.color,fontFamily:o.fontFamily,fontSize:o.fontSize},n=Object.fromEntries(Object.entries(e).filter((([e,n])=>void 0!==n)));return"object"==typeof r&&r[t]?{...n,...r[t]}:{...n,...r}}return"object"==typeof r&&r[t]?{...o,...r[t]}:{...o,...r}}}(e):null,i={...t,styleProvider:r};return{parse:e=>function({blocks:e},n,t){return e.reduce(((e,o)=>e+f(o,n,t)),"")}(e,o,i),parseBlock:e=>f(e,o,i)}}async function h(t,o={}){try{const{targetSelector:r=l.editorContent,append:i=!0,insertPosition:a="cursor",styleOptions:c={}}=o,s=function(e={},n={strict:!1}){return g({styleConfig:p,plugins:e,options:n})}(),d=s.parse({blocks:t}),u=await async function(t,o={}){const{targetSelector:r=l.editorContent,append:i=!0,insertPosition:a="cursor"}=o;try{const o=n(r);if(!o)return console.error("找不到目标编辑器:",r),!1;const l=e("div",{innerHTML:t});return l.querySelectorAll("section").forEach((e=>{if(i)o.appendChild(e.cloneNode(!0));else switch(a){case"start":o.insertBefore(e.cloneNode(!0),o.firstChild);break;case"end":o.appendChild(e.cloneNode(!0));break;default:o.innerHTML="",o.appendChild(e.cloneNode(!0))}})),console.log("内容插入成功"),!0}catch(c){return console.error("插入内容失败:",c),!1}}(d,{targetSelector:r,append:i,insertPosition:a});return u}catch(r){return console.error("保存到原编辑器失败:",r),!1}}function m(){return!(!window.EditorJSBundle||!window.EditorJSBundle.EditorJS)}function b(e){if(!document.getElementById(e))throw new Error(`${e}元素不存在，请检查DOM结构`);try{const n={holder:e,tools:function(e){const n={};for(const[t,o]of Object.entries(e)){const{class:e,...r}=o;if(!window.EditorJSBundle||!window.EditorJSBundle[e]){console.warn(`工具类 ${e} 未找到或未加载，跳过工具 ${t}`);continue}const i=window.EditorJSBundle[e];i?n[t]={class:i,...r}:console.warn(`工具类 ${e} 未加载，跳过工具 ${t}`)}return n}(o.tools),data:{blocks:[]},placeholder:o.placeholder,autofocus:o.autofocus,hideToolbar:o.hideToolbar,minHeight:o.minHeight,logLevel:o.logLevel,onReady:()=>{new window.EditorJSBundle.DragDrop(t)}},t=new window.EditorJSBundle.EditorJS(n);return t}catch(n){throw console.error("编辑器初始化失败:",n),n}}async function x(e){if(!m())try{await new Promise(((e,n)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",(t=>{t&&"injected"===t.status?setTimeout((()=>{m()?e():n(new Error("编辑器脚本加载失败"))}),100):n(new Error("编辑器注入失败"))}))}))}catch(n){throw new Error("编辑器加载失败: "+n.message)}return b(e)}let w=null,y=[],v=null;async function S(){if(w)return void console.warn("智能编辑器已经激活");const t=n(l.editorContent);if(t)try{y=function(e){const n=Array.isArray(e)?e:[e],t=[];return n.forEach((e=>{document.querySelectorAll(e).forEach((n=>{t.push({element:n,selector:e,originalDisplay:n.style.display||getComputedStyle(n).display}),n.style.display="none"}))})),t}(l.editorToHide),function(){const t=e("div",{id:"smart-editor-container",className:"flowedit-editor-container"}),o=n(l.editorWrapper);if(o)o.appendChild(t);else{const e=n(l.ueditor);if(!e)throw console.error("无法找到合适的容器来插入智能编辑器，请检查页面结构"),new Error("无法找到合适的容器来插入智能编辑器");e.appendChild(t),console.log("找不到目标容器，将editorContainer插入到#ueditor_0的子元素上")}const r=e("div",{id:"editor-holder",className:"flowedit-editor-holder"});t.appendChild(r),console.log("智能编辑器界面创建完成")}(),v=function(t={}){const{onSave:o,onCancel:r}=t,i=e("div",{className:"flowedit-editor-action-bar"}),a=e("button",{textContent:"💾 保存",className:"flowedit-editor-save-btn"}),c=e("button",{textContent:"↩️ 取消",className:"flowedit-editor-cancel-btn"});i.appendChild(a),i.appendChild(c);const s=n(l.buttonArea);return s?s.appendChild(i):(console.warn("找不到按钮区域，将控制栏添加到body"),document.body.appendChild(i)),o&&"function"==typeof o&&a.addEventListener("click",o),r&&"function"==typeof r&&c.addEventListener("click",r),console.log("智能编辑器控制栏创建完成"),i}({onSave:E,onCancel:k}),await new Promise((e=>setTimeout(e,50))),w=await x("editor-holder"),console.log("智能编辑器激活成功")}catch(o){console.error("智能插入功能启动失败:",o),alert("智能插入功能启动失败"),k()}else alert("找不到编辑器容器")}function k(){var e;y.length>0&&(y.forEach((({element:e,originalDisplay:n})=>{e&&e.parentNode&&(e.style.display="none"===n?"":n)})),y=[]),function(){const e=document.getElementById("smart-editor-container");e&&(e.remove(),console.log("智能编辑器界面已移除"))}(),v&&((e=v)&&(e.remove(),console.log("智能编辑器控制栏已移除")),v=null),w&&(!function(e){if(e)try{e.destroy()}catch(n){console.warn("编辑器销毁错误:",n)}}(w),w=null),console.log("智能编辑器已停用")}async function E(e={}){if(w)try{const n=await w.save();console.log("保存的数据:",n);await h(n.blocks,{...e})?console.log("内容已成功保存到原编辑器"):console.error("保存到原编辑器失败")}catch(n){console.error("保存失败:",n)}finally{k()}else console.error("编辑器未初始化")}async function C(){try{await S()}catch(e){console.error("智能插入按钮点击处理失败:",e)}}function T(e){const n=document.querySelector(l.sidebar);if(n){const t="none"===n.style.display;n.style.display=t?"":"none";const o=e.currentTarget;t?o.classList.add("on"):o.classList.remove("on")}}function z(e,n,t){const{insertMethod:o,targetElement:r}=t;if("insertBefore"===o&&r){const t=e[r];t?e.insertBefore(n,t):e.appendChild(n)}else e.appendChild(n)}function F(){const t=n(l.toolbar);if(!t)return console.debug("找不到工具栏区域，可能页面未登录"),!1;{const n=function(){const n=e("button",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});return n.addEventListener("click",T),n}();n?(z(t,n,r),console.log("侧边栏切换按钮初始化成功")):console.warn("侧边栏切换按钮创建失败")}{const n=function(){const n=e("button",{className:"flowedit-btn flowedit-smart-btn",textContent:"智能插入"});return n.addEventListener("click",C),n}();n?(z(t,n,i),console.log("智能插入按钮初始化成功")):console.warn("智能插入按钮创建失败")}return!0}const $=new class{constructor(){this.config={},this.initialized=!1}async initialize(){try{console.log("初始化用户配置管理器..."),this.initialized=!0,console.log("用户配置管理器初始化完成")}catch(e){throw console.error("用户配置管理器初始化失败:",e),e}}getUserConfig(e){return this.initialized?e?this.config[e]:this.config:(console.warn("用户配置管理器未初始化"),null)}async setUserConfig(e,n){try{return this.initialized?("object"==typeof e?this.config={...this.config,...e}:this.config[e]=n,console.log("用户配置已更新:",e),!0):(console.warn("用户配置管理器未初始化"),!1)}catch(t){return console.error("设置用户配置失败:",t),!1}}},B=new class{constructor(){this.initialized=!1,this.styleCache={},this.syncInterval=null}async initialize(){try{console.log("初始化远程样式同步服务..."),this.initialized=!0,console.log("远程样式同步服务初始化完成")}catch(e){throw console.error("远程样式同步服务初始化失败:",e),e}}async manualSync(){try{return this.initialized?(console.log("开始手动同步远程样式..."),console.log("远程样式同步完成"),!0):(console.warn("远程样式同步服务未初始化"),!1)}catch(e){return console.error("远程样式同步失败:",e),!1}}startAutoSync(e=3e4){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval((async()=>{await this.manualSync()}),e),console.log(`远程样式自动同步已启动，间隔: ${e}ms`)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("远程样式自动同步已停止"))}};async function A(e={}){try{return console.log("开始初始化FlowEdit应用服务..."),await $.initialize(),await async function(e={}){try{if(await B.initialize(),!1!==e.enableAutoSync){const n=e.syncInterval||3e4;B.startAutoSync(n)}!1!==e.initialSync&&await B.manualSync(),console.log("远程样式系统初始化完成")}catch(n){console.error("远程样式系统初始化失败:",n)}}(e),console.log("FlowEdit应用服务初始化完成"),!0}catch(n){return console.error("FlowEdit应用服务初始化失败:",n),!1}}async function H(){F()?(!function(){const e="flow-editor-plugin-styles";if(!document.getElementById(e)){const n=document.createElement("style");n.id=e,n.setAttribute("data-flowedit-plugin-ui","true"),n.textContent="\n      /* FlowEdit 插件UI样式 */\n      \n  /* 扩展按钮基础样式 */\n  .flowedit-btn {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  /* 智能插入按钮样式 */\n  .flowedit-smart-btn {\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n    transition: all 0.3s ease;\n  }\n  \n  /* 智能插入按钮悬浮效果 */\n  .flowedit-smart-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n      \n  /* Switch开关样式 */\n  .flowedit-switch {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    position: relative;\n    width: 40px;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: all 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* 智能插入编辑器容器样式 */\n  .flowedit-editor-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;\n    margin-left: -95px;\n    padding: 0 91px;\n    background: #fff;\n  }\n  \n  /* 智能插入编辑器占位元素样式 */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0 91px;\n  }\n  \n  /* 智能插入控制栏样式 */\n  .flowedit-editor-action-bar {\n    position: relative  \n    padding: 20px 20px 15px 20px;\n    margin: 0;\n    width: 768px;\n    margin-left: auto;\n    margin-right: auto;\n    background-color: #ffffff;\n    color: rgb(53, 53, 53);\n    font-family: mp-quote, 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;\n    font-size: 14px;\n    line-height: 22.4px;\n    word-break: break-all;\n    box-sizing: content-box;\n    display: flex;\n    justify-content: flex-end;\n    gap: 15px;\n  }\n  \n  /* 智能插入保存按钮样式 */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n    position: relative\n  }\n  \n  /* 智能插入保存按钮悬浮效果 */\n  .flowedit-editor-save-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n  \n  /* 智能插入取消按钮样式 */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n  \n  /* 智能插入取消按钮悬浮效果 */\n  .flowedit-editor-cancel-btn:hover {\n    background-color: #e7e7eb;\n    background-image: linear-gradient(to bottom, #E7E7EB 0, #E7E7EB 100%);\n    border-color: #DADBE0;\n    box-shadow: none;\n    -moz-box-shadow: none;\n    -webkit-box-shadow: none;\n    color: #353535;\n    transform: translateY(-1px);\n  }\n\n    ",document.head.appendChild(n),console.log("FlowEdit 插件UI样式已注入")}}(),console.log("FlowEdit 插件功能模块初始化完成")):console.log("FlowEdit 插件功能模块初始化失败：页面可能未登录")}(async function(){console.log("FlowEdit 内容脚本启动"),"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e)}));try{await A(),console.log("FlowEdit 应用服务初始化成功")}catch(e){console.error("FlowEdit 应用服务初始化失败:",e)}await H()})().catch((e=>{console.error("FlowEdit 启动失败:",e)}))}();

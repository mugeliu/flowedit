!function(){"use strict";const e=new class{constructor(){this.plugins=new Map,this.initialized=new Set}register(e,t){if(!t.initialize||"function"!=typeof t.initialize)throw new Error(`æ’ä»¶ ${e} å¿…é¡»æä¾› initialize æ–¹æ³•`);if(!t.cleanup||"function"!=typeof t.cleanup)throw new Error(`æ’ä»¶ ${e} å¿…é¡»æä¾› cleanup æ–¹æ³•`);this.plugins.set(e,t)}async initializePlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`æ’ä»¶ ${e} æœªæ³¨å†Œ`),!1;if(this.initialized.has(e))return!0;try{return!(t.isEnabled&&!t.isEnabled())&&(await t.initialize(),this.initialized.add(e),!0)}catch(n){return console.error(`æ’ä»¶ ${e} åˆå§‹åŒ–å¤±è´¥:`,n),!1}}async initializeAll(){const e={success:[],failed:[],skipped:[]};for(const[t]of this.plugins){await this.initializePlugin(t)?e.success.push(t):e.failed.push(t)}return e}cleanupPlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`æ’ä»¶ ${e} æœªæ³¨å†Œ`),!1;if(!this.initialized.has(e))return!0;try{return t.cleanup(),this.initialized.delete(e),!0}catch(n){return console.error(`æ’ä»¶ ${e} æ¸…ç†å¤±è´¥:`,n),!1}}async cleanupAll(){const e={success:[],failed:[]},t=Array.from(this.initialized);for(const n of t){this.cleanupPlugin(n)?e.success.push(n):e.failed.push(n)}return await new Promise((e=>setTimeout(e,0))),e}getRegisteredPlugins(){return Array.from(this.plugins.keys())}getInitializedPlugins(){return Array.from(this.initialized)}isRegistered(e){return this.plugins.has(e)}isInitialized(e){return this.initialized.has(e)}},t={placeholder:"å¼€å§‹è¾“å…¥å†…å®¹...",autofocus:!0,hideToolbar:!1,tools:{paragraph:{class:"Paragraph",inlineToolbar:!0},header:{class:"Header",config:{levels:[1,2,3],defaultLevel:1,placeholder:"è¯·è¾“å…¥æ ‡é¢˜"},toolbox:[{title:"Heading 1",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M19 17V10.2135C19 10.1287 18.9011 10.0824 18.836 10.1367L16 12.5"/></svg>',data:{level:1}},{title:"Heading 2",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10 19 9.5 19 12C19 13.9771 16.0684 13.9997 16.0012 16.8981C15.9999 16.9533 16.0448 17 16.1 17L19.3 17"/></svg>',data:{level:2}},{title:"Heading 3",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10.5 16.8323 10 17.6 10C18.3677 10 19.5 10.311 19.5 11.5C19.5 12.5315 18.7474 12.9022 18.548 12.9823C18.5378 12.9864 18.5395 13.0047 18.5503 13.0063C18.8115 13.0456 20 13.3065 20 14.8C20 16 19.5 17 17.8 17C17.8 17 16 17 16 16.3"/></svg>',data:{level:3}}]},quote:{class:"Quote",inlineToolbar:!0,config:{quotePlaceholder:"è¾“å…¥å¼•ç”¨å†…å®¹",captionPlaceholder:"å¼•ç”¨æ¥æº"}},image:{class:"ImageTool",inlineToolbar:!0,config:{endpoints:{}}},delimiter:{class:"Delimiter"},raw:{class:"RawTool"},list:{class:"List"},code:{class:"Code"},marker:{class:"Marker"},inlineCode:{class:"InlineCode"},underline:{class:"Underline"}},minHeight:300,logLevel:"WARN"},n={toolbar:"js_toolbar_0",editorContent:'div[contenteditable="true"].ProseMirror',editorWrapper:"edui1_iframeholder",sidebar:"js_side_article_list",authorArea:"js_author_area",footerToolbar:"js_button_area"},i={head:'<section data-mpa-template="t" data-mpa-template-id="23968" data-mpa-category="style_single_material"><section style="display:flex;flex-direction:column;padding:0 10px;" data-mid=""><section style="display:flex;flex-direction:column;align-self:flex-start;" data-mid=""><section nodeleaf="" style="display:flex;justify-content:center;align-items:center;z-index:1;width:16px;margin:0 0 -1px 25px;" data-mid=""><img src="https://mmbiz.qpic.cn/mmbiz_png/dEf5U8O2YzjX7RPfmgLtXZGQ4emxXdzQs0UcN2m15pprg9EBQ6X6wYZvncMFvgT45MTASpAn6tyLMN2ibLGiawRA/0?from=appmsg" alt="" style="display:block;" data-mid=""></section><section style="background:#FFFFFF;border:1px solid #1a6840;padding:6px 18px 5px 19px;text-align:left;border-radius:32px;" data-mid=""><p yb-mpa-mark="mark-style-text" style="font-size:14px;color:#333333;line-height:20px;word-break:break-word;" data-mid="">ç‚¹å‡»ä¸Šæ–¹<span style="color:#1a6840;" data-mid="">è“å­—</span>å…³æ³¨æˆ‘ä»¬</p></section><section nodeleaf="" style="display:flex;justify-content:center;align-items:center;width:24px;align-self:center;margin:-6px 0 0 0;" data-mid=""><img src="https://mmbiz.qpic.cn/mmbiz_gif/YtIDLfKRkon8SLKBvmCfjvZ4I8azbdaFnZbM5cE2jjuApZCV2VwwWaUAgspNrka1Qn9VQnbH2064IVdEaFl37w/0?from=appmsg" alt="" style="display:block;" data-mid=""></section></section></section></section>',ending:"<section></section>",inlineStyles:{bold:"font-weight:bold;",italic:"font-style:italic;",underline:"text-decoration:underline;",strikethrough:"text-decoration:line-through;",code:"background:rgba(26,104,64,0.1);padding:2px 4px;border-radius:3px;font-family:'Courier New',monospace;font-size:0.9em;",mark:"background:rgba(26,104,64,0.2);padding:1px 2px;border-radius:2px;",small:"font-size:0.85em;",sup:"font-size:0.75em;vertical-align:super;",sub:"font-size:0.75em;vertical-align:sub;",link:"color:rgba(26,104,64,1);text-decoration:underline;transition:color 0.2s ease;",cite:"display:block;margin-top:0.5em;font-size:0.9em;color:rgba(26,104,64,0.7);"},header:{h1:'<section style="width: 100%; display: flex; justify-content: center; align-items: center; padding: 20px 14px 0;">\n  <section style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start;">\n    \n    <section style="display: flex; align-items: flex-start; justify-content: center;">\n      \n      \x3c!-- å·¦ä¾§ç¼–å·æ¨¡å— --\x3e\n      <section style="transform: skew(30deg); display: flex; align-items: flex-start; justify-content: center;">\n        <section style="background: #1a6840; text-align: center; padding: 0 8px; height: 28px;">\n          <p style="transform: skew(-30deg); font-weight: bold; font-size: 18px; color: #1a6840; line-height: 28px; text-align: center; -webkit-background-clip: text; background-image: linear-gradient(163deg, #ffffff 0%, #a5ffc0 100%); word-break: break-all; -webkit-text-fill-color: transparent;">\n            <span>01</span>\n          </p>\n        </section>\n        <section style="width: 1px; height: 42px; align-self: flex-start; background: linear-gradient(134deg, #1a6840, rgba(26, 104, 64, 0)); z-index: 2; margin-left: -1px;"></section>\n      </section>\n\n      \x3c!-- å³ä¾§æ ‡é¢˜æ¨¡å— --\x3e\n      <section style="display: flex; align-items: flex-start; justify-content: center; transform: skew(30deg);">\n        <section style="width: 1px; height: 42px; margin-top: -25px; margin-right: -1px; align-self: flex-start; background: linear-gradient(134deg, #ffffff, #d0ffd0); z-index: 2;"></section>\n        <section style="background: #e0ffe0; text-align: center; height: 28px; padding: 0 18px;">\n          <p style="transform: skew(-30deg); font-weight: bold; font-size: 17px; color: #1a6840; line-height: 28px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100vw;">\n            <span>{{content}}</span>\n          </p>\n        </section>\n      </section>\n\n    </section>\n\n  </section>\n</section>\n',h2:'<section style="display:flex;align-items:center;padding:16px 14px 0;">\n  <div style="width:4px;height:24px;background:#1a6840;margin-right:8px;border-radius:2px;"></div>\n  <p style="margin:0;font-size:16px;font-weight:600;color:#1a6840;">\n  {{content}}\n  </p>\n</section>',h3:'<section style="display:flex;align-items:center;padding:8px 18px;">\n  <div style="width:6px;height:6px;background:#1a6840;border-radius:50%;margin-right:8px;"></div>\n  <p style="margin:0;font-size:15px;font-weight:500;color:#2c6840;">\n  {{content}}\n  </p>\n</section>'},paragraph:{default:'<section style="margin-bottom:8px;margin-left:16px;margin-right:16px;"><div style="font-size:14px; line-height:2em;"><span style="letter-spacing:2px;">{{content}}</span></div></section>'},quote:{default:'<section style="margin-bottom:8px;margin-left:16px;margin-right:16px;"><blockquote style="background-color:rgba(26,104,64,0.1); border-left:4px solid #1a6840; padding:1em 1.5em; border-radius:6px; margin:0;"><p style="font-size:1.05em; color:#212529; margin:0; font-style:italic;">{{content}}</p><span style="display:block; text-align:right; color:rgba(26,104,64,0.7); font-size:1em; margin-top:1em;">â€”â€” {{caption}}</span></blockquote></section>'},delimiter:{default:'<section style="margin-bottom:8px;margin-left:16px;margin-right:16px;"><hr style="border:0; height:1px; background-image:linear-gradient(to right, rgba(26,104,64,0), rgba(26,104,64,0.25), rgba(26,104,64,0)); margin:2em 0;"></section>'},raw:{default:""},list:{ordered:'<section data-block="list" data-style="ordered" style="text-indent:0px;margin-bottom:8px;"><ol style="margin:1.5em 8px;padding-left:2em;">{{items}}</ol></section>',unordered:'<section data-block="list" data-style="unordered" style="text-indent:0px;margin-bottom:8px;"><ul style="margin:1.5em 8px;padding-left:2em;">{{items}}</ul></section>'},code:{default:'<section><pre style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.5;font-family:Menlo,Monaco,\'Courier New\',monospace;font-size:90%;overflow-x:auto;border-radius:8px;padding:1em;margin:10px 8px;background-color:#2d2d2d;border:1px solid #1a6840;" class="hljs code__pre"><span style="display:block;padding-bottom:10px;" class="mac-sign"><svg viewBox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.75;font-family:\'Fira Code\',Menlo,Operator Mono,Consolas,Monaco,monospace;font-size:90%;margin:0;white-space:pre;word-wrap:break-word;overflow-wrap:break-word;color:#e0e0e0;" class="language-python">{{content}}</code></pre></section>'},listItem:'<li style="margin:0.3em 0;">{{content}}</li>',fallback:{container:"margin:1.5em 8px;padding:0.5em;border:1px dashed rgba(26,104,64,0.3);background-color:rgba(26,104,64,0.05);",warning:"color:rgba(26,104,64,0.7);font-size:0.8em;",content:"margin-top:0.5em;"}};class r{constructor(e){this.templates=e}process(e,t){const n=this.preprocessData(e,t),i=this.getTemplate(n,t),r=this.renderContent(n,t);return this.postprocess(i,r,n,t)}preprocessData(e,t){return e}getTemplate(e,t){const n=t.type,i=this.templates[n];if(!i)return null;switch(n){case"header":return i[`h${Math.min(Math.max(e.level||1,1),6)}`]||i.default;case"list":return i["ordered"===e.style?"ordered":"unordered"]||i.default;default:return i.default||Object.values(i)[0]}}renderContent(e,t){return this.sanitizeHtml(this.processInlineStyles(e.text||e.content||""))}postprocess(e,t,n,i){return e?e.replace(/{{content}}/g,t):(console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i))}processInlineStyles(e){if(!e)return"";let t=String(e);const n=this.templates.inlineStyles,i={"<b>":`<strong style="${n.bold}">`,"</b>":"</strong>","<strong>":`<strong style="${n.bold}">`,"<i>":`<em style="${n.italic}">`,"</i>":"</em>","<em>":`<em style="${n.italic}">`,"<u>":`<u style="${n.underline}">`,"<s>":`<s style="${n.strikethrough}">`,"<del>":`<del style="${n.strikethrough}">`,"<code>":`<code style="${n.code}">`,"<mark>":`<mark style="${n.mark}">`,"<small>":`<small style="${n.small}">`,"<sup>":`<sup style="${n.sup}">`,"<sub>":`<sub style="${n.sub}">`};return t=this.processLinkTags(t),Object.entries(i).forEach((([e,n])=>{n.includes("style=")&&t.includes(e)||(t=t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n))})),t}processLinkTags(e){const t=this.templates.inlineStyles.link;return e.replace(/<a\s+href=["']([^"']+)["']([^>]*)>/g,((e,n,i)=>{if(i.includes("style="))return e;try{const e=new URL(n);return"mp.weixin.qq.com"===e.hostname?`<a href="${n}" style="${t}"${i}>`:this.handleNonWeixinLink(n,i,t)}catch(r){return`<a href="${n}" style="${t}"${i}>`}}))}handleNonWeixinLink(e,t,n){return`<a href="${e}" style="${n}"${t}>`}sanitizeHtml(e){let t=e;return["script","iframe","object","embed","form"].forEach((e=>{const n=new RegExp(`<${e}[^>]*>.*?</${e}>`,"gi");t=t.replace(n,"")})),t}escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}createFallbackHtml(e){var t,n,i;const r=(null==(t=e.data)?void 0:t.text)||(null==(n=e.data)?void 0:n.content)||(null==(i=e.data)?void 0:i.code)||"",o="code"===e.type?this.escapeHtml(r):this.sanitizeHtml(this.processInlineStyles(r)),s=this.templates.fallback;return`<section data-block="${e.type}" style="text-indent: 0px; margin-bottom: 8px;">\n      <div style="${s.container}">\n        <small style="${s.warning}">æœªçŸ¥å—ç±»å‹: ${e.type}</small>\n        <div style="${s.content}">${o}</div>\n      </div>\n    </section>`}}class o extends r{renderContent(e,t){return this.escapeHtml(e.text||"")}}class s extends r{renderContent(e,t){const n=e.code||"";return this.escapeHtml(n)}validateCodeSyntax(e,t){}}class a extends r{process(e,t){const n=e.html||"";return this.isValidHtml(n)||console.warn("Invalid HTML detected in raw block"),this.sanitizeHtml(n)}isValidHtml(e){try{const t=new DOMParser;return!t.parseFromString(e,"text/html").querySelector("parsererror")}catch(t){return!1}}}class l extends r{constructor(e,t={}){super(e),this.processCaptions=!1!==t.processCaptions}postprocess(e,t,n,i){if(!e)return console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i);let r=e.replace(/{{content}}/g,t);if(this.processCaptions&&n.caption){const e=`<cite style="${this.templates.inlineStyles.cite}">${this.sanitizeHtml(this.processInlineStyles(n.caption))}</cite>`;r=r.replace(/{{caption}}/g,e)}else r=r.replace(/{{caption}}/g,"");return r}}class c extends r{postprocess(e,t,n,i){if(!e)return console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i);const r=(n.items||[]).map((e=>{const t=this.sanitizeHtml(this.processInlineStyles(e));return this.renderListItem(t)})).join("");return e.replace(/{{items}}/g,r)}renderListItem(e){return this.templates.listItem.replace(/{{content}}/g,e)}}class d extends r{preprocessData(e,t){return{}}renderContent(e,t){return""}}class p{constructor(e){this.templates=e,this.processors=new Map,this.initializeDefaultProcessors()}initializeDefaultProcessors(){this.registerProcessor("header",new o(this.templates)),this.registerProcessor("code",new s(this.templates)),this.registerProcessor("raw",new a(this.templates)),this.registerProcessor("quote",new l(this.templates)),this.registerProcessor("list",new c(this.templates)),this.registerProcessor("delimiter",new d(this.templates)),this.registerProcessor("paragraph",new r(this.templates))}registerProcessor(e,t){this.processors.set(e,t)}getProcessor(e){return this.processors.get(e)||this.getDefaultProcessor()}getDefaultProcessor(){return new r(this.templates)}}class u{constructor(e={}){this.templates=Object.keys(e).length>0?e:i,this.processorFactory=new p(this.templates)}setTemplates(e){this.templates=e,this.processorFactory=new p(this.templates)}getTemplates(){return this.templates}registerCustomProcessor(e,t){this.processorFactory.registerProcessor(e,t)}parseBlock(e){if(!e||!e.type)return console.warn("æ— æ•ˆçš„å—æ•°æ®:",e),"";return this.processorFactory.getProcessor(e.type).process(e.data||{},e)}parse(e,t={}){const{skipEmpty:n=!0}=t;if(!e||!Array.isArray(e.blocks))return console.warn("æ— æ•ˆçš„EditorJSæ•°æ®"),"";const i=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return[this.templates.head||"",i,this.templates.ending||"",'<section><span leaf=""><br class="ProseMirror-trailingBreak"></span></section>'].filter((e=>e.trim())).join("\n")}registerTemplate(e,t,n="default"){this.templates[e]||(this.templates[e]={}),"string"==typeof t?this.templates[e][n]=t:"object"==typeof t&&(this.templates[e]={...this.templates[e],...t})}setTemplate(e,t,n){this.templates[e]||(this.templates[e]={}),this.templates[e][t]=n}renderDocument(e,t={}){const{skipEmpty:n=!0,wrapInContainer:i=!1}=t;if(!e||!Array.isArray(e.blocks))return console.warn("æ— æ•ˆçš„EditorJSæ•°æ®"),"";const r=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return i?`<div class="editorjs-content" style="max-width: 800px; margin: 0 auto; padding: 20px;">\n${r}\n</div>`:r}getAvailableTemplates(){return{...this.templates}}setTemplates(e){this.templates={...e}}}function h(e,t={}){const n=document.createElement(e);return t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.cssText&&(n.style.cssText=t.cssText),n}function g(e,t){let n;return"string"==typeof e?n=document.getElementById(e):e&&e.nodeType===Node.ELEMENT_NODE&&(n=e),!!n&&(n.style.display=t,!0)}function m(e){return g(e,"none")}function f(e){return g(e,"")}function w(e,t=document){try{return t.querySelector(e)}catch(n){return console.error(`æŸ¥è¯¢é€‰æ‹©å™¨å¤±è´¥: ${e}`,n),null}}async function y(e,t={}){try{const{targetSelector:i=n.editorContent,append:r=!0,insertPosition:o="cursor",styleOptions:s={}}=t,a=(new u).parse({blocks:e});console.log("ç”Ÿæˆçš„HTMLå†…å®¹:",a);const l=await async function(e,t={}){const{targetSelector:i=n.editorContent,append:r=!0,insertPosition:o="cursor"}=t;try{const t=w(i);if(!t)return console.error("æ‰¾ä¸åˆ°ç›®æ ‡ç¼–è¾‘å™¨:",i),!1;const n=h("div",{innerHTML:e});if(r)for(;n.firstChild;)t.appendChild(n.firstChild);else switch(o){case"start":for(;n.lastChild;)t.insertBefore(n.lastChild,t.firstChild);break;case"end":for(;n.firstChild;)t.appendChild(n.firstChild);break;default:t.innerHTML=e}return console.log("å†…å®¹æ’å…¥æˆåŠŸ"),!0}catch(s){return console.error("æ’å…¥å†…å®¹å¤±è´¥:",s),!1}}(a,{targetSelector:i,append:r,insertPosition:o});return l}catch(i){return console.error("ä¿å­˜åˆ°åŸç¼–è¾‘å™¨å¤±è´¥:",i),!1}}function x(){return!(!window.EditorJSBundle||!window.EditorJSBundle.EditorJS)}function b(e){if(!document.getElementById(e))throw new Error(`${e}å…ƒç´ ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥DOMç»“æ„`);try{const n={holder:e,tools:function(e){const t={};for(const[n,i]of Object.entries(e)){const{class:e,...r}=i;if(!window.EditorJSBundle||!window.EditorJSBundle[e]){console.warn(`å·¥å…·ç±» ${e} æœªæ‰¾åˆ°æˆ–æœªåŠ è½½ï¼Œè·³è¿‡å·¥å…· ${n}`);continue}const o=window.EditorJSBundle[e];o?t[n]={class:o,...r}:console.warn(`å·¥å…·ç±» ${e} æœªåŠ è½½ï¼Œè·³è¿‡å·¥å…· ${n}`)}return t}(t.tools),data:{blocks:[]},placeholder:t.placeholder,autofocus:t.autofocus,hideToolbar:t.hideToolbar,minHeight:t.minHeight,logLevel:t.logLevel,onReady:()=>{new window.EditorJSBundle.DragDrop(i)}},i=new window.EditorJSBundle.EditorJS(n);return i}catch(n){throw console.error("ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥:",n),n}}async function k(e){if(!x())try{await new Promise(((e,t)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",(n=>{n&&"injected"===n.status?setTimeout((()=>{x()?e():t(new Error("ç¼–è¾‘å™¨è„šæœ¬åŠ è½½å¤±è´¥"))}),100):t(new Error("ç¼–è¾‘å™¨æ³¨å…¥å¤±è´¥"))}))}))}catch(t){throw new Error("ç¼–è¾‘å™¨åŠ è½½å¤±è´¥: "+t.message)}return b(e)}async function v(){try{await async function(){if(z)return void console.debug("æ™ºèƒ½ç¼–è¾‘å™¨å·²ç»æ¿€æ´»");if(!w(n.editorContent))return void alert("æ‰¾ä¸åˆ°ç¼–è¾‘å™¨å®¹å™¨");try{!function(){m(document.getElementById(n.editorWrapper))||console.warn("[SmartEditor] æœªæ‰¾åˆ°åŸç¼–è¾‘å™¨iframeå®¹å™¨");const e=h("div",{id:"smart-editor-container",className:"flowedit-editor-container"});e.setAttribute("data-flowedit-plugin","smart-editor"),e.setAttribute("data-flowedit","true");const t=document.getElementById(n.authorArea);if(!t){const e=`ä½œè€…åŒºåŸŸæœªæ‰¾åˆ°: ${n.authorArea}`;throw console.error("[SmartEditor]",e),new Error(e)}const i=t.parentElement;if(!i){const e="ä½œè€…åŒºåŸŸçš„çˆ¶å…ƒç´ æœªæ‰¾åˆ°";throw console.error("[SmartEditor]",e),new Error(e)}i.insertBefore(e,t.nextSibling);const r=h("div",{id:"editor-holder",className:"flowedit-editor-holder"});e.appendChild(r),console.log("[SmartEditor] ç•Œé¢åˆ›å»ºå®Œæˆ")}(),C=function(e={}){const{onSave:t,onCancel:i}=e,r=h("div",{className:"flowedit-editor-action-bar"}),o=h("button",{textContent:"ğŸ’¾ ä¿å­˜",className:"flowedit-editor-save-btn"}),s=h("button",{textContent:"â†©ï¸ å–æ¶ˆ",className:"flowedit-editor-cancel-btn"});r.appendChild(o),r.appendChild(s);const a=document.getElementById(n.footerToolbar);return a?(m(a),a.parentNode.insertBefore(r,a.nextSibling)):(console.warn("æ‰¾ä¸åˆ°åº•éƒ¨å·¥å…·æ å…ƒç´ ï¼Œå°†æ§åˆ¶æ æ·»åŠ åˆ°body"),document.body.appendChild(r)),t&&"function"==typeof t&&o.addEventListener("click",t),i&&"function"==typeof i&&s.addEventListener("click",i),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ§åˆ¶æ åˆ›å»ºå®Œæˆï¼Œå·²æ’å…¥åˆ°DOMä¸­"),r}({onSave:T,onCancel:$}),await new Promise((e=>setTimeout(e,50))),z=await k("editor-holder");const e=w("#header");e&&(await new Promise((e=>setTimeout(e,100))),e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),console.log("å·²æ»šåŠ¨åˆ°æ™ºèƒ½ç¼–è¾‘å™¨ä½ç½®")),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ¿€æ´»æˆåŠŸ")}catch(e){console.error("æ™ºèƒ½æ’å…¥åŠŸèƒ½å¯åŠ¨å¤±è´¥:",e),alert("æ™ºèƒ½æ’å…¥åŠŸèƒ½å¯åŠ¨å¤±è´¥"),$()}}()}catch(e){console.error("æ™ºèƒ½æ’å…¥æŒ‰é’®ç‚¹å‡»å¤„ç†å¤±è´¥:",e)}}new u;let z=null,C=null,E=null;function S(){if(E)console.warn("æ™ºèƒ½æ’å…¥æŒ‰é’®åŠŸèƒ½å·²ç»åˆå§‹åŒ–");else try{E=function(){const e=h("button",{className:"flowedit-smart-btn",textContent:"æ™ºèƒ½æ’å…¥"});e.setAttribute("data-flowedit-plugin","smart-button"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",v);const t=document.getElementById(n.toolbar);if(!t){const e=`å·¥å…·æ å®¹å™¨æœªæ‰¾åˆ°: ${n.toolbar}`;throw console.error("[SmartButton]",e),new Error(e)}return t.appendChild(e),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("æ™ºèƒ½æ’å…¥æŒ‰é’®æˆåŠŸ")}catch(e){console.error("æ™ºèƒ½ç¼–è¾‘å™¨åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:",e)}}function $(){!function(){const e=document.getElementById("smart-editor-container");e&&e.remove(),f(document.getElementById(n.editorWrapper)),console.log("[SmartEditor] ç•Œé¢å·²ç§»é™¤")}(),C&&(!function(e){e&&(e.remove(),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ§åˆ¶æ å·²ç§»é™¤"));const t=document.getElementById(n.footerToolbar);t&&f(t)}(C),C=null),z&&(!function(e){if(e)try{e.destroy()}catch(t){console.warn("ç¼–è¾‘å™¨é”€æ¯é”™è¯¯:",t)}}(z),z=null),console.log("æ™ºèƒ½ç¼–è¾‘å™¨å·²åœç”¨")}async function T(e={}){if(z)try{const t=await z.save();console.log("ä¿å­˜çš„æ•°æ®:",t);await y(t.blocks,{...e})?console.log("å†…å®¹å·²æˆåŠŸä¿å­˜åˆ°åŸç¼–è¾‘å™¨"):console.error("ä¿å­˜åˆ°åŸç¼–è¾‘å™¨å¤±è´¥")}catch(t){console.error("ä¿å­˜å¤±è´¥:",t)}finally{$()}else console.error("ç¼–è¾‘å™¨æœªåˆå§‹åŒ–")}const L={name:"smart-editor",initialize:async()=>{S()},cleanup:()=>{$(),E&&E.cleanup&&(E.cleanup(),E=null,console.log("æ™ºèƒ½ç¼–è¾‘å™¨åŠŸèƒ½å·²æ¸…ç†"))},isEnabled:()=>!0,isActive:()=>null!==z};function M(e){const t=document.getElementById(n.sidebar);if(t&&e&&e.currentTarget){const n=e.currentTarget;n.classList.contains("on")?(n.classList.remove("on"),f(t)):(n.classList.add("on"),m(t))}}let I=null;function P(){if(I)console.warn("ä¾§è¾¹æ åŠŸèƒ½å·²ç»åˆå§‹åŒ–");else try{I=function(){const e=h("div",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});e.setAttribute("data-flowedit-plugin","sidebar-toggle"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",M);const t=document.getElementById(n.toolbar);if(!t){const e=`å·¥å…·æ å®¹å™¨æœªæ‰¾åˆ°: ${n.toolbar}`;throw console.error("[SidebarToggle]",e),new Error(e)}return t.insertBefore(e,t.firstChild),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("ä¾§è¾¹æ åŠŸèƒ½åˆå§‹åŒ–æˆåŠŸ")}catch(e){console.error("ä¾§è¾¹æ åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:",e)}}const H={name:"sidebar",initialize:async()=>{P()},cleanup:()=>{I&&I.cleanup&&(I.cleanup(),I=null,console.log("ä¾§è¾¹æ åŠŸèƒ½å·²æ¸…ç†"))},isEnabled:()=>!0,isActive:()=>null!==I};const A=new class{constructor(){this.config={},this.initialized=!1}async initialize(){try{this.initialized=!0}catch(e){throw console.error("ç”¨æˆ·é…ç½®ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:",e),e}}getUserConfig(e){return this.initialized?e?this.config[e]:this.config:(console.warn("ç”¨æˆ·é…ç½®ç®¡ç†å™¨æœªåˆå§‹åŒ–"),null)}async setUserConfig(e,t){try{return this.initialized?("object"==typeof e?this.config={...this.config,...e}:this.config[e]=t,!0):(console.warn("ç”¨æˆ·é…ç½®ç®¡ç†å™¨æœªåˆå§‹åŒ–"),!1)}catch(n){return console.error("è®¾ç½®ç”¨æˆ·é…ç½®å¤±è´¥:",n),!1}}},B=new class{constructor(){this.initialized=!1,this.styleCache={},this.syncInterval=null}async initialize(){try{this.initialized=!0}catch(e){throw console.error("è¿œç¨‹æ ·å¼åŒæ­¥æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",e),e}}async manualSync(){try{return!!this.initialized||(console.warn("è¿œç¨‹æ ·å¼åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–"),!1)}catch(e){return console.error("è¿œç¨‹æ ·å¼åŒæ­¥å¤±è´¥:",e),!1}}startAutoSync(e=3e4){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval((async()=>{await this.manualSync()}),e)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}};async function j(e={}){try{return await A.initialize(),await async function(e={}){try{if(await B.initialize(),!1!==e.enableAutoSync){const t=e.syncInterval||3e4;B.startAutoSync(t)}!1!==e.initialSync&&await B.manualSync()}catch(t){console.error("è¿œç¨‹æ ·å¼ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",t)}}(e),!0}catch(t){return console.error("FlowEditåº”ç”¨æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",t),!1}}const F=new class{constructor(){this.isWatching=!1,this.reinitTimeout=null,this.clickHandler=null}startWatching(){this.isWatching||(this.clickHandler=e=>{this.handleSubmitClick(e)},document.addEventListener("click",this.clickHandler,!0),this.isWatching=!0)}stopWatching(){this.clickHandler&&(document.removeEventListener("click",this.clickHandler,!0),this.clickHandler=null),this.reinitTimeout&&(clearTimeout(this.reinitTimeout),this.reinitTimeout=null),this.isWatching=!1}handleSubmitClick(e){const t=e.target;this.isSubmitButton(t)&&(this.reinitTimeout&&clearTimeout(this.reinitTimeout),this.reinitTimeout=setTimeout((()=>{this.reinitializePlugins()}),800))}isSubmitButton(e){if(!e)return!1;if(this.checkElementIsSubmit(e))return!0;let t=e.parentElement,n=0;for(;t&&n<3;){if(this.checkElementIsSubmit(t))return!0;t=t.parentElement,n++}return!1}checkElementIsSubmit(e){var t;return null==(t=e.classList)?void 0:t.contains("send_wording")}async reinitializePlugins(){try{await e.cleanupAll(),await new Promise((e=>setTimeout(e,1e3)));const t=await e.initializeAll();t.failed.length>0&&console.warn(`[DOMWatcher] é‡æ–°åˆå§‹åŒ–å¤±è´¥: ${t.failed.join(", ")}`)}catch(t){console.error("[DOMWatcher] é‡æ–°åˆå§‹åŒ–æ’ä»¶å¤±è´¥:",t)}}};async function N(){if(!document.querySelector("#js_toolbar_0"))return;!function(){const e="flow-editor-plugin-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.setAttribute("data-flowedit-plugin-ui","true"),t.textContent="\n      /* FlowEdit æ’ä»¶UIæ ·å¼ */\n      \n  /* æ‰©å±•æŒ‰é’®åŸºç¡€æ ·å¼ */\n  .flowedit-smart-btn {\n    /* åŸºç¡€å¸ƒå±€æ ·å¼ */\n    position: relative;\n    display: inline-block;\n    height: 22px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n    \n    /* ç‰¹å®šæ ·å¼ */\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n    transition: all 0.3s ease;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥æŒ‰é’®æ‚¬æµ®æ•ˆæœ */\n  .flowedit-smart-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n      \n  /* Switchå¼€å…³æ ·å¼ */\n  .flowedit-switch {\n    position: relative;\n    display: inline-block;\n    width: 40px;\n    height: 20px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: all 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* æ™ºèƒ½æ’å…¥ç¼–è¾‘å™¨å®¹å™¨æ ·å¼ */\n  .flowedit-editor-container {\n    position: relative; /* æ”¹ä¸ºç›¸å¯¹å®šä½ï¼Œé€‚åˆç›´æ¥æ’å…¥ */\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;More actions\n    background: #fff;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥ç¼–è¾‘å™¨å ä½å…ƒç´ æ ·å¼ */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0;\n    padding-left: 91px;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥æ§åˆ¶æ æ ·å¼ */\n  .flowedit-editor-action-bar {\n    position: relative; /* æ”¹ä¸ºç›¸å¯¹å®šä½ï¼Œé€‚é…ç›´æ¥æ’å…¥DOM */\n    background-color: #ffffff;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    gap: 15px;\n    padding: 20px 20px 15px 20px; /* æ·»åŠ ä¸Šä¸‹å†…è¾¹è· */\n    box-sizing: border-box;\n    width: 768px;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥ä¿å­˜æŒ‰é’®æ ·å¼ */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n  \n\n  \n  /* æ™ºèƒ½æ’å…¥å–æ¶ˆæŒ‰é’®æ ·å¼ */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n\n    ",document.head.appendChild(t)}}();const t=await e.initializeAll();t.failed.length>0&&console.warn(`åˆå§‹åŒ–å¤±è´¥çš„åŠŸèƒ½æ¨¡å—: ${t.failed.join(", ")}`),F.startWatching()}e.register("smart-editor",L),e.register("sidebar",H),window.addEventListener("beforeunload",(()=>{F.stopWatching()})),async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e)}));try{await j()}catch(e){console.error("[FlowEdit] initializeAppServicesåˆå§‹åŒ–å¤±è´¥:",e)}await N()}().catch((e=>{console.error("FlowEdit å¯åŠ¨å¤±è´¥:",e)}))}();

!function(){"use strict";let t=null,n={},e=null;function o(){try{t=new EditorJS({holder:"editor-holder",tools:{paragraph:{class:Paragraph,inlineToolbar:!0},header:{class:Header,inlineToolbar:!0,config:{placeholder:"请输入标题",levels:[2,3,4],defaultLevel:2}}},data:a(),placeholder:"在此输入内容..."});const n=document.createElement("style");n.innerHTML="\n      .ce-toolbar__plus {\n        left: 0 !important;\n        right: auto !important;\n      }\n    ",document.head.appendChild(n)}catch(n){console.error("编辑器初始化失败:",n),i()}}async function r(){if(t)try{const{blocks:n}=await t.save(),e=document.querySelector("#ueditor_0 .ProseMirror");e?(e.innerHTML=n.map((t=>`<p>${t.data.text.replace(/\n/g,"<br>")}</p>`)).join(""),alert("内容已保存！")):alert("警告：找不到目标编辑器，已恢复原状")}catch(n){console.error("保存失败:",n),alert("保存失败，请查看控制台")}finally{i()}}function i(){n.js_button_area_children&&n.js_button_area_children.forEach((({element:t,display:n})=>{t.style.display=n})),["ueditor_0","article_setting_area"].forEach((t=>{const e=document.getElementById(t);e&&void 0!==n[t]&&(e.style.display=n[t])}));const o=document.getElementById("smart-editor-container");if(o&&o.remove(),e&&(e.remove(),e=null),t){try{t.destroy()}catch(r){console.warn("编辑器销毁错误:",r)}t=null}}function a(){const t=document.querySelector("#ueditor_0 .ProseMirror");if(!t)return{blocks:[]};const n=t.textContent.trim();return n?{blocks:[{type:"paragraph",data:{text:n}}]}:{blocks:[]}}!function(){const t="my-extension-styles";if(!document.getElementById(t)){const n=document.createElement("style");n.id=t,n.textContent="\n      /* 重置所有扩展元素的默认样式 */\n      .my-ext-btn, .my-ext-switch {\n        all: unset !important;\n        display: inline-block !important;\n        height: 22px !important;\n        margin: 1px 4px !important;\n        vertical-align: middle !important;\n        cursor: pointer !important;\n      }\n      /* 智能插入按钮样式 */\n      .my-ext-smart-btn {\n        background-color: #07c160 !important;\n        color: white !important;\n        border-radius: 4px !important;\n        padding: 0 12px !important;\n        font-size: 12px !important;\n        line-height: 22px !important;\n      }\n      /* Switch开关样式 */\n      .my-ext-switch {\n        position: relative !important;\n        width: 40px !important;\n      }\n      .my-ext-switch-track {\n        position: absolute !important;\n        top: 0 !important;\n        left: 0 !important;\n        right: 0 !important;\n        bottom: 0 !important;\n        background-color: #ccc !important;\n        border-radius: 11px !important;\n        transition: background-color 0.3s !important;\n      }\n      .my-ext-switch-thumb {\n        position: absolute !important;\n        width: 18px !important;\n        height: 18px !important;\n        left: 2px !important;\n        bottom: 2px !important;\n        background-color: white !important;\n        border-radius: 50% !important;\n        transition: transform 0.3s !important;\n      }\n      .my-ext-switch.on .my-ext-switch-track {\n        background-color: #07c160 !important;\n      }\n      .my-ext-switch.on .my-ext-switch-thumb {\n        transform: translateX(18px) !important;\n      }\n    ",document.head.appendChild(n)}}();const c=document.getElementById("js_toolbar_0");c&&(c.insertBefore(function(){const t=document.createElement("div");t.className="my-ext-switch",t.innerHTML='\n    <div class="my-ext-switch-track"></div>\n    <div class="my-ext-switch-thumb"></div>\n  ';let n=!1;return t.addEventListener("click",(()=>{n=!n,t.classList.toggle("on",n);const e=document.getElementById("js_side_article_list");e&&(e.style.display=n?"none":"block")})),t}(),c.firstChild),c.appendChild(function(){const a=document.createElement("button");return a.className="my-ext-btn my-ext-smart-btn",a.textContent="智能插入",a.addEventListener("click",(async()=>{if(t)return;const a=document.getElementById("ueditor_0");if(!a)return alert("找不到编辑器容器");n={},["ueditor_0","article_setting_area"].forEach((t=>{const e=document.getElementById(t);e&&(n[t]=e.style.display,e.style.display="none")}));const c=document.getElementById("js_button_area");if(c){const t=Array.from(c.children);n.js_button_area_children=t.map((t=>({element:t,display:t.style.display}))),t.forEach((t=>{t.style.display="none"}))}const s=document.createElement("div");s.id="smart-editor-container",s.style.cssText="\n      margin-top: 10px;\n      border: 2px solidrgb(168, 248, 206);\n      border-radius: 4px;\n      background: white;\n      z-index: 9998;\n      padding: 10px;\n    ",a.parentNode.insertBefore(s,a.nextSibling);const l=document.createElement("div");l.id="editor-holder",l.style.minHeight="400px",s.appendChild(l),e=document.createElement("div"),e.className="editor_action_bar",e.style.cssText="\n      padding: 20px 20px 15px 20px;\n      margin: 0;\n      background-color: #ffffff;\n      color: rgb(53, 53, 53);\n      font-family: mp-quote, 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;\n      font-size: 14px;\n      line-height: 22.4px;\n      word-break: break-all;\n      box-sizing: content-box;\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      z-index: 1000;\n    ";const d=document.createElement("button");d.textContent="💾 保存",d.style.cssText="\n      padding: 4px 12px;\n      height: 34px;\n      width: 98px;\n      display: inline-block;\n      background: #07c160;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n    ";const p=document.createElement("button");if(p.textContent="↩️ 取消",p.style.cssText="\n      padding: 4px 12px;\n      height: 34px;\n      width: 98px;\n      display: inline-block;\n      background: #999999;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n    ",e.appendChild(d),e.appendChild(p),c?c.appendChild(e):(console.warn("找不到js_button_area，将controlBar添加到body"),document.body.appendChild(e)),d.addEventListener("click",r),p.addEventListener("click",i),window.EditorJS)o();else try{chrome.runtime.sendMessage("inject_editorjs_bundle",(t=>{t&&"injected"===t.status?setTimeout((()=>{window.EditorJS&&window.Paragraph?o():(alert("编辑器加载失败"),i())}),100):(alert("编辑器加载失败"),i())}))}catch(m){return console.error("编辑器加载失败:",m),alert("编辑器加载失败"),void i()}})),a}()))}();

!function(){"use strict";function e(e,t={}){const n=document.createElement(e);return t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.cssText&&(n.style.cssText=t.cssText),n}function t(e,t=document){try{return t.querySelector(e)}catch(n){return console.error(`查询选择器失败: ${e}`,n),null}}const n=e=>`\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20">\n    <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"\n        font-family="monospace" font-size="12">${e}</text>\n</svg>`,o={placeholder:"开始输入内容...",autofocus:!0,hideToolbar:!1,tools:{paragraph:{class:"Paragraph",inlineToolbar:!0},header:{class:"Header",inlineToolbar:!0,config:{levels:[1,2,3],defaultLevel:1,placeholder:"请输入标题"},toolbox:[{title:"Heading 1",icon:n("H1"),data:{level:1}},{title:"Heading 2",icon:n("H2"),data:{level:2}},{title:"Heading 3",icon:n("H3"),data:{level:3}}]},quote:{class:"Quote",inlineToolbar:!0,config:{quotePlaceholder:"输入引用内容",captionPlaceholder:"引用来源"}},image:{class:"ImageTool",inlineToolbar:!0,config:{endpoints:{}}},raw:{class:"RawTool"}},minHeight:300,logLevel:"WARN"},i={insertMethod:"insertBefore",targetElement:"firstElementChild"},a={insertMethod:"appendChild",targetElement:null},r={toolbar:"#js_toolbar_0",editorContent:'div[contenteditable="true"].ProseMirror',editorWrapper:"#edui1_iframeholder",editorToHide:["#ueditor_0","#article_setting_area","#js_button_area"],buttonArea:"#bottom_main",sidebar:"#js_side_article_list"},s={head:'<section data-mpa-template="t" data-mpa-template-id="23968" data-mpa-category="style_single_material"><section style="display: flex;flex-direction: column;padding: 0 10px;" data-mid=""><section style="display: flex;flex-direction: column;align-self: flex-start;" data-mid=""><section nodeleaf="" style="display: flex;justify-content: center;align-items: center;z-index: 1;width: 16px;margin: 0 0 -1px 25px;" data-mid=""><img src="https://mmbiz.qpic.cn/mmbiz_png/dEf5U8O2YzjX7RPfmgLtXZGQ4emxXdzQs0UcN2m15pprg9EBQ6X6wYZvncMFvgT45MTASpAn6tyLMN2ibLGiawRA/0?from=appmsg" alt="" style="display: block;" data-mid=""></section><section style="background: #FFFFFF;border: 1px solid #0092FF;padding: 6px 18px 5px 19px;text-align: left;border-radius: 32px;" data-mid=""><p yb-mpa-mark="mark-style-text" style="font-size: 14px;color: #333333;line-height: 20px;word-break: break-word;" data-mid="">点击上方<span style="color: #0092ff;" data-mid="">蓝字</span>关注我们</p></section><section nodeleaf="" style="display: flex;justify-content: center;align-items: center;width: 24px;align-self: center;margin: -6px 0 0 0;" data-mid=""><img src="https://mmbiz.qpic.cn/mmbiz_gif/YtIDLfKRkon8SLKBvmCfjvZ4I8azbdaFnZbM5cE2jjuApZCV2VwwWaUAgspNrka1Qn9VQnbH2064IVdEaFl37w/0?from=appmsg" alt="" style="display: block;" data-mid=""></section></section></section></section>',ending:'<section data-mpa-template="t" data-mpa-template-id="23502" data-mpa-category="style_single_material"><section style="display: flex;flex-direction: column;" data-mid=""><section style="align-self: center;display: flex;flex-direction: column;" data-mid=""><section style="width: 100px;margin: 0 0 -21px 16px;" data-mid=""><section style="text-align: center;margin: 0 0 -16px 0;" data-mid=""><p style="font-weight: bold;font-size: 20px;color: #F1F5FF;line-height: 28px;word-break: break-word;" data-mid="">HISTORY</p></section><section style="text-align: center;" data-mid=""><p style="font-weight: bold;font-size: 16px;color: #FFD750;line-height: 22px;word-break: break-word;" data-mid="">往期推荐 </p></section></section><section style="display: flex;justify-content: center;align-items: center;width: 267px;" data-mid=""><img src="https://mmbiz.qpic.cn/mmbiz_png/JnFVjHuvmJ8D1wqQf1Fef720vyhcqcoLFlPOcljZibuqdMVpKMhfnRvkraoM2pZmlvPe4Ewm8Np90Gqq9BLBufw/0?from=appmsg" data-mid=""></section><section style="width: 267px;border: 1px solid #86A4FF;border-top: none !important;padding: 8px;" data-mid=""><section style="display: flex;flex-direction: column;padding: 10px 0 11px 0;background: #F1F5FF;" data-mid=""><section data-mpa-template-rows="1" style="width: 100%;padding: 21px 27px 20px 27px;" data-mid=""><section style="display: flex;align-items: flex-start;padding: 5px 5px 5px 5px;border-bottom: 1.3px dashed #86A4FF;" data-mid=""><section style="width: 9px;height: 9px;background: #86A4FF;margin: 5px 8px 0 0;transform: skewX(-10deg);" data-mid=""></section><section style="text-align: left;" data-mid=""><p style="font-size: 14px;color: #000000;line-height: 20px;word-break: break-word;" data-mid="">当季出游穿搭分享</p></section></section>\n  <section style="display: flex;align-items: flex-start;padding: 5px 5px 5px 5px;border-bottom: 1.3px dashed #86A4FF;" data-mid=""><section style="width: 9px;height: 9px;background: #86A4FF;margin: 5px 8px 0 0;transform: skewX(-10deg);" data-mid=""></section><section style="text-align: left;" data-mid=""><p style="font-size: 14px;color: #000000;line-height: 20px;word-break: break-word;" data-mid="">减脂人初春低糖饮品推荐</p></section></section><section style="display: flex;align-items: flex-start;padding: 5px 5px 5px 5px;border-bottom: 1.3px dashed #86A4FF;" data-mid=""><section style="width: 9px;height: 9px;background: #86A4FF;margin: 5px 8px 0 0;transform: skewX(-10deg);" data-mid=""></section><section style="text-align: left;" data-mid=""><p style="font-size: 14px;color: #000000;line-height: 20px;word-break: break-word;" data-mid="">五一踏青旅游胜地推荐</p></section></section></section></section></section></section></section></section>',inlineStyles:{bold:"font-weight: bold;",italic:"font-style: italic;",underline:"text-decoration: underline;",strikethrough:"text-decoration: line-through;",code:"background: rgba(26, 104, 64, 0.1); padding: 2px 4px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em;",mark:"background: rgba(26, 104, 64, 0.2); padding: 1px 2px; border-radius: 2px;",small:"font-size: 0.85em;",sup:"font-size: 0.75em; vertical-align: super;",sub:"font-size: 0.75em; vertical-align: sub;",link:"color: rgba(26, 104, 64, 1); text-decoration: underline; transition: color 0.2s ease;",cite:"display: block; margin-top: 0.5em; font-size: 0.9em; color: rgba(26, 104, 64, 0.7);"},header:{h1:'<section data-mpa-template="t" data-mpa-template-id="7371" data-mpa-category="style_single_material"><section style="width: 100%;padding: 0px 12px;" data-mid=""><section style="width: 100%;display: flex;align-items: center;justify-content: space-between;" data-mid=""><section style="display: flex;align-items: center;width: 100%;height: 5px;" data-mid=""><section style="flex-shrink: 0;width: 6px;height: 6px;background: #4499e7;border-radius: 50%;" data-mid=""><span leaf=""><br class="ProseMirror-trailingBreak"></span></section><section style="width: 100%;border-top: 1px solid #4499e7;height: 1px;" data-mid=""><span leaf=""><br class="ProseMirror-trailingBreak"></span></section></section><section style="flex-shrink: 0;min-width: 79px;text-align: center;background: #4499e7;padding: 5px 15px 4px 15px;" data-mid=""><p style="color: #ffffff;font-size: 16px;line-height: 17px;word-break: break-word;" data-mid=""><span leaf="">{{content}}</span><mpchecktext></mpchecktext></p></section><section style="display: flex;align-items: center;width: 100%;" data-mid=""><section style="width: 100%;border-top: 1px solid #4499e7;height: 1px;" data-mid=""><span leaf=""><br class="ProseMirror-trailingBreak"></span></section><section style="flex-shrink: 0;width: 6px;height: 6px;background: #4499e7;border-radius: 50%;" data-mid=""><span leaf=""><br class="ProseMirror-trailingBreak"></span></section></section></section></section></section>',h2:'<section data-block="header" data-level="2" style="text-indent: 0px; margin-bottom: 8px;">\n      <h2 style="font-size: 17px; color: rgba(26, 104, 64, 1); font-weight: bold; margin: 1.5em 8px 1em; border-bottom: 1px solid rgba(26, 104, 64, 0.3); padding-bottom: 0.3em;">\n        {{content}}\n      </h2>\n    </section>',h3:'<section data-block="header" data-level="3" style="text-indent: 0px; margin-bottom: 8px;">\n      <h3 style="font-size: 15px; color: rgba(26, 104, 64, 1); font-weight: bold; margin: 1.2em 8px 0.8em;">\n        {{content}}\n      </h3>\n    </section>',h4:'<section data-block="header" data-level="4" style="text-indent: 0px; margin-bottom: 8px;">\n      <h4 style="font-size: 14px; color: rgba(26, 104, 64, 1); font-weight: bold; margin: 1em 8px 0.6em;">\n        {{content}}\n      </h4>\n    </section>',h5:'<section data-block="header" data-level="5" style="text-indent: 0px; margin-bottom: 8px;">\n      <h5 style="font-size: 13px; color: rgba(26, 104, 64, 1); font-weight: bold; margin: 0.8em 8px 0.5em;">\n        {{content}}\n      </h5>\n    </section>',h6:'<section data-block="header" data-level="6" style="text-indent: 0px; margin-bottom: 8px;">\n      <h6 style="font-size: 12px; color: rgba(26, 104, 64, 1); font-weight: bold; margin: 0.6em 8px 0.4em;">\n        {{content}}\n      </h6>\n    </section>'},paragraph:{default:'<section data-block="paragraph" style="text-indent: 0px; margin-bottom: 8px;">\n      <p style="margin: 1.5em 8px; letter-spacing: 0.1em;">\n        {{content}}\n      </p>\n    </section>'},quote:{default:'<section data-block="quote" style="text-indent: 0px; margin-bottom: 8px;">\n      <blockquote style="margin: 1.5em 8px; padding: 1em; border-left: 4px solid rgba(26, 104, 64, 0.5); background-color: rgba(26, 104, 64, 0.05); font-style: italic;">\n        {{content}}\n        {{caption}}\n      </blockquote>\n    </section>'},delimiter:{default:'<section data-block="delimiter" style="text-indent: 0px; margin-bottom: 8px;">\n      <div style="text-align: center; margin: 2em 8px; color: rgba(26, 104, 64, 0.6); font-size: 1.2em;">\n        ***\n      </div>\n    </section>'},list:{ordered:'<section data-block="list" data-style="ordered" style="text-indent: 0px; margin-bottom: 8px;">\n      <ol style="margin: 1.5em 8px; padding-left: 2em;">\n        {{items}}\n      </ol>\n    </section>',unordered:'<section data-block="list" data-style="unordered" style="text-indent: 0px; margin-bottom: 8px;">\n      <ul style="margin: 1.5em 8px; padding-left: 2em;">\n        {{items}}\n      </ul>\n    </section>'},code:{default:'<section data-block="code" style="text-indent: 0px; margin-bottom: 8px;">\n      <pre style="margin: 1.5em 8px; padding: 1em; background-color: rgba(26, 104, 64, 0.08); border-radius: 4px; overflow-x: auto;"><code style="font-family: \'Courier New\', monospace; font-size: 14px;">{{content}}</code></pre>\n    </section>'},listItem:'<li style="margin: 0.3em 0;">{{content}}</li>',fallback:{container:"margin: 1.5em 8px; padding: 0.5em; border: 1px dashed rgba(26, 104, 64, 0.3); background-color: rgba(26, 104, 64, 0.05);",warning:"color: rgba(26, 104, 64, 0.7); font-size: 0.8em;",content:"margin-top: 0.5em;"}};class l{constructor(e={}){this.templates=this.mergeTemplates(s,e)}mergeTemplates(e,t){const n={...e};for(const[o,i]of Object.entries(t))n[o]?n[o]={...n[o],...i}:n[o]=i;return n}parseBlock(e){if(!e||!e.type)return console.warn("无效的块数据:",e),"";const t=e.type,n=e.data||{},o=this.getTemplate(t,n);return o?this.renderTemplate(o,n,t):(console.warn(`未找到块类型 ${t} 的模板`),this.createFallbackHtml(e))}getTemplate(e,t){const n=this.templates[e];if(!n)return null;switch(e){case"header":return n[`h${Math.min(Math.max(t.level||1,1),6)}`]||n.default;case"list":return n["ordered"===t.style?"ordered":"unordered"]||n.default;default:return n.default||Object.values(n)[0]}}renderTemplate(e,t,n){let o=e;switch(n){case"header":case"paragraph":const e=this.sanitizeHtml(this.processInlineStyles(t.text||""));o=o.replace(/{{content}}/g,e);break;case"quote":const n=this.sanitizeHtml(this.processInlineStyles(t.text||""));o=o.replace(/{{content}}/g,n);const i=t.caption?`<cite style="${this.templates.inlineStyles.cite}">${this.sanitizeHtml(this.processInlineStyles(t.caption))}</cite>`:"";o=o.replace(/{{caption}}/g,i);break;case"list":const a=(t.items||[]).map((e=>{const t=this.sanitizeHtml(this.processInlineStyles(e));return this.renderListItem(t)})).join("");o=o.replace(/{{items}}/g,a);break;case"code":o=o.replace(/{{content}}/g,this.escapeHtml(t.code||""));break;case"delimiter":break;default:const r=this.sanitizeHtml(this.processInlineStyles(t.text||t.content||""));o=o.replace(/{{content}}/g,r)}return o}renderListItem(e){return this.templates.listItem.replace(/{{content}}/g,e)}createFallbackHtml(e){var t,n,o;const i=(null==(t=e.data)?void 0:t.text)||(null==(n=e.data)?void 0:n.content)||(null==(o=e.data)?void 0:o.code)||"",a="code"===e.type?this.escapeHtml(i):this.sanitizeHtml(this.processInlineStyles(i)),r=this.templates.fallback;return`<section data-block="${e.type}" style="text-indent: 0px; margin-bottom: 8px;">\n      <div style="${r.container}">\n        <small style="${r.warning}">未知块类型: ${e.type}</small>\n        <div style="${r.content}">${a}</div>\n      </div>\n    </section>`}processInlineStyles(e){if(!e)return"";let t=String(e);const n=this.templates.inlineStyles,o={"<b>":`<strong style="${n.bold}">`,"</b>":"</strong>","<strong>":`<strong style="${n.bold}">`,"<i>":`<em style="${n.italic}">`,"</i>":"</em>","<em>":`<em style="${n.italic}">`,"<u>":`<u style="${n.underline}">`,"<s>":`<s style="${n.strikethrough}">`,"<del>":`<del style="${n.strikethrough}">`,"<code>":`<code style="${n.code}">`,"<mark>":`<mark style="${n.mark}">`,"<small>":`<small style="${n.small}">`,"<sup>":`<sup style="${n.sup}">`,"<sub>":`<sub style="${n.sub}">`};return t=this.processLinkTags(t),Object.entries(o).forEach((([e,n])=>{n.includes("style=")&&t.includes(e)||(t=t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n))})),t}processLinkTags(e){const t=this.templates.inlineStyles.link;return e.replace(/<a\s+href=["']([^"']+)["']([^>]*)>/g,((e,n,o)=>{if(o.includes("style="))return e;try{const e=new URL(n);return"mp.weixin.qq.com"===e.hostname?`<a href="${n}" style="${t}"${o}>`:this.handleNonWeixinLink(n,o,t)}catch(i){return`<a href="${n}" style="${t}"${o}>`}}))}handleNonWeixinLink(e,t,n){return`<a href="${e}" style="${n}"${t}>`}sanitizeHtml(e){let t=e;return["script","iframe","object","embed","form"].forEach((e=>{const n=new RegExp(`<${e}[^>]*>.*?</${e}>`,"gi");t=t.replace(n,"")})),t}escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}parse(e,t={}){const{skipEmpty:n=!0}=t;if(!e||!Array.isArray(e.blocks))return console.warn("无效的EditorJS数据"),"";const o=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return[this.templates.head||"",o,this.templates.ending||"",'<section><span leaf=""><br class="ProseMirror-trailingBreak"></span></section>'].filter((e=>e.trim())).join("\n")}registerTemplate(e,t,n="default"){this.templates[e]||(this.templates[e]={}),"string"==typeof t?this.templates[e][n]=t:"object"==typeof t&&(this.templates[e]={...this.templates[e],...t})}setTemplate(e,t,n){this.templates[e]||(this.templates[e]={}),this.templates[e][t]=n}renderDocument(e,t={}){const{skipEmpty:n=!0,wrapInContainer:o=!1}=t;if(!e||!Array.isArray(e.blocks))return console.warn("无效的EditorJS数据"),"";const i=e.blocks.map((e=>this.parseBlock(e))).filter((e=>!n||e.trim())).join("\n");return o?`<div class="editorjs-content" style="max-width: 800px; margin: 0 auto; padding: 20px;">\n${i}\n</div>`:i}getAvailableTemplates(){return{...this.templates}}setTemplates(e){this.templates={...e}}}async function c(n,o={}){try{const{targetSelector:i=r.editorContent,append:a=!0,insertPosition:s="cursor",styleOptions:c={}}=o,d=(new l).parse({blocks:n});console.log("生成的HTML内容:",d);const p=await async function(n,o={}){const{targetSelector:i=r.editorContent,append:a=!0,insertPosition:s="cursor"}=o;try{const o=t(i);if(!o)return console.error("找不到目标编辑器:",i),!1;const r=e("div",{innerHTML:n});if(a)for(;r.firstChild;)o.appendChild(r.firstChild);else switch(s){case"start":for(;r.lastChild;)o.insertBefore(r.lastChild,o.firstChild);break;case"end":for(;r.firstChild;)o.appendChild(r.firstChild);break;default:o.innerHTML=n}return console.log("内容插入成功"),!0}catch(l){return console.error("插入内容失败:",l),!1}}(d,{targetSelector:i,append:a,insertPosition:s});return p}catch(i){return console.error("保存到原编辑器失败:",i),!1}}function d(){return!(!window.EditorJSBundle||!window.EditorJSBundle.EditorJS)}function p(e){if(!document.getElementById(e))throw new Error(`${e}元素不存在，请检查DOM结构`);try{const t={holder:e,tools:function(e){const t={};for(const[n,o]of Object.entries(e)){const{class:e,...i}=o;if(!window.EditorJSBundle||!window.EditorJSBundle[e]){console.warn(`工具类 ${e} 未找到或未加载，跳过工具 ${n}`);continue}const a=window.EditorJSBundle[e];a?t[n]={class:a,...i}:console.warn(`工具类 ${e} 未加载，跳过工具 ${n}`)}return t}(o.tools),data:{blocks:[]},placeholder:o.placeholder,autofocus:o.autofocus,hideToolbar:o.hideToolbar,minHeight:o.minHeight,logLevel:o.logLevel,onReady:()=>{new window.EditorJSBundle.DragDrop(n)}},n=new window.EditorJSBundle.EditorJS(t);return n}catch(t){throw console.error("编辑器初始化失败:",t),t}}async function m(e){if(!d())try{await new Promise(((e,t)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",(n=>{n&&"injected"===n.status?setTimeout((()=>{d()?e():t(new Error("编辑器脚本加载失败"))}),100):t(new Error("编辑器注入失败"))}))}))}catch(t){throw new Error("编辑器加载失败: "+t.message)}return p(e)}new l;let g=null,h=[],f=null;async function u(){if(g)return void console.warn("智能编辑器已经激活");const n=t(r.editorContent);if(n)try{h=function(e){const t=Array.isArray(e)?e:[e],n=[];return t.forEach((e=>{document.querySelectorAll(e).forEach((t=>{n.push({element:t,selector:e,originalDisplay:t.style.display||getComputedStyle(t).display}),t.style.display="none"}))})),n}(r.editorToHide),function(){const n=e("div",{id:"smart-editor-container",className:"flowedit-editor-container"}),o=t(r.editorWrapper);if(o)o.appendChild(n);else{const e=t(r.ueditor);if(!e)throw console.error("无法找到合适的容器来插入智能编辑器，请检查页面结构"),new Error("无法找到合适的容器来插入智能编辑器");e.appendChild(n),console.log("找不到目标容器，将editorContainer插入到#ueditor_0的子元素上")}const i=e("div",{id:"editor-holder",className:"flowedit-editor-holder"});n.appendChild(i),console.log("智能编辑器界面创建完成")}(),f=function(n={}){const{onSave:o,onCancel:i}=n,a=e("div",{className:"flowedit-editor-action-bar"}),s=e("button",{textContent:"💾 保存",className:"flowedit-editor-save-btn"}),l=e("button",{textContent:"↩️ 取消",className:"flowedit-editor-cancel-btn"});a.appendChild(s),a.appendChild(l);const c=t(r.buttonArea);return c?c.appendChild(a):(console.warn("找不到按钮区域，将控制栏添加到body"),document.body.appendChild(a)),o&&"function"==typeof o&&s.addEventListener("click",o),i&&"function"==typeof i&&l.addEventListener("click",i),console.log("智能编辑器控制栏创建完成"),a}({onSave:b,onCancel:x}),await new Promise((e=>setTimeout(e,50))),g=await m("editor-holder"),console.log("智能编辑器激活成功")}catch(o){console.error("智能插入功能启动失败:",o),alert("智能插入功能启动失败"),x()}else alert("找不到编辑器容器")}function x(){var e;h.length>0&&(h.forEach((({element:e,originalDisplay:t})=>{e&&e.parentNode&&(e.style.display="none"===t?"":t)})),h=[]),function(){const e=document.getElementById("smart-editor-container");e&&(e.remove(),console.log("智能编辑器界面已移除"))}(),f&&((e=f)&&(e.remove(),console.log("智能编辑器控制栏已移除")),f=null),g&&(!function(e){if(e)try{e.destroy()}catch(t){console.warn("编辑器销毁错误:",t)}}(g),g=null),console.log("智能编辑器已停用")}async function b(e={}){if(g)try{const t=await g.save();console.log("保存的数据:",t);await c(t.blocks,{...e})?console.log("内容已成功保存到原编辑器"):console.error("保存到原编辑器失败")}catch(t){console.error("保存失败:",t)}finally{x()}else console.error("编辑器未初始化")}async function y(){try{await u()}catch(e){console.error("智能插入按钮点击处理失败:",e)}}function w(e){const t=document.querySelector(r.sidebar);if(t){const n="none"===t.style.display;t.style.display=n?"":"none";const o=e.currentTarget;n?o.classList.add("on"):o.classList.remove("on")}}function k(e,t,n){const{insertMethod:o,targetElement:i}=n;if("insertBefore"===o&&i){const n=e[i];n?e.insertBefore(t,n):e.appendChild(t)}else e.appendChild(t)}function v(){const n=t(r.toolbar);if(!n)return console.debug("找不到工具栏区域，可能页面未登录"),!1;{const t=function(){const t=e("button",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});return t.addEventListener("click",w),t}();t?(k(n,t,i),console.log("侧边栏切换按钮初始化成功")):console.warn("侧边栏切换按钮创建失败")}{const t=function(){const t=e("button",{className:"flowedit-btn flowedit-smart-btn",textContent:"智能插入"});return t.addEventListener("click",y),t}();t?(k(n,t,a),console.log("智能插入按钮初始化成功")):console.warn("智能插入按钮创建失败")}return!0}const F=new class{constructor(){this.config={},this.initialized=!1}async initialize(){try{console.log("初始化用户配置管理器..."),this.initialized=!0,console.log("用户配置管理器初始化完成")}catch(e){throw console.error("用户配置管理器初始化失败:",e),e}}getUserConfig(e){return this.initialized?e?this.config[e]:this.config:(console.warn("用户配置管理器未初始化"),null)}async setUserConfig(e,t){try{return this.initialized?("object"==typeof e?this.config={...this.config,...e}:this.config[e]=t,console.log("用户配置已更新:",e),!0):(console.warn("用户配置管理器未初始化"),!1)}catch(n){return console.error("设置用户配置失败:",n),!1}}},E=new class{constructor(){this.initialized=!1,this.styleCache={},this.syncInterval=null}async initialize(){try{console.log("初始化远程样式同步服务..."),this.initialized=!0,console.log("远程样式同步服务初始化完成")}catch(e){throw console.error("远程样式同步服务初始化失败:",e),e}}async manualSync(){try{return this.initialized?(console.log("开始手动同步远程样式..."),console.log("远程样式同步完成"),!0):(console.warn("远程样式同步服务未初始化"),!1)}catch(e){return console.error("远程样式同步失败:",e),!1}}startAutoSync(e=3e4){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval((async()=>{await this.manualSync()}),e),console.log(`远程样式自动同步已启动，间隔: ${e}ms`)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("远程样式自动同步已停止"))}};async function z(e={}){try{return console.log("开始初始化FlowEdit应用服务..."),await F.initialize(),await async function(e={}){try{if(await E.initialize(),!1!==e.enableAutoSync){const t=e.syncInterval||3e4;E.startAutoSync(t)}!1!==e.initialSync&&await E.manualSync(),console.log("远程样式系统初始化完成")}catch(t){console.error("远程样式系统初始化失败:",t)}}(e),console.log("FlowEdit应用服务初始化完成"),!0}catch(t){return console.error("FlowEdit应用服务初始化失败:",t),!1}}async function C(){v()?(!function(){const e="flow-editor-plugin-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.setAttribute("data-flowedit-plugin-ui","true"),t.textContent="\n      /* FlowEdit 插件UI样式 */\n      \n  /* 扩展按钮基础样式 */\n  .flowedit-btn {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  /* 智能插入按钮样式 */\n  .flowedit-smart-btn {\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n    transition: all 0.3s ease;\n  }\n  \n  /* 智能插入按钮悬浮效果 */\n  .flowedit-smart-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n      \n  /* Switch开关样式 */\n  .flowedit-switch {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    position: relative;\n    width: 40px;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: all 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* 智能插入编辑器容器样式 */\n  .flowedit-editor-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;\n    margin-left: -95px;\n    padding: 0 91px;\n    background: #fff;\n  }\n  \n  /* 智能插入编辑器占位元素样式 */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0 91px;\n  }\n  \n  /* 智能插入控制栏样式 */\n  .flowedit-editor-action-bar {\n    position: relative  \n    padding: 20px 20px 15px 20px;\n    margin: 0;\n    width: 768px;\n    margin-left: auto;\n    margin-right: auto;\n    background-color: #ffffff;\n    color: rgb(53, 53, 53);\n    font-family: mp-quote, 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;\n    font-size: 14px;\n    line-height: 22.4px;\n    word-break: break-all;\n    box-sizing: content-box;\n    display: flex;\n    justify-content: flex-end;\n    gap: 15px;\n  }\n  \n  /* 智能插入保存按钮样式 */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n    position: relative\n  }\n  \n  /* 智能插入保存按钮悬浮效果 */\n  .flowedit-editor-save-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n  \n  /* 智能插入取消按钮样式 */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n  \n  /* 智能插入取消按钮悬浮效果 */\n  .flowedit-editor-cancel-btn:hover {\n    background-color: #e7e7eb;\n    background-image: linear-gradient(to bottom, #E7E7EB 0, #E7E7EB 100%);\n    border-color: #DADBE0;\n    box-shadow: none;\n    -moz-box-shadow: none;\n    -webkit-box-shadow: none;\n    color: #353535;\n    transform: translateY(-1px);\n  }\n\n    ",document.head.appendChild(t),console.log("FlowEdit 插件UI样式已注入")}}(),console.log("FlowEdit 插件功能模块初始化完成")):console.log("FlowEdit 插件功能模块初始化失败：页面可能未登录")}(async function(){console.log("FlowEdit 内容脚本启动"),"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e)}));try{await z(),console.log("FlowEdit 应用服务初始化成功")}catch(e){console.error("FlowEdit 应用服务初始化失败:",e)}await C()})().catch((e=>{console.error("FlowEdit 启动失败:",e)}))}();

!function(){"use strict";const n={editor:{placeholder:"在此输入内容...",tools:{header:{levels:[2,3,4],defaultLevel:2,placeholder:"请输入标题"}}}},e={toolbar:"#js_toolbar_0",editor:"#ueditor_0",proseMirror:"#ueditor_0 .ProseMirror",buttonArea:"#js_button_area",sidebar:"#js_side_article_list"};function t(){const n=document.querySelector(e.proseMirror);if(!n)return{blocks:[]};const t=n.textContent.trim();return t?{blocks:[{type:"paragraph",data:{text:t}}]}:{blocks:[]}}function o(){return!!(window.EditorJS&&window.Paragraph&&window.Header)}function r(n,e={}){const t=document.createElement(n);return e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.innerHTML&&(t.innerHTML=e.innerHTML),e.textContent&&(t.textContent=e.textContent),e.cssText&&(t.style.cssText=e.cssText),t}function i(n,e=document){try{return e.querySelector(n)}catch(t){return console.error(`查询选择器失败: ${n}`,t),null}}let l=null,a={},d=[],s=null;async function c(){if(l)return;const c=document.querySelector(e.editor);if(c)try{a=function(n){const e={};return n.forEach((n=>{const t=document.getElementById(n);t&&(e[n]=t.style.display,t.style.display="none")})),e}(["ueditor_0","article_setting_area"]),d=function(){const n=document.getElementById(e.buttonArea.replace("#",""));if(!n)return[];const t=Array.from(n.children),o=t.map((n=>({element:n,display:n.style.display})));return t.forEach((n=>{n.style.display="none"})),o}(),function(n){const t=r("div",{id:"smart-editor-container",className:"flowedit-editor-container"}),o=i("#edui1_iframeholder");o?o.appendChild(t):n.parentNode.insertBefore(t,n.nextSibling);const l=r("div",{id:"editor-holder",className:"flowedit-editor-holder"});t.appendChild(l),function(){s=r("div",{className:"flowedit-editor-action-bar"});const n=r("button",{textContent:"💾 保存",className:"flowedit-editor-save-btn"}),t=r("button",{textContent:"↩️ 取消",className:"flowedit-editor-cancel-btn"});s.appendChild(n),s.appendChild(t);const o=i(e.buttonArea);o?o.appendChild(s):(console.warn("找不到按钮区域，将控制栏添加到body"),document.body.appendChild(s));n.addEventListener("click",p),t.addEventListener("click",u)}()}(c),await new Promise((n=>setTimeout(n,50))),await async function(){if(!o())try{await new Promise(((n,e)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",(t=>{t&&"injected"===t.status?setTimeout((()=>{o()?n():e(new Error("编辑器脚本加载失败"))}),100):e(new Error("编辑器注入失败"))}))}))}catch(e){throw new Error("编辑器加载失败: "+e.message)}!function(){const o=n.editor;if(!document.getElementById("editor-holder"))throw new Error("editor-holder元素不存在，请检查DOM结构");try{l=new EditorJS({holder:"editor-holder",tools:{paragraph:{class:Paragraph,inlineToolbar:!0},header:{class:Header,inlineToolbar:!0,config:{placeholder:o.tools.header.placeholder,levels:o.tools.header.levels,defaultLevel:o.tools.header.defaultLevel}}},data:t(),placeholder:o.placeholder})}catch(e){throw console.error("编辑器初始化失败:",e),e}}()}()}catch(f){console.error("智能插入功能启动失败:",f),alert("智能插入功能启动失败"),u()}else alert("找不到编辑器容器")}async function p(){if(l)try{const{blocks:n}=await l.save(),t=function(n){const t=document.querySelector(e.proseMirror);if(!t)return console.error("找不到目标编辑器"),!1;try{return t.innerHTML=n.map((n=>`<p>${n.data.text.replace(/\n/g,"<br>")}</p>`)).join(""),!0}catch(o){return console.error("保存内容失败:",o),!1}}(n);t?alert("内容已保存！"):alert("警告：保存失败，已恢复原状")}catch(n){console.error("保存失败:",n),alert("保存失败，请查看控制台")}finally{u()}}function u(){var n;d.length>0&&(d.forEach((({element:n,display:e})=>{n.style.display=e})),d=[]),Object.keys(a).length>0&&(n=a,Object.entries(n).forEach((([n,e])=>{const t=document.getElementById(n);t&&(t.style.display=e)})),a={});const e=document.getElementById("smart-editor-container");if(e&&e.remove(),s&&(s.remove(),s=null),l){try{l.destroy()}catch(t){console.warn("编辑器销毁错误:",t)}l=null}}function f(n){const t=document.querySelector(e.sidebar);if(t){const e="none"===t.style.display;t.style.display=e?"":"none";const o=n.currentTarget;e?o.classList.add("on"):o.classList.remove("on")}}!function(){const n="flowedit-styles";if(!document.getElementById(n)){const e=document.createElement("style");e.id=n,e.textContent="\n      \n  /* 扩展按钮基础样式 */\n  .flowedit-btn {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  /* 智能插入按钮样式 */\n  .flowedit-smart-btn {\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n  }\n\n      \n  /* Switch开关样式 */\n  .flowedit-switch {\n    display: inline-block;\n    height: 22px;\n    margin: 1px 4px;\n    vertical-align: middle;\n    cursor: pointer;\n    position: relative;\n    width: 40px;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: background-color 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* 智能插入编辑器容器样式 */\n  .flowedit-editor-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;\n    margin-left: -95px;\n    padding: 0 91px;\n    background: #fff;\n  }\n  \n  /* 智能插入编辑器占位元素样式 */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0 91px;\n  }\n  \n  /* 智能插入控制栏样式 */\n  .flowedit-editor-action-bar {\n    padding: 20px 20px 15px 20px;\n    margin: 0;\n    background-color: #ffffff;\n    color: rgb(53, 53, 53);\n    font-family: mp-quote, 'PingFang SC', system-ui, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;\n    font-size: 14px;\n    line-height: 22.4px;\n    word-break: break-all;\n    box-sizing: content-box;\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    z-index: 1000;\n  }\n  \n  /* 智能插入保存按钮样式 */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n  }\n  \n  /* 智能插入取消按钮样式 */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    width: 98px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n  }\n\n    ",document.head.appendChild(e)}}(),function(){const n=i(e.toolbar);if(!n)return void console.warn("找不到工具栏区域");const t=function(){const n=r("button",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});return n.addEventListener("click",f),n}(),o=i(e.sidebar);t&&o?n.firstElementChild?n.insertBefore(t,n.firstElementChild):n.appendChild(t):console.warn("侧边栏切换按钮初始化失败：缺少必要的DOM元素");const l=function(){const n=r("button",{className:"flowedit-btn flowedit-smart-btn",textContent:"智能插入"});return n.addEventListener("click",c),n}(),a=i(e.editor);l&&a?n.appendChild(l):console.warn("智能插入按钮初始化失败：缺少必要的DOM元素")}()}();

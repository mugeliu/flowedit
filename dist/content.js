!function(){"use strict";const e=new class{constructor(){this.plugins=new Map,this.initialized=new Set}register(e,t){if(!t.initialize||"function"!=typeof t.initialize)throw new Error(`æ’ä»¶ ${e} å¿…é¡»æä¾› initialize æ–¹æ³•`);if(!t.cleanup||"function"!=typeof t.cleanup)throw new Error(`æ’ä»¶ ${e} å¿…é¡»æä¾› cleanup æ–¹æ³•`);this.plugins.set(e,t)}async initializePlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`æ’ä»¶ ${e} æœªæ³¨å†Œ`),!1;if(this.initialized.has(e))return!0;try{return!(t.isEnabled&&!t.isEnabled())&&(await t.initialize(),this.initialized.add(e),!0)}catch(n){return console.error(`æ’ä»¶ ${e} åˆå§‹åŒ–å¤±è´¥:`,n),!1}}async initializeAll(){const e={success:[],failed:[],skipped:[]};for(const[t]of this.plugins){await this.initializePlugin(t)?e.success.push(t):e.failed.push(t)}return e}cleanupPlugin(e){const t=this.plugins.get(e);if(!t)return console.warn(`æ’ä»¶ ${e} æœªæ³¨å†Œ`),!1;if(!this.initialized.has(e))return!0;try{return t.cleanup(),this.initialized.delete(e),!0}catch(n){return console.error(`æ’ä»¶ ${e} æ¸…ç†å¤±è´¥:`,n),!1}}async cleanupAll(){const e={success:[],failed:[]},t=Array.from(this.initialized);for(const n of t){this.cleanupPlugin(n)?e.success.push(n):e.failed.push(n)}return await new Promise(e=>setTimeout(e,0)),e}getRegisteredPlugins(){return Array.from(this.plugins.keys())}getInitializedPlugins(){return Array.from(this.initialized)}isRegistered(e){return this.plugins.has(e)}isInitialized(e){return this.initialized.has(e)}};function t(){setTimeout(()=>{document.querySelectorAll(".image-tool__image-preloader").forEach(e=>{e.style.backgroundImage="",e.style.display="none"});document.querySelectorAll(".image-tool").forEach(e=>{e.classList.remove("image-tool--uploading","image-tool--filled"),e.classList.add("image-tool--empty")})},50)}function n(e){return new Promise((t,n)=>{if(e.size>10485760)return void n(new Error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB"));["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)?t():n(new Error("ä»…æ”¯æŒ JPEGã€PNGã€GIFã€WebP æ ¼å¼çš„å›¾ç‰‡"))})}async function i(e){var t,n;let i;console.log("å¼€å§‹æ‰§è¡Œå¾®ä¿¡å›¾ç‰‡ä¸Šä¼ ");try{i=await async function(){return new Promise((e,t)=>{chrome.runtime.sendMessage({type:"get_wechat_data"},n=>{n&&n.success?e(n.data):t(new Error((null==n?void 0:n.error)||"background script åŠ è½½å¤±è´¥"))})})}()}catch(c){throw new Error("æ— æ³•è·å–wxæ•°æ®ï¼Œè¯·ç¡®ä¿åœ¨å¾®ä¿¡å…¬ä¼—å·åå°ä¸­ä½¿ç”¨")}if(!i.token)throw new Error("wxæ•°æ®ä¸­æœªæ‰¾åˆ°å¾®ä¿¡tokenï¼Œè¯·ç¡®ä¿åœ¨å¾®ä¿¡å…¬ä¼—å·åå°ä¸­ä½¿ç”¨");const r=new FormData,o="p"+Date.now();r.append("id",o),r.append("name",e.name),r.append("type",e.type),r.append("lastModifiedDate",(new Date).toString()),r.append("size",e.size.toString()),r.append("file",e,e.name);const s={action:"upload_material",f:"json",scene:"8",writetype:"doublewrite",groupid:"1",ticket_id:i.userName,ticket:i.ticket,svr_time:i.time,token:i.token,lang:"zh_CN",seq:Date.now().toString(),t:Math.random().toString()},a=`https://mp.weixin.qq.com/cgi-bin/filetransfer?${new URLSearchParams(s).toString()}`,l={accept:"*/*","accept-language":"zh-CN,zh;q=0.9,en;q=0.8",dnt:"1",origin:"https://mp.weixin.qq.com",priority:"u=1, i",referer:window.location.href,"sec-ch-ua":'"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","user-agent":navigator.userAgent};try{const e=await fetch(a,{method:"POST",body:r,headers:l,credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const i=await e.json();if(i.base_resp&&0===i.base_resp.ret)return{url:i.cdn_url};{const e=(null==(t=i.base_resp)?void 0:t.err_msg)||"ä¸Šä¼ å¤±è´¥",r=(null==(n=i.base_resp)?void 0:n.ret)||"æœªçŸ¥é”™è¯¯";throw new Error(`${e} (é”™è¯¯ç : ${r})`)}}catch(c){const e=c.message||"ä¸Šä¼ å¤±è´¥";throw new Error(`å›¾ç‰‡ä¸Šä¼ å›¾åº“å¤±è´¥: ${e}`)}}const r={placeholder:"å¼€å§‹è¾“å…¥å†…å®¹...",autofocus:!0,tools:{paragraph:{class:"Paragraph",inlineToolbar:!0},header:{class:"Header",config:{levels:[1,2,3],defaultLevel:1,placeholder:"è¯·è¾“å…¥æ ‡é¢˜"},toolbox:[{title:"Heading 1",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M19 17V10.2135C19 10.1287 18.9011 10.0824 18.836 10.1367L16 12.5"/></svg>',data:{level:1}},{title:"Heading 2",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10 19 9.5 19 12C19 13.9771 16.0684 13.9997 16.0012 16.8981C15.9999 16.9533 16.0448 17 16.1 17L19.3 17"/></svg>',data:{level:2}},{title:"Heading 3",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6 7L6 12M6 17L6 12M6 12L12 12M12 7V12M12 17L12 12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 11C16 10.5 16.8323 10 17.6 10C18.3677 10 19.5 10.311 19.5 11.5C19.5 12.5315 18.7474 12.9022 18.548 12.9823C18.5378 12.9864 18.5395 13.0047 18.5503 13.0063C18.8115 13.0456 20 13.3065 20 14.8C20 16 19.5 17 17.8 17C17.8 17 16 17 16 16.3"/></svg>',data:{level:3}}]},quote:{class:"Quote",inlineToolbar:!0,config:{quotePlaceholder:"è¾“å…¥å¼•ç”¨å†…å®¹",captionPlaceholder:"å¼•ç”¨æ¥æº"}},image:{class:"ImageTool",config:{types:"image/*",captionPlaceholder:"å›¾ç‰‡æè¿°",buttonContent:"é€‰æ‹©å›¾ç‰‡",features:{caption:!0,withBorder:!0,withBackground:!0,stretched:!0},uploader:{async uploadByFile(e){try{return await n(e),{success:1,file:{url:(await i(e)).url,fileName:e.name?e.name.replace(/\.[^/.]+$/,""):""}}}catch(r){return t(),{success:0,file:{error:r.message}}}},async uploadByUrl(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const r=await t.blob(),o=e.split("/"),s=o[o.length-1]||"image.jpg",a=new File([r],s,{type:r.type||"image/jpeg"});return await n(a),{success:1,file:{url:(await i(a)).url,fileName:a.name?a.name.replace(/\.[^/.]+$/,""):""}}}catch(r){return t(),{success:0,file:{error:r.message}}}}}}},delimiter:{class:"Delimiter"},raw:{class:"RawTool"},List:{class:"EditorjsList",inlineToolbar:!0,config:{defaultStyle:"unordered",maxLevel:5}},code:{class:"Code"},marker:{class:"Marker"},inlineCode:{class:"InlineCode"},underline:{class:"Underline"}},minHeight:400,logLevel:"WARN"},o={toolbar:"js_toolbar_0",editorContent:'div[contenteditable="true"].ProseMirror',editorWrapper:"edui1_iframeholder",sidebar:"js_side_article_list",authorArea:"js_author_area",footerToolbar:"js_button_area"},s={head:"",ending:"",inlineStyles:{a:'<span textstyle style="color: rgb(16, 185, 129); text-decoration: underline; text-decoration-color: rgba(16, 185, 129, 0.5); text-underline-offset: 2px;">{{content}}</span>',b:'<span textstyle style="font-weight: 700; color: rgb(16, 185, 129);">{{content}}</span>',i:'<span textstyle style="font-style: italic; color: rgb(16, 185, 129); letter-spacing: 0.5px; font-weight: 500;">{{content}}</span>',u:'<span textstyle style="text-decoration: underline; text-decoration-color: rgb(16, 185, 129); text-underline-offset: 3px; text-decoration-thickness: 2px;">{{content}}</span>',mark:'<span textstyle style="background: rgba(16, 185, 129, 0.2); padding: 0.1em 0.4em; border-radius: 3px;">{{content}}</span>',code:"<span textstyle style=\"font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.85em; background: rgba(16, 185, 129, 0.1); color: rgb(6, 95, 70); padding: 0.25em 0.6em; border-radius: 5px; border: 1px solid rgba(16, 185, 129, 0.25); font-weight: 500; letter-spacing: 0.3px;\">{{content}}</span>",sup:'<sup textstyle style="color: rgba(16, 185, 129, 0.7); font-size: 0.7em; margin-left: 0.2em;">{{sup}}</sup>'},header:{h1:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.5px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 20px;font-weight: 600;margin: 1.8em 0px 1.2em;text-align: center;line-height: 1.4;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: flex;justify-content: center;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-block;padding: 1em 2.2em;color: rgb(255, 255, 255);background: linear-gradient(135deg, rgb(16, 185, 129) 0%, rgb(5, 150, 105) 100%);border-radius: 12px;box-shadow: rgba(16, 185, 129, 0.25) 0px 6px 20px -4px, rgba(0, 0, 0, 0.1) 0px 2px 8px -2px;"><span leaf="">{{content}}</span></section></section>',h2:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.3px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 18px;font-weight: 600;margin: 1.5em 0px 1em;text-align: left;line-height: 1.4;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-flex; align-items: center; padding: 0.8em 1.8em 0.8em 1.2em; background: rgba(16, 185, 129, 0.06); border-left: 4px solid rgb(16, 185, 129); border-radius: 0px 8px 8px 0px; min-width: fit-content;"><span style="display: inline-block; width: 8px; height: 8px; background: rgb(16, 185, 129); border-radius: 50%; margin-right: 0.8em; vertical-align: middle;"></span><span leaf="">{{content}}</span></section></section>',h3:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;letter-spacing: 0.2px;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;font-size: 17px;font-weight: 500;margin: 1.2em 0px 0.8em;text-align: left;line-height: 1.5;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;color: rgb(4, 120, 87);"><section style="display: inline-flex; align-items: center; padding: 0.6em 1.5em 0.6em 1em; background: linear-gradient(90deg, rgba(16, 185, 129, 0.04) 0%, rgba(16, 185, 129, 0.01) 80%, transparent 100%); border-left: 3px solid rgba(16, 185, 129, 0.6); border-radius: 0px 6px 6px 0px; min-width: fit-content;"><span style="display: inline-block; width: 6px; height: 6px; background: rgba(16, 185, 129, 0.8); border-radius: 50%; margin-right: 0.6em; vertical-align: middle;"></span><span leaf="">{{content}}</span></section></section>'},paragraph:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 0.8em 0px;text-align: left;line-height: 1.7;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;"><section style="font-size: 16px; color: rgb(55, 65, 81); letter-spacing: 0.3px; padding: 0.5em 0.5em;"><span leaf="">{{content}}</span></section></section>'},quote:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 1.5em 0px;text-align: left;line-height: 1.6;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: block;padding: 0px;"><section style="background: rgba(16, 185, 129, 0.06); border-left: 4px solid rgb(16, 185, 129); padding: 1.2em 1.8em; border-radius: 0px 8px 8px 0px; box-shadow: rgba(16, 185, 129, 0.1) 0px 2px 8px -2px;"><section style="font-size: 16px; color: rgb(55, 65, 81); font-style: italic; margin: 0px 0px 1em 0px; letter-spacing: 0.2px;"><span leaf="">{{content}}</span></section><section style="display: flex; justify-content: flex-end; color: rgba(16, 185, 129, 0.8); font-size: 14px; font-weight: 500; font-style: normal;"><span leaf="">{{caption}}</span></section></section></section>'},delimiter:{default:'<section style="font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;box-sizing: border-box;border-width: 0px;border-style: solid;margin: 2em 0px;text-align: center;line-height: 1;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;display: flex;justify-content: center;padding: 0px;"><section style="width: 80%; height: 2px; background: linear-gradient(90deg, transparent 0%, rgba(16, 185, 129, 0.2) 20%, rgba(16, 185, 129, 0.6) 50%, rgba(16, 185, 129, 0.2) 80%, transparent 100%); border-radius: 1px;"></section></section>'},raw:{default:""},image:{default:'<section><figure style="margin: 10px 0px; padding: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center; visibility: visible;"><span leaf="" style="visibility: visible;"><img src="{{url}}" style="display: block; margin: 0px auto; max-width: 100%; border-style: none; border-radius: 4px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px; height: auto !important; visibility: visible !important; width: 677px !important;" /></span><figcaption style="color: #888; font-size: 12px; line-height: 1.5em; letter-spacing: 0em; text-align: center; font-weight: normal; margin: 5px 0px 0px 0px; padding: 0px;"><span leaf="">{{caption}}</span></figcaption></figure></section>'},List:{ordered:'<section data-block="list" data-style="ordered" style="text-indent:0px;margin:1.2em 0;"><ol style="list-style-type:{{listStyle}};padding-left:2em;">{{items}}</ol></section>',unordered:'<section data-block="list" data-style="unordered" style="text-indent:0px;margin:1.2em 0;"><ul style="list-style-type:disc;padding-left:2em;">{{items}}</ul></section>',checklist:'<section data-block="list" data-style="checklist" style="text-indent:0px;margin:1.2em 0;"><ul style="list-style:none;padding-left:1em;">{{items}}</ul></section>',nestedOrdered:'<ol style="list-style-type:{{listStyle}};padding-left:{{paddingLeft}}em;margin:0.5em 0;">{{items}}</ol>',nestedUnordered:'<ul style="list-style-type:disc;padding-left:{{paddingLeft}}em;margin:0.5em 0;">{{items}}</ul>',nestedChecklist:'<ul style="list-style:none;padding-left:{{paddingLeft}}em;margin:0.5em 0;">{{items}}</ul>'},listItem:{default:'<li style="margin:0.3em 0;line-height:1.6;"><section><span leaf="">{{content}}</span></section></li>',checklist:'<li style="margin:0.3em 0;line-height:1.6;"><section><span style="margin-right:0.5em;font-family:monospace;font-size:1.1em;color:rgb(16, 185, 129);">{{checkbox}}</span><span leaf="">{{content}}</span></section></li>'},code:{default:'<section><pre style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.5;font-family:Menlo,Monaco,\'Courier New\',monospace;font-size:90%;overflow-x:auto;border-radius:8px;padding:1em;margin:10px 8px;background-color:#2d2d2d;border:1px solid #1a6840;" class="hljs code__pre"><span style="display:block;padding-bottom:10px;" class="mac-sign"><svg viewBox="0 0 450 130" height="13px" width="45px" y="0px" x="0px" version="1.1" xmlns="http://www.w3.org/2000/svg"><ellipse fill="rgb(237,108,96)" stroke-width="2" stroke="rgb(220,60,54)" ry="52" rx="50" cy="65" cx="50"></ellipse><ellipse fill="rgb(247,193,81)" stroke-width="2" stroke="rgb(218,151,33)" ry="52" rx="50" cy="65" cx="225"></ellipse><ellipse fill="rgb(100,200,86)" stroke-width="2" stroke="rgb(27,161,37)" ry="52" rx="50" cy="65" cx="400"></ellipse></svg></span><code style="--md-primary-color:rgba(26,104,64,1);text-align:left;line-height:1.75;font-family:\'Fira Code\',Menlo,Operator Mono,Consolas,Monaco,monospace;font-size:90%;margin:0;white-space:pre;word-wrap:break-word;overflow-wrap:break-word;color:#e0e0e0;" class="language-python">{{content}}</code></pre></section>'},fallback:{container:"margin:1.5em 8px;padding:0.5em;border:1px dashed rgba(26,104,64,0.3);background-color:rgba(26,104,64,0.05);",warning:"color:rgba(26,104,64,0.7);font-size:0.8em;",content:"margin-top:0.5em;"}};class a{constructor(e){this.templates=e}process(e,t){const n=this.preprocessData(e,t),i=this.getTemplate(n,t),r=this.renderContent(n,t);return this.postprocess(i,r,n,t)}preprocessData(e,t){return e}getTemplate(e,t){const n=t.type,i=this.templates[n];if(!i)return null;switch(n){case"header":return i[`h${Math.min(Math.max(e.level||1,1),6)}`]||i.default;case"list":case"List":return i["ordered"===e.style?"ordered":"checklist"===e.style?"checklist":"unordered"]||i.default;default:return i.default||Object.values(i)[0]}}renderContent(e,t){return this.sanitizeHtml(this.processInlineStyles(e.text||e.content||""))}postprocess(e,t,n,i){return e?e.replace(/{{content}}/g,t):(console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i))}processInlineStyles(e){if(!e)return"";const t=`<div>${e}</div>`,n=(new DOMParser).parseFromString(t,"text/html"),i=this.templates.inlineStyles;return n.querySelectorAll("a").forEach(e=>{const t=e.innerHTML,n=i.a.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("b, strong").forEach(e=>{const t=e.innerHTML,n=i.b.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("i, em").forEach(e=>{const t=e.innerHTML,n=i.i.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("u").forEach(e=>{const t=e.innerHTML,n=i.u.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("mark").forEach(e=>{const t=e.innerHTML,n=i.mark.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("code").forEach(e=>{const t=e.innerHTML,n=i.code.replace(/{{content}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.querySelectorAll("sup").forEach(e=>{const t=e.innerHTML,n=i.sup.replace(/{{sup}}/g,t),r=document.createElement("div");r.innerHTML=n,e.replaceWith(...r.childNodes)}),n.body.querySelector("div").innerHTML}sanitizeHtml(e){let t=e;return["script","iframe","object","embed","form"].forEach(e=>{const n=new RegExp(`<${e}[^>]*>.*?</${e}>`,"gi");t=t.replace(n,"")}),t}escapeHtml(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}createFallbackHtml(e){var t,n,i;const r=(null==(t=e.data)?void 0:t.text)||(null==(n=e.data)?void 0:n.content)||(null==(i=e.data)?void 0:i.code)||"",o="code"===e.type?this.escapeHtml(r):this.sanitizeHtml(this.processInlineStyles(r)),s=this.templates.fallback;return`<section data-block="${e.type}" style="text-indent: 0px; margin-bottom: 8px;">\n      <div style="${s.container}">\n        <small style="${s.warning}">æœªçŸ¥å—ç±»å‹: ${e.type}</small>\n        <div style="${s.content}">${o}</div>\n      </div>\n    </section>`}}class l extends a{renderContent(e,t){return this.escapeHtml(e.text||"")}}class c extends a{renderContent(e,t){const n=e.code||"";return this.escapeHtml(n)}validateCodeSyntax(e,t){}}class d extends a{process(e,t){const n=e.html||"";return this.isValidHtml(n)||console.warn("Invalid HTML detected in raw block"),this.sanitizeHtml(n)}isValidHtml(e){try{const t=new DOMParser;return!t.parseFromString(e,"text/html").querySelector("parsererror")}catch(t){return!1}}}class p extends a{constructor(e,t={}){super(e),this.processCaptions=!1!==t.processCaptions}renderContent(e,t){return this.sanitizeHtml(this.processInlineStyles(e.text||e.content||""))}postprocess(e,t,n,i){if(!e)return console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i);let r=e.replace(/{{content}}/g,t);if(e.includes("{{caption}}"))if(this.processCaptions&&n.caption){const e=this.sanitizeHtml(this.processInlineStyles(n.caption));r=r.replace(/{{caption}}/g,e)}else r=r.replace(/{{caption}}/g,"");return r}}class u extends a{preprocessData(e,t){return{style:e.style||"unordered",items:Array.isArray(e.items)?e.items:[],meta:e.meta||{}}}getTemplate(e,t){const n=this.templates.List||this.templates[t.type];if(!n)return null;switch(e.style){case"ordered":return n.ordered;case"unordered":default:return n.unordered;case"checklist":return n.checklist||n.unordered}}renderContent(e,t){return""}postprocess(e,t,n,i){if(!e)return console.warn(`æœªæ‰¾åˆ°å—ç±»å‹ ${i.type} çš„æ¨¡æ¿`),this.createFallbackHtml(i);const r=this.renderListItems(n.items,n.style,1,n.meta);let o=e.replace(/{{items}}/g,r);if("ordered"===n.style){const e=this.getListStyleType(n.meta.counterType,1);o=o.replace(/{{listStyle}}/g,e)}else o=o.replace(/{{listStyle}}/g,"");return o}renderListItems(e,t,n=1,i={}){return Array.isArray(e)&&0!==e.length?e.map(e=>{if(!e||"object"!=typeof e)return"";const r=e.content||"",o=this.sanitizeHtml(r),s=e.meta||{};let a=!1;"checklist"===t&&"boolean"==typeof s.checked&&(a=s.checked);let l=this.renderSingleListItem(o,t,a);if(e.items&&Array.isArray(e.items)&&e.items.length>0){const r=t,o=n+1,s=this.getNestedTemplate(r);if(s){let t=s;if("ordered"===r){const e=this.getListStyleType(i.counterType||null,o);t=t.replace(/{{listStyle}}/g,e)}else t=t.replace(/{{listStyle}}/g,"");const n=1.5*o;t=t.replace(/{{paddingLeft}}/g,n);const a=this.renderListItems(e.items,r,o,i||{});a&&(l+=t.replace(/{{items}}/g,a))}}return l}).filter(e=>e).join(""):""}renderSingleListItem(e,t,n=!1){const i=this.templates.listItem;if(!i)return`<li>${e||""}</li>`;if("checklist"===t){const t=n?"â˜‘":"â˜";return(i.checklist||i.default).replace(/{{checkbox}}/g,t).replace(/{{content}}/g,e||"")}return i.default.replace(/{{content}}/g,e||"")}getNestedTemplate(e){const t=this.templates.List||this.templates.list;if(!t)return null;switch(e){case"ordered":return t.nestedOrdered;case"unordered":default:return t.nestedUnordered;case"checklist":return t.nestedChecklist}}getListStyleType(e,t){if(e)switch(e){case"numeric":case"decimal":default:return"decimal";case"alpha":case"lower-alpha":return"lower-alpha";case"upper-alpha":return"upper-alpha";case"roman":case"lower-roman":return"lower-roman";case"upper-roman":return"upper-roman"}switch(t){case 1:case 4:default:return"decimal";case 2:case 5:return"lower-alpha";case 3:return"lower-roman"}}}class h extends a{preprocessData(e,t){return{}}renderContent(e,t){return""}}class m extends a{preprocessData(e,t){const n={...e};return n.file||(n.file={}),n}renderContent(e,t){var n,i;const r=(null==(n=e.file)?void 0:n.url)||"";if(!r)return console.warn("Image block missing URL:",e),'<section style="color: #999; font-style: italic;">å›¾ç‰‡åŠ è½½å¤±è´¥</section>';let o=`<img src="${this.escapeHtml(r)}"`;const s=(null==(i=e.file)?void 0:i.filename)||"";s&&(o+=` alt="${this.escapeHtml(s)}"`);const a=[];return e.stretched&&a.push("width: 100%"),e.withBorder&&a.push("border: 1px solid #e1e8ed"),e.withBackground&&a.push("background: #f8f9fa","padding: 15px"),a.push("max-width: 100%","height: auto","display: block"),a.length>0&&(o+=` style="${a.join("; ")}"`),o+=" />",o}postprocess(e,t,n,i){var r;if(!e){let e=`<section><figure style="margin: 16px 0; text-align: center;">${t}`;if(n.caption){e+=`<figcaption style="margin-top: 8px; font-size: 14px; color: #666; font-style: italic;">${this.sanitizeHtml(n.caption)}</figcaption>`}return e+="</figure></section>",e}let o=e.replace(/{{content}}/g,t);if(e.includes("{{caption}}"))if(n.caption){const e=this.sanitizeHtml(n.caption);o=o.replace(/{{caption}}/g,e)}else o=o.replace(/{{caption}}/g,"");if(e.includes("{{url}}")){const e=(null==(r=n.file)?void 0:r.url)||"";o=o.replace(/{{url}}/g,this.escapeHtml(e))}return o}}class g{constructor(e){this.templates=e,this.processors=new Map,this.initializeDefaultProcessors()}initializeDefaultProcessors(){this.registerProcessor("header",new l(this.templates)),this.registerProcessor("code",new c(this.templates)),this.registerProcessor("raw",new d(this.templates)),this.registerProcessor("quote",new p(this.templates)),this.registerProcessor("List",new u(this.templates)),this.registerProcessor("delimiter",new h(this.templates)),this.registerProcessor("image",new m(this.templates)),this.registerProcessor("paragraph",new a(this.templates))}registerProcessor(e,t){this.processors.set(e,t)}getProcessor(e){return this.processors.get(e)||this.getDefaultProcessor()}getDefaultProcessor(){return new a(this.templates)}}class f{constructor(e={}){this.templates=Object.keys(e).length>0?e:s,this.processorFactory=new g(this.templates)}setTemplates(e){this.templates=e,this.processorFactory=new g(this.templates)}getTemplates(){return this.templates}registerCustomProcessor(e,t){this.processorFactory.registerProcessor(e,t)}parseBlock(e){if(!e||!e.type)return console.warn("æ— æ•ˆçš„å—æ•°æ®:",e),"";return this.processorFactory.getProcessor(e.type).process(e.data||{},e)}parse(e,t={}){const{skipEmpty:n=!0}=t;if(!e||!Array.isArray(e.blocks))return console.warn("æ— æ•ˆçš„EditorJSæ•°æ®"),"";const i=e.blocks.map(e=>this.parseBlock(e)).filter(e=>!n||e.trim()).join("\n");return[this.templates.head||"",i,this.templates.ending||"",'<section><span leaf=""><br class="ProseMirror-trailingBreak"></span></section>'].filter(e=>e.trim()).join("\n")}registerTemplate(e,t,n="default"){this.templates[e]||(this.templates[e]={}),"string"==typeof t?this.templates[e][n]=t:"object"==typeof t&&(this.templates[e]={...this.templates[e],...t})}setTemplate(e,t,n){this.templates[e]||(this.templates[e]={}),this.templates[e][t]=n}renderDocument(e,t={}){const{skipEmpty:n=!0,wrapInContainer:i=!1}=t;if(!e||!Array.isArray(e.blocks))return console.warn("æ— æ•ˆçš„EditorJSæ•°æ®"),"";const r=e.blocks.map(e=>this.parseBlock(e)).filter(e=>!n||e.trim()).join("\n");return i?`<div class="editorjs-content" style="max-width: 800px; margin: 0 auto; padding: 20px;">\n              ${r}</div>`:r}getAvailableTemplates(){return{...this.templates}}setTemplates(e){this.templates={...e}}}function y(e,t={}){const n=document.createElement(e);return t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.cssText&&(n.style.cssText=t.cssText),n}function w(e,t){let n;return"string"==typeof e?n=document.getElementById(e):e&&e.nodeType===Node.ELEMENT_NODE&&(n=e),!!n&&(n.style.display=t,!0)}function x(e){return w(e,"none")}function b(e){return w(e,"")}function k(e,t=document){try{return t.querySelector(e)}catch(n){return console.error(`æŸ¥è¯¢é€‰æ‹©å™¨å¤±è´¥: ${e}`,n),null}}async function v(e,t={}){try{const{targetSelector:n=o.editorContent,append:i=!0,insertPosition:r="cursor",styleOptions:s={}}=t,a=(new f).parse({blocks:e});console.log("ç”Ÿæˆçš„HTMLå†…å®¹:",a);const l=await async function(e,t={}){const{targetSelector:n=o.editorContent,append:i=!0,insertPosition:r="cursor"}=t;try{const t=k(n);if(!t)return console.error("æ‰¾ä¸åˆ°ç›®æ ‡ç¼–è¾‘å™¨:",n),!1;const o=y("div",{innerHTML:e});if(i)for(;o.firstChild;)t.appendChild(o.firstChild);else switch(r){case"start":for(;o.lastChild;)t.insertBefore(o.lastChild,t.firstChild);break;case"end":for(;o.firstChild;)t.appendChild(o.firstChild);break;default:t.innerHTML=e}return console.log("å†…å®¹æ’å…¥æˆåŠŸ"),!0}catch(s){return console.error("æ’å…¥å†…å®¹å¤±è´¥:",s),!1}}(a,{targetSelector:n,append:i,insertPosition:r});return l}catch(n){return console.error("ä¿å­˜åˆ°åŸç¼–è¾‘å™¨å¤±è´¥:",n),!1}}function E(){return!(!window.EditorJSBundle||!window.EditorJSBundle.EditorJS)}function S(e){if(!document.getElementById(e))throw new Error(`${e}å…ƒç´ ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥DOMç»“æ„`);try{const t={holder:e,tools:function(e){const t={};for(const[n,i]of Object.entries(e)){const{class:e,...r}=i;if(!window.EditorJSBundle||!window.EditorJSBundle[e]){console.warn(`å·¥å…·ç±» ${e} æœªæ‰¾åˆ°æˆ–æœªåŠ è½½ï¼Œè·³è¿‡å·¥å…· ${n}`);continue}const o=window.EditorJSBundle[e];o?t[n]={class:o,...r}:console.warn(`å·¥å…·ç±» ${e} æœªåŠ è½½ï¼Œè·³è¿‡å·¥å…· ${n}`)}return t}(r.tools),data:{blocks:[]},placeholder:r.placeholder,autofocus:r.autofocus,hideToolbar:r.hideToolbar,minHeight:r.minHeight,logLevel:r.logLevel,onReady:()=>{new window.EditorJSBundle.DragDrop(n)}},n=new window.EditorJSBundle.EditorJS(t);return n}catch(t){throw console.error("ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥:",t),t}}async function C(e){if(!E())try{await new Promise((e,t)=>{chrome.runtime.sendMessage("inject_editorjs_bundle",n=>{n&&"injected"===n.status?setTimeout(()=>{E()?e():t(new Error("ç¼–è¾‘å™¨è„šæœ¬åŠ è½½å¤±è´¥"))},100):t(new Error("ç¼–è¾‘å™¨æ³¨å…¥å¤±è´¥"))})})}catch(t){throw new Error("ç¼–è¾‘å™¨åŠ è½½å¤±è´¥: "+t.message)}return S(e)}async function M(){try{await async function(){if(z)return void console.debug("æ™ºèƒ½ç¼–è¾‘å™¨å·²ç»æ¿€æ´»");if(!k(o.editorContent))return void alert("æ‰¾ä¸åˆ°ç¼–è¾‘å™¨å®¹å™¨");try{!function(){x(document.getElementById(o.editorWrapper))||console.warn("[SmartEditor] æœªæ‰¾åˆ°åŸç¼–è¾‘å™¨iframeå®¹å™¨");const e=y("div",{id:"smart-editor-container",className:"flowedit-editor-container"});e.setAttribute("data-flowedit-plugin","smart-editor"),e.setAttribute("data-flowedit","true");const t=document.getElementById(o.authorArea);if(!t){const e=`ä½œè€…åŒºåŸŸæœªæ‰¾åˆ°: ${o.authorArea}`;throw console.error("[SmartEditor]",e),new Error(e)}const n=t.parentElement;if(!n){const e="ä½œè€…åŒºåŸŸçš„çˆ¶å…ƒç´ æœªæ‰¾åˆ°";throw console.error("[SmartEditor]",e),new Error(e)}n.insertBefore(e,t.nextSibling);const i=y("div",{id:"editor-holder",className:"flowedit-editor-holder"});e.appendChild(i),console.log("[SmartEditor] ç•Œé¢åˆ›å»ºå®Œæˆ")}(),L=function(e={}){const{onSave:t,onCancel:n}=e,i=y("div",{className:"flowedit-editor-action-bar"}),r=y("button",{textContent:"ğŸ’¾ ä¿å­˜",className:"flowedit-editor-save-btn"}),s=y("button",{textContent:"â†©ï¸ å–æ¶ˆ",className:"flowedit-editor-cancel-btn"});i.appendChild(r),i.appendChild(s);const a=document.getElementById(o.footerToolbar);return a?(x(a),a.parentNode.insertBefore(i,a.nextSibling)):(console.warn("æ‰¾ä¸åˆ°åº•éƒ¨å·¥å…·æ å…ƒç´ ï¼Œå°†æ§åˆ¶æ æ·»åŠ åˆ°body"),document.body.appendChild(i)),t&&"function"==typeof t&&r.addEventListener("click",t),n&&"function"==typeof n&&s.addEventListener("click",n),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ§åˆ¶æ åˆ›å»ºå®Œæˆï¼Œå·²æ’å…¥åˆ°DOMä¸­"),i}({onSave:I,onCancel:A}),await new Promise(e=>setTimeout(e,50)),z=await C("editor-holder");const e=k("#header");e&&(await new Promise(e=>setTimeout(e,100)),e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),console.log("å·²æ»šåŠ¨åˆ°æ™ºèƒ½ç¼–è¾‘å™¨ä½ç½®")),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ¿€æ´»æˆåŠŸ")}catch(e){console.error("æ™ºèƒ½æ’å…¥åŠŸèƒ½å¯åŠ¨å¤±è´¥:",e),alert("æ™ºèƒ½æ’å…¥åŠŸèƒ½å¯åŠ¨å¤±è´¥"),A()}}()}catch(e){console.error("æ™ºèƒ½æ’å…¥æŒ‰é’®ç‚¹å‡»å¤„ç†å¤±è´¥:",e)}}new f;let z=null,L=null,T=null;function H(){if(T)console.warn("æ™ºèƒ½æ’å…¥æŒ‰é’®åŠŸèƒ½å·²ç»åˆå§‹åŒ–");else try{T=function(){const e=y("button",{className:"flowedit-smart-btn",textContent:"æ™ºèƒ½æ’å…¥"});e.setAttribute("data-flowedit-plugin","smart-button"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",M);const t=document.getElementById(o.toolbar);if(!t){const e=`å·¥å…·æ å®¹å™¨æœªæ‰¾åˆ°: ${o.toolbar}`;throw console.error("[SmartButton]",e),new Error(e)}return t.appendChild(e),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("æ™ºèƒ½æ’å…¥æŒ‰é’®æˆåŠŸ")}catch(e){console.error("æ™ºèƒ½ç¼–è¾‘å™¨åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:",e)}}function A(){!function(){const e=document.getElementById("smart-editor-container");e&&e.remove(),b(document.getElementById(o.editorWrapper)),console.log("[SmartEditor] ç•Œé¢å·²ç§»é™¤")}(),L&&(!function(e){e&&(e.remove(),console.log("æ™ºèƒ½ç¼–è¾‘å™¨æ§åˆ¶æ å·²ç§»é™¤"));const t=document.getElementById(o.footerToolbar);t&&b(t)}(L),L=null),z&&(!function(e){if(e)try{e.destroy()}catch(t){console.warn("ç¼–è¾‘å™¨é”€æ¯é”™è¯¯:",t)}}(z),z=null),console.log("æ™ºèƒ½ç¼–è¾‘å™¨å·²åœç”¨")}async function I(e={}){if(z)try{const t=await z.save();console.log("ä¿å­˜çš„æ•°æ®:",t);await v(t.blocks,{...e})?console.log("å†…å®¹å·²æˆåŠŸä¿å­˜åˆ°åŸç¼–è¾‘å™¨"):console.error("ä¿å­˜åˆ°åŸç¼–è¾‘å™¨å¤±è´¥")}catch(t){console.error("ä¿å­˜å¤±è´¥:",t)}finally{A()}else console.error("ç¼–è¾‘å™¨æœªåˆå§‹åŒ–")}const P={name:"smart-editor",initialize:async()=>{H()},cleanup:()=>{A(),T&&T.cleanup&&(T.cleanup(),T=null,console.log("æ™ºèƒ½ç¼–è¾‘å™¨åŠŸèƒ½å·²æ¸…ç†"))},isEnabled:()=>!0,isActive:()=>null!==z};function q(e){const t=document.getElementById(o.sidebar);if(t&&e&&e.currentTarget){const n=e.currentTarget;n.classList.contains("on")?(n.classList.remove("on"),b(t)):(n.classList.add("on"),x(t))}}let $=null;function B(){if($)console.warn("ä¾§è¾¹æ åŠŸèƒ½å·²ç»åˆå§‹åŒ–");else try{$=function(){const e=y("div",{className:"flowedit-switch",innerHTML:'\n      <div class="flowedit-switch-track"></div>\n      <div class="flowedit-switch-thumb"></div>\n    '});e.setAttribute("data-flowedit-plugin","sidebar-toggle"),e.setAttribute("data-flowedit","true"),e.addEventListener("click",q);const t=document.getElementById(o.toolbar);if(!t){const e=`å·¥å…·æ å®¹å™¨æœªæ‰¾åˆ°: ${o.toolbar}`;throw console.error("[SidebarToggle]",e),new Error(e)}return t.insertBefore(e,t.firstChild),{element:e,cleanup:()=>{e.parentNode&&e.parentNode.removeChild(e)}}}(),console.log("ä¾§è¾¹æ åŠŸèƒ½åˆå§‹åŒ–æˆåŠŸ")}catch(e){console.error("ä¾§è¾¹æ åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥:",e)}}const N={name:"sidebar",initialize:async()=>{B()},cleanup:()=>{$&&$.cleanup&&($.cleanup(),$=null,console.log("ä¾§è¾¹æ åŠŸèƒ½å·²æ¸…ç†"))},isEnabled:()=>!0,isActive:()=>null!==$};const j=new class{constructor(){this.config={},this.initialized=!1}async initialize(){try{this.initialized=!0}catch(e){throw console.error("ç”¨æˆ·é…ç½®ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:",e),e}}getUserConfig(e){return this.initialized?e?this.config[e]:this.config:(console.warn("ç”¨æˆ·é…ç½®ç®¡ç†å™¨æœªåˆå§‹åŒ–"),null)}async setUserConfig(e,t){try{return this.initialized?("object"==typeof e?this.config={...this.config,...e}:this.config[e]=t,!0):(console.warn("ç”¨æˆ·é…ç½®ç®¡ç†å™¨æœªåˆå§‹åŒ–"),!1)}catch(n){return console.error("è®¾ç½®ç”¨æˆ·é…ç½®å¤±è´¥:",n),!1}}},F=new class{constructor(){this.initialized=!1,this.styleCache={},this.syncInterval=null}async initialize(){try{this.initialized=!0}catch(e){throw console.error("è¿œç¨‹æ ·å¼åŒæ­¥æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",e),e}}async manualSync(){try{return!!this.initialized||(console.warn("è¿œç¨‹æ ·å¼åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–"),!1)}catch(e){return console.error("è¿œç¨‹æ ·å¼åŒæ­¥å¤±è´¥:",e),!1}}startAutoSync(e=3e4){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(async()=>{await this.manualSync()},e)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}};async function D(e={}){try{return await j.initialize(),await async function(e={}){try{if(await F.initialize(),!1!==e.enableAutoSync){const t=e.syncInterval||3e4;F.startAutoSync(t)}!1!==e.initialSync&&await F.manualSync()}catch(t){console.error("è¿œç¨‹æ ·å¼ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",t)}}(e),!0}catch(t){return console.error("FlowEditåº”ç”¨æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",t),!1}}const _=new class{constructor(){this.isWatching=!1,this.reinitTimeout=null,this.mutationObserver=null,this.targetElement=null,this.pendingRemoval=!1}startWatching(){this.isWatching||(this.targetElement=document.getElementById("edui1_toolbarboxouter"),this.targetElement?(this.mutationObserver=new MutationObserver(e=>{this.handleMutations(e)}),this.mutationObserver.observe(this.targetElement,{childList:!0,subtree:!0}),this.isWatching=!0,console.log("[DOMWatcher] ğŸ” å¼€å§‹ç›‘å¬æ¸²æŸ“å˜åŒ–")):console.error("[DOMWatcher] âŒ å®¹å™¨æœªæ‰¾åˆ°"))}stopWatching(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.reinitTimeout&&(clearTimeout(this.reinitTimeout),this.reinitTimeout=null),this.targetElement=null,this.pendingRemoval=!1,this.isWatching=!1,console.log("[DOMWatcher] åœæ­¢ç›‘å¬å·¥å…·æ å…ƒç´ å˜åŒ–")}handleMutations(e){e.forEach(e=>{"childList"===e.type&&(e.removedNodes.length>0&&(this.pendingRemoval=!0),this.pendingRemoval&&e.addedNodes.length>0&&(this.pendingRemoval=!1,this.checkFeatureNode()))})}checkFeatureNode(){if(!this.targetElement)return!1;const e="flowedit",t="data-flowedit-plugin",n=this.targetElement.querySelectorAll(`[${t}]`);let i=!1;return n.forEach(t=>{Array.from(t.classList).some(t=>t.startsWith(e))&&(console.log("[DOMWatcher] âœ… ç‰¹å¾èŠ‚ç‚¹å­˜åœ¨:",t),i=!0)}),i||(console.log("[DOMWatcher] âš ï¸ æœªæ‰¾åˆ°ç‰¹å¾èŠ‚ç‚¹"),this.scheduleReinit()),i}isPluginElement(e){const t=Array.from(e.classList||[]).some(e=>e.startsWith("flowedit")),n=e.hasAttribute("data-flowedit-plugin");return t||n}scheduleReinit(){this.reinitTimeout&&clearTimeout(this.reinitTimeout),this.reinitTimeout=setTimeout(()=>{this.reinitializePlugins()},100)}async reinitializePlugins(){try{await e.cleanupAll(),await new Promise(e=>setTimeout(e,300));const t=await e.initializeAll();t.failed.length>0&&console.warn(`[DOMWatcher] é‡æ–°åˆå§‹åŒ–å¤±è´¥: ${t.failed.join(", ")}`)}catch(t){console.error("[DOMWatcher] é‡æ–°åˆå§‹åŒ–æ’ä»¶å¤±è´¥:",t)}}};async function O(){if(!document.querySelector("#js_toolbar_0"))return;!function(){const e="flow-editor-plugin-styles";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.setAttribute("data-flowedit-plugin-ui","true"),t.textContent="\n      /* FlowEdit æ’ä»¶UIæ ·å¼ */\n      \n  /* æ‰©å±•æŒ‰é’®åŸºç¡€æ ·å¼ */\n  .flowedit-smart-btn {\n    /* åŸºç¡€å¸ƒå±€æ ·å¼ */\n    position: relative;\n    display: inline-block;\n    height: 22px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n    \n    /* ç‰¹å®šæ ·å¼ */\n    background-color: #07c160;\n    color: white;\n    border-radius: 4px;\n    padding: 0 12px;\n    font-size: 12px;\n    line-height: 22px;\n    transition: all 0.3s ease;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥æŒ‰é’®æ‚¬æµ®æ•ˆæœ */\n  .flowedit-smart-btn:hover {\n    background-color: #07c160;\n    background-image: linear-gradient(to bottom, #07C160 0, #07C160 100%);\n    border-color: #07C160;\n    color: #FFFFFF;\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n      \n  /* Switchå¼€å…³æ ·å¼ */\n  .flowedit-switch {\n    position: relative;\n    display: inline-block;\n    width: 40px;\n    height: 20px;\n    margin: 8px 12px;\n    cursor: pointer;\n    border: none;\n    outline: none;\n    box-sizing: border-box;\n    vertical-align: middle;\n    flex-shrink: 0;\n  }\n  \n  .flowedit-switch-track {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    border-radius: 11px;\n    transition: all 0.3s ease;\n  }\n  \n  .flowedit-switch-thumb {\n    position: absolute;\n    width: 18px;\n    height: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    border-radius: 50%;\n    transition: transform 0.3s ease;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-track {\n    background-color: #07c160;\n  }\n  \n  .flowedit-switch.on .flowedit-switch-thumb {\n    transform: translateX(18px);\n  }\n\n      \n  /* æ™ºèƒ½æ’å…¥ç¼–è¾‘å™¨å®¹å™¨æ ·å¼ */\n  .flowedit-editor-container {\n    position: relative; /* æ”¹ä¸ºç›¸å¯¹å®šä½ï¼Œé€‚åˆç›´æ¥æ’å…¥ */\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: calc(100% + 8px);\n    box-sizing: content-box;More actions\n    background: #fff;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥ç¼–è¾‘å™¨å ä½å…ƒç´ æ ·å¼ */\n  .flowedit-editor-holder {\n    margin-left: -95px;\n    padding: 0;\n    padding-left: 91px;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥æ§åˆ¶æ æ ·å¼ */\n  .flowedit-editor-action-bar {\n    position: relative; /* æ”¹ä¸ºç›¸å¯¹å®šä½ï¼Œé€‚é…ç›´æ¥æ’å…¥DOM */\n    background-color: #ffffff;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    gap: 15px;\n    padding: 20px 20px 15px 20px; /* æ·»åŠ ä¸Šä¸‹å†…è¾¹è· */\n    box-sizing: border-box;\n    width: 768px;\n  }\n  \n  /* æ™ºèƒ½æ’å…¥ä¿å­˜æŒ‰é’®æ ·å¼ */\n  .flowedit-editor-save-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #07c160;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n  \n\n  \n  /* æ™ºèƒ½æ’å…¥å–æ¶ˆæŒ‰é’®æ ·å¼ */\n  .flowedit-editor-cancel-btn {\n    padding: 4px 12px;\n    height: 34px;\n    min-width: 96px;\n    display: inline-block;\n    background: #999999;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n\n    ",document.head.appendChild(t)}}();const t=await e.initializeAll();t.failed.length>0&&console.warn(`åˆå§‹åŒ–å¤±è´¥çš„åŠŸèƒ½æ¨¡å—: ${t.failed.join(", ")}`),_.startWatching()}e.register("smart-editor",P),e.register("sidebar",N),window.addEventListener("beforeunload",()=>{_.stopWatching()}),async function(){"loading"===document.readyState&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",e)});try{await D()}catch(e){console.error("[FlowEdit] initializeAppServicesåˆå§‹åŒ–å¤±è´¥:",e)}await O()}().catch(e=>{console.error("FlowEdit å¯åŠ¨å¤±è´¥:",e)})}();
